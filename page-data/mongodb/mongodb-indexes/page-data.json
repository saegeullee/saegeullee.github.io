{"componentChunkName":"component---src-templates-post-template-js","path":"/mongodb/mongodb-indexes","result":{"data":{"markdownRemark":{"id":"a2e505f7-e3b8-518e-b27a-ee3d8ea99f16","html":"<blockquote>\n<p><strong><a href=\"https://www.udemy.com/course/mongodb-the-complete-developers-guide/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">유데미 몽고DB</a></strong> 수업을 듣고 정리한 내용입니다.</p>\n</blockquote>\n<h1 id=\"목차\"><a href=\"#%EB%AA%A9%EC%B0%A8\" aria-label=\"목차 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목차</h1>\n<ul>\n<li><a href=\"#mongodb-explain-%EB%A9%94%EC%84%9C%EB%93%9C\">mongoDB explain 메서드</a></li>\n<li><a href=\"#%EC%9D%B8%EB%8D%B1%EC%8A%A4-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0\">인덱스-추가하기</a></li>\n</ul>\n<h2 id=\"mongodb-explain-메서드\"><a href=\"#mongodb-explain-%EB%A9%94%EC%84%9C%EB%93%9C\" aria-label=\"mongodb explain 메서드 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>mongoDB explain 메서드</h2>\n<p>몽고쉘에서 다음 명령을 통해 몽고DB가 특정 쿼리를 어떻게 수행할 것인지에 대한 계획을 살펴볼 수 있다. <code class=\"language-text\">winningPlan</code>을 보면 stage 프로퍼티가 <code class=\"language-text\">COLLSCAN</code>으로 몽고DB가 해당 쿼리를 수행할 때 contacts 컬렉션의 모든 데이터를 한번씩 다 보고 <code class=\"language-text\">dob.age</code>가 60 초과인 도큐먼트만 쿼리했음을 알 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"mongo\"><pre class=\"language-mongo\"><code class=\"language-mongo\">&gt; db.contacts.explain().find({&quot;dob.age&quot;: {$gt:60}})\n{\n\t&quot;queryPlanner&quot; : {\n\t\t&quot;plannerVersion&quot; : 1,\n\t\t&quot;namespace&quot; : &quot;contactsData.contacts&quot;,\n\t\t&quot;indexFilterSet&quot; : false,\n\t\t&quot;parsedQuery&quot; : {\n\t\t\t&quot;dob.age&quot; : {\n\t\t\t\t&quot;$gt&quot; : 60\n\t\t\t}\n\t\t},\n\t\t&quot;winningPlan&quot; : {\n\t\t\t&quot;stage&quot; : &quot;COLLSCAN&quot;,\n\t\t\t&quot;filter&quot; : {\n\t\t\t\t&quot;dob.age&quot; : {\n\t\t\t\t\t&quot;$gt&quot; : 60\n\t\t\t\t}\n\t\t\t},\n\t\t\t&quot;direction&quot; : &quot;forward&quot;\n\t\t},\n\t\t&quot;rejectedPlans&quot; : [ ]\n\t},\n\t&quot;serverInfo&quot; : {\n\t\t&quot;host&quot; : &quot;saegeullee-notebook&quot;,\n\t\t&quot;port&quot; : 27017,\n\t\t&quot;version&quot; : &quot;3.6.3&quot;,\n\t\t&quot;gitVersion&quot; : &quot;9586e557d54ef70f9ca4b43c26892cd55257e1a5&quot;\n\t},\n\t&quot;ok&quot; : 1\n}</code></pre></div>\n<p>다음 명령을 통해 더 상세한 정보를 확인할 수 있다. <code class=\"language-text\">executionStats</code>를 보면 이 쿼리를 수행하는데 11밀리초가 걸렸고 해당 조건에 부합하는 1222개의 도큐먼트를 쿼리하기 위해 총 5000개의 도큐먼트를 살펴본 것을(examined) 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&gt;db.contacts.explain(&quot;executionStats&quot;).find({&quot;dob.age&quot;: {$gt:60}})\n{\n  생략...\n\t&quot;executionStats&quot; : {\n\t\t&quot;executionSuccess&quot; : true,\n\t\t&quot;nReturned&quot; : 1222,\n\t\t&quot;executionTimeMillis&quot; : 11,\n\t\t&quot;totalKeysExamined&quot; : 0,\n\t\t&quot;totalDocsExamined&quot; : 5000,\n\t\t&quot;executionStages&quot; : {\n\t\t\t&quot;stage&quot; : &quot;COLLSCAN&quot;,\n\t\t\t&quot;filter&quot; : {\n\t\t\t\t&quot;dob.age&quot; : {\n\t\t\t\t\t&quot;$gt&quot; : 60\n\t\t\t\t}\n\t\t\t},\n\t\t\t&quot;nReturned&quot; : 1222,\n\t\t\t&quot;executionTimeMillisEstimate&quot; : 10,\n\t\t\t&quot;works&quot; : 5002,\n\t\t\t&quot;advanced&quot; : 1222,\n\t\t\t&quot;needTime&quot; : 3779,\n\t\t\t&quot;needYield&quot; : 0,\n\t\t\t&quot;saveState&quot; : 39,\n\t\t\t&quot;restoreState&quot; : 39,\n\t\t\t&quot;isEOF&quot; : 1,\n\t\t\t&quot;invalidates&quot; : 0,\n\t\t\t&quot;direction&quot; : &quot;forward&quot;,\n\t\t\t&quot;docsExamined&quot; : 5000\n\t\t}\n\t},\n\t&quot;serverInfo&quot; : {\n\t\t&quot;host&quot; : &quot;saegeullee-notebook&quot;,\n\t\t&quot;port&quot; : 27017,\n\t\t&quot;version&quot; : &quot;3.6.3&quot;,\n\t\t&quot;gitVersion&quot; : &quot;9586e557d54ef70f9ca4b43c26892cd55257e1a5&quot;\n\t},\n\t&quot;ok&quot; : 1\n}</code></pre></div>\n<h2 id=\"인덱스-추가하기\"><a href=\"#%EC%9D%B8%EB%8D%B1%EC%8A%A4-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0\" aria-label=\"인덱스 추가하기 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인덱스 추가하기</h2>\n<p>다음 명령을 통해 mongoDB가 사용할 수 있는 인덱스를 추가할 수 있다. 컬렉션 스키마의 최상위 프로퍼티 뿐만 아니라 특정 프로퍼티에 embeded된 프로퍼티를 인덱스로 지정할 수도 있다. <code class=\"language-text\">dob.age</code> 프로퍼티의 값을 1로 지정함으로써 오름차순으로 인덱스를 생성할 수 있다. -1을 값으로 주면 내림차순으로 생성된다. 몽고DB는 양방향으로 lookup을 할 수 있기 때문에 인덱스를 오름차순, 내림차순을 지정하는 것은 쿼리 퍼포먼스에 영향을 주지 않는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&gt; db.contacts.createIndex({&quot;dob.age&quot;: 1})\n{\n\t&quot;createdCollectionAutomatically&quot; : false,\n\t&quot;numIndexesBefore&quot; : 1,\n\t&quot;numIndexesAfter&quot; : 2,\n\t&quot;ok&quot; : 1\n}</code></pre></div>\n<p>이제 다시 <code class=\"language-text\">executionStats</code>를 확인해보면 다음과 같다. 쿼리 시간이 2 밀리초로 단축된 것을 확인 할 수 있다. 그리고 execution stage가 두 개가 수행된 것을 확인 할 수 있다. 첫번째인 inputStage는 <code class=\"language-text\">IXSCAN</code>으로 인덱스 스캔이다. 이 stage를 통해 1222개의 인덱스 키와 각 인덱스 키의 도큐먼트를 가리키고 있는 포인터(주소)를 리턴했다. 1222개의 실제 도큐먼트를 리턴하는 것은 그 다음 stage인 <code class=\"language-text\">FETCH</code>에서 수행된다. 또한, <code class=\"language-text\">totalDocsExamined</code> 를 확인해보면 1222개의 도큐먼트를 리턴하기 위해 정확히 이에 해당하는 1222개의 도큐먼트만을 살펴본 것을 알 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&gt; db.contacts.explain(&quot;executionStats&quot;).find({&quot;dob.age&quot;: {$gt:60}})\n{\n\t&quot;queryPlanner&quot; : {\n\t\t&quot;plannerVersion&quot; : 1,\n\t\t&quot;namespace&quot; : &quot;contactsData.contacts&quot;,\n\t\t&quot;indexFilterSet&quot; : false,\n\t\t&quot;parsedQuery&quot; : {\n\t\t\t&quot;dob.age&quot; : {\n\t\t\t\t&quot;$gt&quot; : 60\n\t\t\t}\n\t\t},\n\t\t&quot;winningPlan&quot; : {\n\t\t\t&quot;stage&quot; : &quot;FETCH&quot;,\n\t\t\t&quot;inputStage&quot; : {\n\t\t\t\t&quot;stage&quot; : &quot;IXSCAN&quot;,\n\t\t\t\t&quot;keyPattern&quot; : {\n\t\t\t\t\t&quot;dob.age&quot; : 1\n\t\t\t\t},\n\t\t\t\t//...\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t&quot;rejectedPlans&quot; : [ ]\n\t},\n\t&quot;executionStats&quot; : {\n\t\t&quot;executionSuccess&quot; : true,\n\t\t&quot;nReturned&quot; : 1222,\n\t\t&quot;executionTimeMillis&quot; : 2,\n\t\t&quot;totalKeysExamined&quot; : 1222,\n\t\t&quot;totalDocsExamined&quot; : 1222,\n\t\t&quot;executionStages&quot; : {\n\t\t\t&quot;stage&quot; : &quot;FETCH&quot;,\n\t\t\t&quot;nReturned&quot; : 1222,\n\t\t\t&quot;executionTimeMillisEstimate&quot; : 0,\n\t\t\t&quot;works&quot; : 1223,\n\t\t\t&quot;advanced&quot; : 1222,\n\t\t\t&quot;needTime&quot; : 0,\n\t\t\t&quot;needYield&quot; : 0,\n\t\t\t&quot;saveState&quot; : 9,\n\t\t\t&quot;restoreState&quot; : 9,\n\t\t\t&quot;isEOF&quot; : 1,\n\t\t\t&quot;invalidates&quot; : 0,\n\t\t\t&quot;docsExamined&quot; : 1222,\n\t\t\t&quot;alreadyHasObj&quot; : 0,\n\t\t\t&quot;inputStage&quot; : {\n\t\t\t\t&quot;stage&quot; : &quot;IXSCAN&quot;,\n\t\t\t\t&quot;nReturned&quot; : 1222,\n\t\t\t\t&quot;executionTimeMillisEstimate&quot; : 0,\n\t\t\t\t&quot;works&quot; : 1223,\n\t\t\t\t&quot;advanced&quot; : 1222,\n\t\t\t\t&quot;needTime&quot; : 0,\n\t\t\t\t&quot;needYield&quot; : 0,\n\t\t\t\t&quot;saveState&quot; : 9,\n\t\t\t\t&quot;restoreState&quot; : 9,\n\t\t\t\t&quot;isEOF&quot; : 1,\n\t\t\t\t&quot;invalidates&quot; : 0,\n\t\t\t\t&quot;keyPattern&quot; : {\n\t\t\t\t\t&quot;dob.age&quot; : 1\n\t\t\t\t//...\n\t&quot;ok&quot; : 1\n}</code></pre></div>","fields":{"slug":"/mongodb/mongodb-indexes","tagSlugs":["/tag/mongodb/"]},"frontmatter":{"date":"2020-01-05T22:50:37.121Z","description":"mongoDB explain 메서드 : 몽고쉘에서 다음 명령을 통해 몽고DB가 특정 쿼리를 어떻게 수행할 것인지에 대한 계획을 살펴볼 수 있다...","tags":["mongodb"],"title":"MongoDB 인덱싱","socialImage":"/media/image-2.jpg"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/mongodb/mongodb-indexes"}}}