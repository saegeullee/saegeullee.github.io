{"componentChunkName":"component---src-templates-post-template-js","path":"/nodejs/mongoose-error-schema-hasnt-been-registered","result":{"data":{"markdownRemark":{"id":"d1706e8d-2177-5b7e-82d1-db9042ec8080","html":"<p>이 포스팅에서는 nodejs &#x26; mongoose 어플리케이션을 개발하다 발생한 아래의 에러 원인과 해결방법에 대해 정리해본다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Schema hasn&#39;t been registered for model \\&quot;Provision\\&quot;.\n\\nUse mongoose.model(name, schema)</code></pre></div>\n<p>프로젝트를 진행하며 위의 에러때문에 시간을 꽤 잡아먹었다. 결론적으로 이 에러가 발생한 이유는 <code class=\"language-text\">Provision</code> 모델을 어플리케이션의 어디에서도 <code class=\"language-text\">require</code>하지 않았기 때문이다… <code class=\"language-text\">Provision</code> 모델은 이 프로젝트에서 직접적으로 쿼리하지 않고 <code class=\"language-text\">Item</code> 모델을 통해 간접적으로 쿼리된다. <code class=\"language-text\">Item</code> 모델의 필드에 <code class=\"language-text\">Provision</code> 의 reference가 있다. 따라서 아래와 같이 <code class=\"language-text\">Item</code>모델에서 <code class=\"language-text\">Provision</code>을 populate 하는 과정에서 위의 에러가 발생한 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> item <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Item<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">populate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">:</span> <span class=\"token string\">'itemType'</span><span class=\"token punctuation\">,</span> select<span class=\"token punctuation\">:</span> <span class=\"token string\">'name'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">populate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">:</span> <span class=\"token string\">'model'</span><span class=\"token punctuation\">,</span> select<span class=\"token punctuation\">:</span> <span class=\"token string\">'name'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">populate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">:</span> <span class=\"token string\">'owner'</span><span class=\"token punctuation\">,</span> select<span class=\"token punctuation\">:</span> <span class=\"token string\">'nickName'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">populate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">:</span> <span class=\"token string\">'provisionHistory'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">itemType</code>이나 <code class=\"language-text\">model</code>, <code class=\"language-text\">owner</code>는 populate가 잘 되는데 provision에서 계속 에러가 발생했다. Provision을 직접적으로 여기서 쿼리하지 않기때문에 require을 할 필요가 없다고 생각했지만 이것 때문에 에러가 발생했다. Provision을 여기서 require하지 않으면 어플리케이션의 다른곳에서라도 이를 require하여 Nodejs에게 Provison 모델 모듈에 대해 알려줘야했는데 이를 하지 않아서 에러가 발생한 것이다. 분명히 모델에서 <code class=\"language-text\">module.exports</code>를 했는데 왜 에러가 나지.. 라고 1차원적으로 생각했다…</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> mongoose<span class=\"token punctuation\">.</span><span class=\"token function\">model</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Provision'</span><span class=\"token punctuation\">,</span> provisionSchema<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>해당 서비스 파일에서 <code class=\"language-text\">Provision</code> 모델을 require하니 에러가 발생하지 않고 populate가 잘 되었다. 앞으로는 직접적으로 쿼리하지 않는 모델에 대한 require 하는 것도 잊지 말아야겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> Provision <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'models/provision'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","fields":{"slug":"/nodejs/mongoose-error-schema-hasnt-been-registered","tagSlugs":["/tag/nodejs/","/tag/mongoose/"]},"frontmatter":{"date":"2019-12-18T12:10:37.121Z","description":"이 포스팅에서는 nodejs & mongoose 어플리케이션을 개발하다 발생한 Schema hasn't been registered for model 에러 원인과 해결방법에 대해 정리해본다.","tags":["nodejs","mongoose"],"title":"Mongoose 에러 Schema hasn't been registered","socialImage":"/media/image-2.jpg"}}},"pageContext":{"slug":"/nodejs/mongoose-error-schema-hasnt-been-registered"}},"staticQueryHashes":["251939775","3439816877","401334301"]}