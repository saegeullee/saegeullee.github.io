{"componentChunkName":"component---src-templates-post-template-js","path":"/nodejs/error-handling-middleware","webpackCompilationHash":"75f549f8752292ea0a23","result":{"data":{"markdownRemark":{"id":"1a9ca8f0-6394-5f51-8bd3-aa1482e3c7d7","html":"<blockquote>\n<p><strong><a href=\"https://www.udemy.com/course/nodejs-express-mongodb-bootcamp/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">유데미 NODE.JS</a></strong> 수업을 듣고 정리한 내용입니다.</p>\n</blockquote>\n<h1 id=\"error-handling-middleware\"><a href=\"#error-handling-middleware\" aria-label=\"error handling middleware permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>error handling middleware</h1>\n<p>어플리케이션에서 발생할 수 있는 에러의 종류를 2가지로 나눠 생각해볼 수 있다. <code class=\"language-text\">operational errors</code> 와 <code class=\"language-text\">programming errors</code>이다. 전자는 시스템 운영상에 발생하는 에러로 프로그래머가 미리 예측할 수 있고 이에 대비해야 한다. 반면에 후자는 프로그래머가 잘못된 코드를 작성해서 발생하는 에러이다.</p>\n<h2 id=\"operational-errors\"><a href=\"#operational-errors\" aria-label=\"operational errors permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>operational errors</h2>\n<ul>\n<li>Invalid path accessed</li>\n<li>Invalid user input(validator error from mongoose)</li>\n<li>Failed to connect to server</li>\n<li>Failed to connect to database</li>\n<li>Request timeout</li>\n<li>etc..</li>\n</ul>\n<h2 id=\"programming-errors\"><a href=\"#programming-errors\" aria-label=\"programming errors permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>programming errors</h2>\n<ul>\n<li>reading properties on undefined</li>\n<li>passing a number where an object is expected</li>\n<li>using await without async</li>\n<li>using req.query instead of req.body</li>\n<li>etc..</li>\n</ul>\n<p>다양한 <code class=\"language-text\">operational errors</code>에 대응하기 위해 <code class=\"language-text\">global error handling middleware</code>를 만드는 것이 좋다. 이를 통해 하나의 미들웨어에서 발생 가능한 모든 에러에 대응 할 수 있고 앱의 다른 부분인 비즈니스 로직이나 컨트롤러 코드에서는 에러에 대해 신경쓰지 않아도 된다.</p>\n<h1 id=\"global-error-handling-middleware\"><a href=\"#global-error-handling-middleware\" aria-label=\"global error handling middleware permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>global error handling middleware</h1>\n<p>먼저 클라이언트에서 잘못된 엔드포인트를 호출했을 때를 대응하는 방법을 알아보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//app.js</span>\n\n<span class=\"token comment\">//정상적인 엔드포인트</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/v1/tours\"</span><span class=\"token punctuation\">,</span> tourRouter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/v1/users\"</span><span class=\"token punctuation\">,</span> userRouter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//잘못된 모든 엔드포인트 호출에 대한 대응</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//에러 메시지 생성</span>\n    <span class=\"token keyword\">const</span> err <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Can't find </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>req<span class=\"token punctuation\">.</span>originalUrl<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> on this server!</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    err<span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> <span class=\"token string\">\"fail\"</span><span class=\"token punctuation\">;</span>\n    err<span class=\"token punctuation\">.</span>statusCode <span class=\"token operator\">=</span> <span class=\"token number\">404</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">next</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>미들웨어에서 <code class=\"language-text\">next()</code>를 호출하면 미들웨어 스택의 다음 미들웨어가 실행된다. 하지만 해당 미들웨어에 next() 메서드의 인자로 에러 객체를 넣으면 Express 앱은 자동으로 에러가 발생하였음을 인지한다. 이는 미들웨어의 모든 next() 메서드에 동일하게 적용이 된다. Express가 에러가 발생했음을 인지하면 미들웨어 스택의 모든 미들웨어를 건너뛰고 <code class=\"language-text\">global error handling middleware</code>에게 에러를 전달한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//global error handling middleware</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//500 -> internal server error</span>\n    err<span class=\"token punctuation\">.</span>statusCode <span class=\"token operator\">=</span> err<span class=\"token punctuation\">.</span>statusCode <span class=\"token operator\">||</span> <span class=\"token number\">500</span><span class=\"token punctuation\">;</span>\n    err<span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> err<span class=\"token punctuation\">.</span>status <span class=\"token operator\">||</span> <span class=\"token string\">\"error\"</span><span class=\"token punctuation\">;</span>\n\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>statusCode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        status<span class=\"token punctuation\">:</span> err<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">,</span>\n        message<span class=\"token punctuation\">:</span> err<span class=\"token punctuation\">.</span>message\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>보통의 미들웨어에는 3개의 인자 <code class=\"language-text\">req, res, next</code>를 전달하지만 에러 핸들링 미들웨어에는 4개의 인자(<code class=\"language-text\">err, req, res, next)</code>를 전달한다. 이를 통해 Express 앱은 자동으로 이 미들웨어가 에러 핸들링 미들웨어임을 알아차린다. 그리고 이 미들웨어에서 해당 에러를 처리하여 클라이언트에게 어떤 에러가 발생하였음을 알려주는 response를 보내준다.</p>","fields":{"slug":"/nodejs/error-handling-middleware","tagSlugs":["/tag/nodejs/"]},"frontmatter":{"date":"2019-11-16T12:00:37.121Z","description":"어플리케이션에서 발생할 수 있는 에러의 종류를 2가지로 나눠 생각해볼 수 있다. operational errors 와 programming errors이다. 전자는 시스템 운영상에 발생하는 에러로 프로그래머가 미리 예측할 수 있고 이에 대비해야 한다. 반면에 후자는 프로그래머가 잘못된 코드를 작성해서 발생하는 에러이다...","tags":["nodejs"],"title":"에러 핸들링 미들웨어","socialImage":"/media/image-2.jpg"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/nodejs/error-handling-middleware"}}}