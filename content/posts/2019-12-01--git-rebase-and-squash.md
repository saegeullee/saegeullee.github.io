---
title: Git Rebase & Squash
date: "2019-12-01T18:46:37.121Z"
template: "post"
draft: false
slug: "/category/git/git-rebase-and-squash"
category: "git"
tags:
  - "git"
description: "리베이스란 베이스를 다시 잡는 다는 말이다. 깃 feature 브랜치가 마스터 브랜치에서 갈라져 나온 시점의 마스터의 커밋이 있을텐데 그 마스터의 커밋이 기존의 베이스이다. 해당 feature 브랜치의 베이스가 되는 마스터의 커밋이기 때문이다. 깃 리베이스는 해당 feature 브랜치의 베이스를 마스터의 최신 커밋인 HEAD로 베이스를 다시 잡는다는 말이다..."
socialImage: "/media/image-2.jpg"
---

## 깃 리베이스

리베이스란 베이스를 다시 잡는 다는 말이다. 깃 feature 브랜치가 마스터 브랜치에서 갈라져 나온 시점의 마스터의 커밋이 있을텐데 그 마스터의 커밋이 기존의 베이스이다. 해당 feature 브랜치의 베이스가 되는 마스터의 커밋이기 때문이다. 깃 리베이스는 해당 feature 브랜치의 베이스를 마스터의 최신 커밋인 HEAD로 베이스를 다시 잡는다는 말이다.

## 왜 리베이스를 해야할까?

리베이스를 하지 않으면 보통 마스터의 브랜치에 feature 브랜치를 머지하는 방법이 있다. feature 브랜치의 베이스를 그대로 두고 마스터의 브랜치로 feature 브랜치의 작업내역들(커밋들)이 합쳐진다. 이 feature 브랜치의 커밋들은 커밋 시점을 기준으로 마스터의 브랜치와 병합이 되기 때문에 만약 다른 사람들과 협업을 하고 있었다면 다른 사람들의 커밋들과 나의 커밋들이 뒤섞일 가능성이 있다. 그렇다면 커밋 히스토리가 깔끔하지 않고 관리하기 어렵게 될 것이다. 반면에 리베이스를 하게 되면 feature 브랜치의 커밋들이 마스터의 최신 HEAD로 다시 베이스를 잡기 때문에 다른 사람들의 커밋들과 섞일 가능성이 없다. 즉 나의 feature 브랜치 작업내역을 마스터 브랜치의 최신 작업물이 되게끔 병합하는 것이다.

## 깃 스쿼시

깃 스쿼시를 통해 나의 feature 브랜치의 커밋들을 하나의 커밋으로 바꿀 수 있다. feature 브랜치에서 작업을 하다 보면 커밋을 여러번에 걸쳐서 할 수 있게 된다. 예를 들어 그날 하루의 작업이 끝났지만 아직 브랜치 전체의 작업이 끝나지 않았다면 집에 가기 전에 커밋메시지를 `wip(working in progress)`와 같이 나의 편의대로 남겨둘 수 있다. 또는 해당 feature 브랜치의 일부분의 작업이 끝났을때도 커밋 메시지를 따로 남겨둘 수 있다. feature 브랜치의 모든 작업이 끝났을때는 이렇게 작업중에 나의 편의대로 나만 알아볼 수 있는 메시지를 남겨뒀을 가능성이 있다. 이 상태로 만약 마스터로 병합 또는 리베이스를 하게 되면 커밋 메시지가 매우 지저분해진다. 깃 스쿼시는 feature 브랜치에서 그동안 내가 남긴 커밋 히스토리를 마스터에 병합 또는 리베이스 전에 하나의 최종 커밋으로 변경하고 싶을때 사용할 수 있다. 아래의 예시는 내가 이틀동안 하나의 feature 브랜치에서 작업하면서 남긴 7개의 커밋 히스토리이다. `git log`를 통해 확인할 수 있다. 만약 이대로 마스터의 브랜치에 병합하면 커밋 메시지가 굉장히 지저분해 질 것이고 이후에 내가 어떤 작업을 했었는지 알기 어려울 것이다.

![git squash](/media/gitsquash.png)

깃 스쿼시를 통해 그동안 내가 이 브랜치에서 나의 편의대로 남긴 커밋들을 이 브랜치에서의 작업을 나타내는 커밋으로 변경해보자. 그 전에 우선 마스터 브랜치를 최신화한다.

```
git checkout master
git pull origin master
```

다시 작업중이던 브랜치로 체크아웃을 한다.

```
git checkout feature/jumsul_logic3
```

이 브랜치에서 스쿼시를 원하는 커밋의 개수가 7개임을 확인했으니 다음 명령을 통해 스쿼시를 진행한다. 변경하고자 하는 커밋의 갯수를 HEAD~ 뒤에 적어준다.

```
git rebase -i HEAD~7
```

명령어를 실행하면 에디터가 실행된다.<br>
<br>
![git squash2](/media/gitsquash2.png)
<br>

위의 7개의 커밋중에 합칠 때 기준이 되는 커밋을 pick으로 남기고 기준이 되는 커밋에 합칠 커밋들에 s(squash)를 아래와 같이 남기면 된다. 이미지 캡처를 깜빡하여 코드로 보면 다음과 같다.

```
pick 9c86e01 group meals wip
s ded5743 wip
s c9fa287 wip
s 52c4d93 wip
s 4d5a2ad wip
s fa112d5 wip
s a79ca93 wip
```

위의 코드와 같이 변경하고 에디터를 나가면 다음과 같이 커밋 메시지를 수정할 수 있는 화면이 나타난다.

![git squash3](/media/gitsquash3.png)
<br>
나는 위 7개의 커밋을 하나의 커밋으로 합치고 싶기 때문에 위의 커밋 메시지들을 삭제하고 아래와 같이 이 브랜치에서 작업한 내역을 설명하는 하나의 커밋 메시지로 정리하였다.

![git squash4](/media/gitsquash4.png)

그리고 에디터를 저장후 나가면 아래와 같이 `successfully rebased and updated~` 라는 메시지가 뜨면 깃 스쿼시 및 리베이스 성공이다.

![git squash6](/media/gitsquash6.png)

`git log`를 찍어 확인해보면 아까 있었던 7개의 커밋메시지가 1개의 커밋 메시지로 바뀌었다.

![git squash5](/media/gitsquash5.png)

이제 깃헙의 리모트 오리진으로 이 브랜치를 푸쉬하면 된다.

```
git push -u origin feature/jumsul_logic3
```

이 이후의 과정은 깃헙에서 방금 푸쉬한 내역을 pr을 보내고 마스터에 머지를 하면 된다. 리모트 마스터에 머지가 되면 방금 푸쉬한 나의 작업 브랜치의 커밋이 마스터의 HEAD가 되어있는 것을 확인 할 수 있다.
