<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.5f9c12d5a1b22d54675d.css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:26px;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:1.125rem;font-weight:600;line-height:1.82813rem;margin:.8125rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.625rem;margin-bottom:1.625rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.625rem}.Contacts-module--contacts__list--3OgdW{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row wrap;-webkit-box-flex:0;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:-webkit-box;display:flex;align-content:center;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;height:35px;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:-webkit-box;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#5d93ff}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.875rem}.Menu-module--menu--Efbin{margin-bottom:1.625rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:1rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:-webkit-gradient(linear,left top,left bottom,from(#e6e6e6),color-stop(48%,#e6e6e6),to(#fff));background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:540px;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:52.5rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:71.5625rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:2rem;max-width:52.5rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.625rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:52.5rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:52.5rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.8125rem}.Tags-module--tags_insidebar__list--3HmL5{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags_insidebar__list-item--1mylh{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags_insidebar__list-item-link--3Xlcg{display:inline-block;height:35px;padding:0 .75rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags_insidebar__list-item-link--3Xlcg:focus,.Tags-module--tags_insidebar__list-item-link--3Xlcg:hover{color:#5d93ff}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:35px;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#5d93ff}.Feed-module--feed__item--2D5rE{margin-bottom:2.03125rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.8125rem}.Feed-module--feed__item-title--3nigr{font-size:1.6875rem;line-height:2.4375rem;margin-top:0;margin-bottom:.8125rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.875rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.875rem;color:#f7a046;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI{font-size:1rem;color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Page-module--page--2nMky{margin-bottom:3.25rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:2.5rem;font-weight:600;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.Page-module--page__body--Ic6i6{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:3.25rem;display:-webkit-box;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#5d93ff}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#5d93ff}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:52.5rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:35px;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#5d93ff}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.18.14"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script>
  window.excludeGAPaths=[/^(?:\/preview\/(?:(?!(?:\/|^)\.).)*?)$/,/^(?:\/do\-not\-track\/me\/too\/)$/];
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-151878736-1',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(!(parseInt(navigator.doNotTrack) === 1 || parseInt(window.doNotTrack) === 1 || parseInt(navigator.msDoNotTrack) === 1 || navigator.doNotTrack === "yes")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-151878736-1', 'example.com', {"sampleRate":5,"siteSpeedSampleRate":10});
      ga('set', 'anonymizeIp', true);
      ga('require', 'YOUR_GOOGLE_OPTIMIZE_TRACKING_ID');
      ga('set', 'expId', 'YOUR_GOOGLE_EXPERIMENT_ID');
      ga('set', 'expVar', 'YOUR_GOOGLE_OPTIMIZE_VARIATION_ID');
      
      }</script><link rel="alternate" type="application/rss+xml" title="Blog by saegeullee" href="/rss.xml"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-151878736-1"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-151878736-1', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/icons/icon-48x48.png?v=79359cefde70392655aaf684a9259a17"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=79359cefde70392655aaf684a9259a17"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=79359cefde70392655aaf684a9259a17"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=79359cefde70392655aaf684a9259a17"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=79359cefde70392655aaf684a9259a17"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=79359cefde70392655aaf684a9259a17"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=79359cefde70392655aaf684a9259a17"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=79359cefde70392655aaf684a9259a17"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=79359cefde70392655aaf684a9259a17"/><title data-react-helmet="true">Udacity Cloud Developer - Serverless - Blog by saegeullee</title><meta data-react-helmet="true" name="description" content="유다시티 Cloud Developer 과정에서 Serverless 파트를 듣고 정리한 부분이다."/><meta data-react-helmet="true" property="og:site_name" content="Udacity Cloud Developer - Serverless - Blog by saegeullee"/><meta data-react-helmet="true" property="og:image" content="https://saegeullee.github.io/media/image-2.jpg"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Udacity Cloud Developer - Serverless - Blog by saegeullee"/><meta data-react-helmet="true" name="twitter:description" content="유다시티 Cloud Developer 과정에서 Serverless 파트를 듣고 정리한 부분이다."/><meta data-react-helmet="true" name="twitter:image" content="https://saegeullee.github.io/media/image-2.jpg"/><link as="script" rel="preload" href="/webpack-runtime-e876f3fb06ce083dc5b9.js"/><link as="script" rel="preload" href="/netlify-identity-widget-e37a35e339457e643f79.js"/><link as="script" rel="preload" href="/app-e9f2271e56397154169d.js"/><link as="script" rel="preload" href="/styles-8f10df4b1baa09fb1b32.js"/><link as="script" rel="preload" href="/commons-744e74cbf6b5408b71f7.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-40abd2ffdee3c9623eba.js"/><link as="fetch" rel="preload" href="/page-data/serverless/serverless/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">Udacity Cloud Developer - Serverless</h1><div class="Content-module--content__body--2TrQ-"><blockquote>
<p><strong><a href="https://www.udacity.com/course/cloud-developer-nanodegree--nd9990" target="_blank" rel="nofollow noopener noreferrer">유다시티 Cloud developer 과정</a></strong> 수업을 듣고 정리한 내용입니다.</p>
</blockquote>
<h1 id="목차"><a href="#%EB%AA%A9%EC%B0%A8" aria-label="목차 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>목차</h1>
<ul>
<li><a href="#serverless%EB%9E%80">Serverless란</a></li>
<li>
<p><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4">API 게이트웨이</a></p>
<ul>
<li><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4-%ED%99%98%EA%B2%BD%EC%84%A4%EC%A0%95">API 게이트웨이 환경설정</a></li>
<li><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4-%EC%8A%A4%ED%85%8C%EC%9D%B4%EC%A7%80">API 게이트웨이 스테이지</a></li>
</ul>
</li>
<li>
<p><a href="#serverless-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC">Serverless 프레임워크</a></p>
<ul>
<li><a href="#serverless-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC-%EC%86%8C%EA%B0%9C">Serverless 프레임워크 소개</a></li>
<li><a href="#cloudformation">CloudFormation</a></li>
<li><a href="#serverless-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0">Serverless 프레임워크 사용하기</a></li>
<li><a href="#serverless-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0-%EB%8D%B0%EB%AA%A8">Serverless 프로젝트 만들기 데모</a></li>
<li><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4-%EC%9A%94%EC%B2%AD-%EC%9C%A0%ED%9A%A8%EC%84%B1-%EA%B2%80%EC%A6%9D">API 게이트웨이 요청 유효성 검증</a></li>
<li><a href="#dynamodb-%EC%BB%B4%ED%8F%AC%EC%A7%93-%ED%82%A4">DynamoDB 컴포짓 키</a></li>
<li><a href="#dyanamodb-%EC%9D%B8%EB%8D%B1%EC%8B%B1">DyanamoDB 인덱싱</a></li>
</ul>
</li>
<li>
<p><a href="#event-processing">Event Processing</a></p>
<ul>
<li><a href="#presigned-url">Presigned URL</a></li>
<li><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4--%EC%9B%B9%EC%86%8C%EC%BC%93">API 게이트웨이 : 웹소켓</a></li>
<li><a href="#serverless-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC%EC%97%90%EC%84%9C-%EC%9B%B9%EC%86%8C%EC%BC%93-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0">Serverless 프레임워크에서 웹소켓 사용하기</a></li>
<li><a href="#full-text-%EA%B2%80%EC%83%89">Full-text 검색</a></li>
<li><a href="#dynamodb-%EC%8A%A4%ED%8A%B8%EB%A6%BC">DynamoDB 스트림</a></li>
<li><a href="#%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98">엘라스틱서치</a></li>
<li><a href="#%EC%8B%AC%ED%94%8C-%EB%85%B8%ED%8B%B0%ED%94%BC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%84%9C%EB%B9%84%EC%8A%A4sns">심플 노티피케이션 서비스(SNS)</a></li>
</ul>
</li>
<li>
<p><a href="#%EC%9D%B8%EC%A6%9D">인증</a></p>
<ul>
<li><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4%EB%A1%9C-%EC%9D%B8%EC%A6%9D-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0">API 게이트웨이로 인증 구현하기</a></li>
<li><a href="#cors%EC%99%80-%EC%9D%B8%EC%A6%9D">Cors와 인증</a></li>
<li><a href="#auth0-%EC%84%9C%EB%B9%84%EC%8A%A4">Auth0 서비스</a></li>
<li><a href="#%EC%8B%9C%ED%81%AC%EB%A6%BF-%ED%82%A4-%EC%A0%80%EC%9E%A5">시크릿 키 저장</a></li>
</ul>
</li>
<li>
<p><a href="#best-practices">Best Practices</a></p>
<ul>
<li><a href="#serverless-%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EB%A1%9C%EC%BB%AC%EC%97%90%EC%84%9C-%EC%8B%A4%ED%96%89%ED%95%98%EA%B8%B0">serverless 어플리케이션 로컬에서 실행하기</a></li>
<li><a href="#serverless-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81">Serverless 모니터링</a></li>
</ul>
</li>
</ul>
<h1 id="serverless란"><a href="#serverless%EB%9E%80" aria-label="serverless란 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serverless란</h1>
<p>서비리스라는 용어는 유행어일 뿐이다. 어떤 아키텍처 패턴이나 기술을 의미하는 용어가 아니다. 서버리스는 어떤 솔루션을 의미한다. 서버리스라는 키워드를 가지고 있는 대부분의 솔루션들은 다음의 특징들을 가지고 있다.</p>
<ul>
<li>서버는 더 이상의 고려할 부분이 아님(다른 사람에 의해 관리됨)</li>
<li>스케일업, 스케일다운이 쉬움</li>
<li>사용한 만큼 비용 지불(요청이 없을 때는 비용을 지불하지 않음)</li>
<li>데이터 저장소는 예외(요청이 없더라도 데이터 저장하는 만큼 비용을 지불해야함)</li>
<li>서버 관리자가 필요없음(서비스 운영에 신경쓰지 않아도됨. 어플리케이션의 비즈니스 로직에만 집중할 수 있음)</li>
</ul>
<h3 id="서버리스의-장점"><a href="#%EC%84%9C%EB%B2%84%EB%A6%AC%EC%8A%A4%EC%9D%98-%EC%9E%A5%EC%A0%90" aria-label="서버리스의 장점 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>서버리스의 장점</h3>
<ul>
<li>낮은 진입 장벽</li>
<li>비용이 저렴함</li>
<li>높은 가용성과 확장성</li>
</ul>
<h3 id="앞으로-수업에서-배울-것들"><a href="#%EC%95%9E%EC%9C%BC%EB%A1%9C-%EC%88%98%EC%97%85%EC%97%90%EC%84%9C-%EB%B0%B0%EC%9A%B8-%EA%B2%83%EB%93%A4" aria-label="앞으로 수업에서 배울 것들 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>앞으로 수업에서 배울 것들</h3>
<ul>
<li>서버리스란 무엇인가?</li>
<li>Function as a Service(FaaS)</li>
<li>간단한 함수와 이를 이벤트에 연결하는 방법</li>
<li>함수가 실행되는 방법</li>
<li>FaaS의 장점과 단점</li>
</ul>
<h2 id="서버리스-컴포넌트"><a href="#%EC%84%9C%EB%B2%84%EB%A6%AC%EC%8A%A4-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8" aria-label="서버리스 컴포넌트 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>서버리스 컴포넌트</h2>
<p>서버리스는 하나의 기술 또는 서비스를 의미하는 것이 아니라 여러개의 컴포넌트를 통합하여 지칭하는 용어이다.</p>
<ul>
<li>Faas : 개별 함수에 코드를 작성하고 플랫폼에 배포하여 실행시키는 서비스이다. (AWS Lambda, Google Cloud Functions, Azure Functions)</li>
<li>Datastores: 데이터 스토리지(Amazon S3, Amazon DynamoDB, Firebase etc)</li>
<li>Messaging: 하나의 어플리케이션에서 다른 어플리케이션으로 메시지를 보내주는 서비스(Amazon Simple Queue Service(SQS), Amazon Kinesis, Google Pub/Sub)</li>
<li>Services: 우리가 서버를 관리하지 않아도 되는 기능들을 제공하는 모든 서비스들(인증, 머신러닝, 비디오 프로세싱, 빅데이터, 오케스트레이션 등)</li>
</ul>
<h2 id="fuction-as-a-servicefaas"><a href="#fuction-as-a-servicefaas" aria-label="fuction as a servicefaas permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fuction as a Service(FaaS)</h2>
<ul>
<li>어플리케이션을 여러 개의 작은 함수로 쪼개는 것</li>
<li>이벤트 드리븐(함수들이 외부의 이벤트 발생으로 인해 실행이 됨)</li>
<li>함수 실행당 비용 지불</li>
<li>나머지 모든 것들이 클라우드 프로바이더에 의해 핸들링 됨(서버 제공, 스케일업, 스케일다운, 설치와 업데이트, 서버 관리 등)</li>
</ul>
<h3 id="람다-함수-vs-aws-람다"><a href="#%EB%9E%8C%EB%8B%A4-%ED%95%A8%EC%88%98-vs-aws-%EB%9E%8C%EB%8B%A4" aria-label="람다 함수 vs aws 람다 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>람다 함수 VS AWS 람다</h3>
<p>AWS 람다는 AWS에서 발생하는 이벤트에 대한 응답을 코드로 실행하는 컴퓨팅 서비스를 의미하고 람다 함수는 AWS 람다에서 실행되고 이벤트 소스에 연결된 단일 함수를 의미한다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">//함수 예시(AWS Lambda)</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> number <span class="token operator">=</span> event<span class="token punctuation">.</span>number<span class="token punctuation">;</span>
  <span class="token keyword">const</span> updateNum <span class="token operator">=</span> number<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">:</span> updateNum
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>AWS 람다에 함수를 배포할 때 두가지 파라미터에 대해 생각해야 한다. 첫번째는 memory이다. 함수가 실행되며 사용할 수 있는 최대 램 용량을 의미한다. 더 많은 메모리를 지정하면 더 빠른 CPU를 사용할 수 있고 이에 따라 더 많은 비용을 지불해야 한다. 두번째는 timeout이다. 함수가 실행되는데 필요한 최대 시간을 의미한다. 파라미터로 제공한 시간이 지나면 함수는 자동 종료된다.</p>
<h3 id="aws-람다의-제한사항"><a href="#aws-%EB%9E%8C%EB%8B%A4%EC%9D%98-%EC%A0%9C%ED%95%9C%EC%82%AC%ED%95%AD" aria-label="aws 람다의 제한사항 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AWS 람다의 제한사항</h3>
<ul>
<li>함수 실행당 최대 3GB의 메모리 사용가능</li>
<li>함수는 15분 이상 실행될 수 없음</li>
<li><code class="language-text">/tmp</code> 폴더에만 파일을 쓸 수 있음(512MB 이내)</li>
<li>동시에 실행될 수 있는 함수의 개수 제한 (디폴트로 함수의 인스턴스 1000개까지 병렬적으로 실행 가능)</li>
<li>이벤트 사이즈는 6MB까지 가능(람다 함수를 동기(syncronously)로 호출할 경우 256KB까지 가능)</li>
</ul>
<p>AWS 람다 제한사항 최신 버전은 <a href="https://docs.aws.amazon.com/lambda/latest/dg/limits.html" target="_blank" rel="nofollow noopener noreferrer">여기서</a> 확인 가능</p>
<h2 id="aws-람다-이벤트"><a href="#aws-%EB%9E%8C%EB%8B%A4-%EC%9D%B4%EB%B2%A4%ED%8A%B8" aria-label="aws 람다 이벤트 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AWS 람다 이벤트</h2>
<p>람다 함수와 테스트 event 객체를 다음과 같이 구성해볼 수 있다. 테스트 event 객체는 AWS 콘솔에서 생성된 람다 함수 대시보드 안에서 Test 버튼 왼쪽의 드롭다운 메뉴에서 Configure test events를 클릭하여 테스트 이벤트 객체를 구성할 수 있다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">//람다 함수</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Event: '</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        result<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//테스트 이벤트</span>
<span class="token punctuation">{</span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Serverless"</span>
<span class="token punctuation">}</span></code></pre></div>
<h2 id="함수가-실행되는-방법"><a href="#%ED%95%A8%EC%88%98%EA%B0%80-%EC%8B%A4%ED%96%89%EB%90%98%EB%8A%94-%EB%B0%A9%EB%B2%95" aria-label="함수가 실행되는 방법 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>함수가 실행되는 방법</h2>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 825px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e3772c18b67227a1a4848e138be325e5/b66d4/aws_lambda_functions.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.18181818181818%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAAB70lEQVQoz12Sy08TURTG5/9xo/4FbqqyceHKtXHjOxqDcYGa+EIJlqTRRCK21thu1BhiaKkSkCgKPmqDglBoLdD3Q0s7TKedOz+vtw8qd/LlTr6Tc873nXM1dpx8qczk3HemJGbCPzHMuuJLZo1QPsN0ZoNQIUu6WgUhsGXMtm35KxC2QKvX6+RyeUzTVImB6S8cvfyAkzfcHL/2kGgipfgPqTX2hrwcfO5iV9BLKDwBegWxQ5BmGAbFYolGo6GI1zMRTt/ycNHp5/wdL/H1tOL1xDesYQerrh6izgOIkR70dJSGlNhomCz+irCejaO1KwvbVvfEx3lOXH/EhcGnnO33kEjlFG9sVUknl8hIpFLLVDIrWKahYlk5iiN9+xj096FZlkW5vCm7WCr4Rirsdfq4cv8Zl4b8rKw1Fc4Wcuyee8uhyZfs+TTFeCwquxiYMs+s1wi+HyWy9BlN17dIJlOdGY6/CyvLvXd9nJOWVxNJxWdiX5m95+DFgAPf7f0UPYepZWPYLYd61UTIqW1bFtuWT910dwq2LVuVAiyMIRaD2AsBxI9X1PU/KvZvy+qTt9YmLNHcV1AqPHZ1mDP9j+WWR4hvZJsNW7C70M7tFG0X7FY4v5xgwD3K0JMxXL4Ahd+brbh8c8L6H13F2h3+AqEwgHqcgMjDAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/e3772c18b67227a1a4848e138be325e5/8ac56/aws_lambda_functions.webp 240w,
/static/e3772c18b67227a1a4848e138be325e5/d3be9/aws_lambda_functions.webp 480w,
/static/e3772c18b67227a1a4848e138be325e5/0244e/aws_lambda_functions.webp 825w"
          sizes="(max-width: 825px) 100vw, 825px"
          type="image/webp"
        />
        <source
          srcset="/static/e3772c18b67227a1a4848e138be325e5/e4891/aws_lambda_functions.png 240w,
/static/e3772c18b67227a1a4848e138be325e5/0ce91/aws_lambda_functions.png 480w,
/static/e3772c18b67227a1a4848e138be325e5/b66d4/aws_lambda_functions.png 825w"
          sizes="(max-width: 825px) 100vw, 825px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/e3772c18b67227a1a4848e138be325e5/b66d4/aws_lambda_functions.png"
          alt="AWS Lambda Functions"
          title="AWS Lambda Functions"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<p>람다 함수를 실행시키기 위해 요청을 보내면, AWS 람다는 해당 함수를 실행시키기 위한 환경을 만든다. 특정 환경을 위한 컨테이너를 만들고 해당 함수 코드를 로드한다. 그리고 이 함수에 이벤트를 보낸다. 이와 같은 과정이 모든 요청에 대해 동일하게 반복된다.</p>
<p>해당 요청에 대해 함수가 실행되어 응답을 보내주고 나면 이를 위해 만들어진 환경이 곧바로 제거되는 것은 아니다. 곧 이 함수에 대해 다른 요청이 들어올 수도 있기 때문이다. 그래서 만약 이 함수에 새로운 요청을 보내면 AWS 람다는 현재 존재하는 환경을 사용할 것이다.</p>
<p>그리고 만약 오랜 시간동안 새로운 요청이 오지 않는다면, AWS 람다는 해당 환경들을 하나씩 제거하기 시작한다. 긴 시간동안 요청이 없었다면 함수를 곧바로 실행할 수 있는 환경이 없을 것이다. 따라서 새로운 요청에 응답하기 위한 새로운 환경이 만들어져야 한다.</p>
<p>위와 같이 함수는 휘발성이다. 요청에 응답하기 위해 만들어진 환경은 10분~15분 정도 유지되고 더 이상 사용되지 않으면 이는 곧 제거된다. 만약 해당 환경이 4시간정도 계속해서 사용되더라도 해당 환경을 구성하는 컨테이너는 제거되고 함수를 실행하기 위한 다른 컨테이너가 만들어진다. 이렇게 동작하는 이유는 이렇게 함으로서 함수가 항상 최신의 OS 버전과 최신 업데이트가 적용된 환경에서 서비스를 할 수 있기 때문이다.</p>
<h2 id="invocation-types구동-타입"><a href="#invocation-types%EA%B5%AC%EB%8F%99-%ED%83%80%EC%9E%85" aria-label="invocation types구동 타입 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Invocation types(구동 타입)</h2>
<p>AWS 람다 함수를 구동(실행)시킬 때, 어떤 구동 타입으로 함수를 실행시킬지 결정할 수 있다.</p>
<ul>
<li>Request/Response (Syncronous call)</li>
<li>Asyncronous invocation (Asyncronous call)</li>
<li>Using AWS CLI</li>
</ul>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">aws lambda invoke --function-name helloworld \
--invocation-type RequestResponse \
--log-type Tail --payload `{&quot;name&quot; : &quot;AWS Lambda&quot;}` \
result.txt</code></pre></div>
<p><code class="language-text">invocation-type</code>을 Event로 줘서 비동기로 실행할 수도 있다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">aws lambda invoke --function-name helloworld \
--invocation-type Event \
--log-type Tail --payload `{&quot;name&quot; : &quot;AWS Lambda&quot;}` \
result.txt</code></pre></div>
<h3 id="에러-핸들링"><a href="#%EC%97%90%EB%9F%AC-%ED%95%B8%EB%93%A4%EB%A7%81" aria-label="에러 핸들링 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>에러 핸들링</h3>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 742px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b97b3acca9041babbfee481da9fbffe0/65b75/AWS_Lambda_Error_Handling.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 50.40431266846361%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACKElEQVQoz22R2U8TYRTF+zfqoy/wQCIYdxN5QHjBYFSUREl5KipuEQ0JtiyFLsOilaULSkushbaJBil2pp0uM9OZ/vzm00ZIvMnJ/e4395w5Z8bD33Ich6OjEs1Gg3JFZ+lDiuXYDsH1JIfHqtxpt9sStth12sjuzp1nbnls20ZTNUzTJJv9hl6tEPqYovvWBBdu++ga8OKPbsply7IwTAtT16gWv0oTLv+UYEM4KuSLNOoNNE3Dtkwinz5z6c5T+sdecXHkCe8jGzh2SyawWjaGWuJXZgu71ZIuTwl2IrsXpni7W8pWmj7h7sboC3qHfcwp2/LeMEzp0hZ5XXpLCJ6M7MLj2lZFZNd6qXSM07IIi2937d4UA4/ecPXuMwLKliQ1m00aTQOjWkbLZyTHtp3Tgp3I9XqdalUX0SyiG1+4fv85g+PTsgei/wSbwqWhlThOb/4/cq1Wk2Ku8P7+ARW1zNJ6nJ5BL5dHfPQMeXk7v0Jdr1JWVfEDVbGjoes1AZ2TfPfsKRaLdFAQOPp5yLQ/RHf/A/qGHtN1c5Spd/Mc/vhO7uCA7G6GneVV2fOFAvl8nlwuRzKZpCBmTyqVooNEIsleehffyxnO9g5x7sowZ84PMj75mr1MmoQgxVbXiEzPEltZYzseF5wEsViMUChMXMyeSCRCB+FwGCUaZdY/x5h3krGJSR56fczM+llRFILBIH5/gPmFBQKBAIuLi0TFvstVlD/9NxRKwbzDQt7dAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/b97b3acca9041babbfee481da9fbffe0/8ac56/AWS_Lambda_Error_Handling.webp 240w,
/static/b97b3acca9041babbfee481da9fbffe0/d3be9/AWS_Lambda_Error_Handling.webp 480w,
/static/b97b3acca9041babbfee481da9fbffe0/28367/AWS_Lambda_Error_Handling.webp 742w"
          sizes="(max-width: 742px) 100vw, 742px"
          type="image/webp"
        />
        <source
          srcset="/static/b97b3acca9041babbfee481da9fbffe0/e4891/AWS_Lambda_Error_Handling.png 240w,
/static/b97b3acca9041babbfee481da9fbffe0/0ce91/AWS_Lambda_Error_Handling.png 480w,
/static/b97b3acca9041babbfee481da9fbffe0/65b75/AWS_Lambda_Error_Handling.png 742w"
          sizes="(max-width: 742px) 100vw, 742px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/b97b3acca9041babbfee481da9fbffe0/65b75/AWS_Lambda_Error_Handling.png"
          alt="AWS_Lambda_Error_Handling"
          title="AWS_Lambda_Error_Handling"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<p>AWS 람다에서 에러가 발생하면 어떻게 함수를 실행시켰는지에 따라 에러가 핸들링 되는 방법이 다르다.</p>
<ol>
<li>Request/Response(동기) 방법을 사용하여 함수를 실행시켰을 때 에러가 발생하면 함수를 호출한 클라이언트에게 즉시 에러를 반환한다.</li>
<li>Aync(비동기) 방법을 사용하여 함수를 실행시켰을 때 에러가 발생하면 AWS 람다는 HTTP 202(accepted) 응답을 클라이언트에게 보내주고 이 요청을 내부적으로 Queue에 저장해놓는다. 추가적으로 람다 함수를 3번 호출하고 만약 이 모든 호출에 대해 전부 에러가 발생하면 이 이벤트(요청)를 <code class="language-text">dead-letter-queue</code>에 저장해놓는다.
이 큐에는 람다 함수가 응답에 대해 처리를 못하고 실패한 모든 이벤트를 저장해놓는 공간이다.</li>
</ol>
<h2 id="플랫폼-이벤트"><a href="#%ED%94%8C%EB%9E%AB%ED%8F%BC-%EC%9D%B4%EB%B2%A4%ED%8A%B8" aria-label="플랫폼 이벤트 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>플랫폼 이벤트</h2>
<p>이제 조금 복잡한 AWS 람다 함수를 만들어본다. 이 함수를 실행시키기 위해 <code class="language-text">CloudWatch</code>라는 서비스를 이용한다. 아래의 그림과 같이 클라우드워치 서비스를 통해 AWS 람다 함수를 주기적으로 호출하는 이벤트를 발생시킬 수 있다. 이 이벤트가 발생하면 람다 함수는 현재 실행되고있는 EC2 인스턴스의 목록을 얻고 이중 하나를 랜덤하게 종료시킨다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/45c9399b70c1d70e35e95099f1750ed7/1bcd6/AWS_Lambda_complex_function.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 33.80035026269702%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABDUlEQVQoz4VR2U3DQBDdRuiCQigAiUb4owYaoAZECcAfiI8IFHAi4U2ErRBkr73ey4+ZsSKWEImRnnbnfHOocRyRg2X37ktuTykhhoDgHQK9MUbxqz9JFMjCAZGTGPTnJK1XqOsa3nvRc0kpil3dnlzg6/ldjM1iDVPW4JLBBzRlAVNpJGIe7IC+t4QenekkZqhKzC/PsX26k3xnLdTN0Rk2j2+wY8ByXmBVajRNIx1sXh7wWcyoIETnMXks75wUMIsZ7k+Poa+vRB9sD1W+LmFaM3XYtui67mfkDJbYNZExjDFio+rYVh8Ibpg6JCJFqxTmX3vEYeEEBne5I/KRdzwdiOuo/IL/Yf/ih/zfxigeGiudBdMAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/45c9399b70c1d70e35e95099f1750ed7/8ac56/AWS_Lambda_complex_function.webp 240w,
/static/45c9399b70c1d70e35e95099f1750ed7/d3be9/AWS_Lambda_complex_function.webp 480w,
/static/45c9399b70c1d70e35e95099f1750ed7/e46b2/AWS_Lambda_complex_function.webp 960w,
/static/45c9399b70c1d70e35e95099f1750ed7/83a31/AWS_Lambda_complex_function.webp 1142w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/45c9399b70c1d70e35e95099f1750ed7/e4891/AWS_Lambda_complex_function.png 240w,
/static/45c9399b70c1d70e35e95099f1750ed7/0ce91/AWS_Lambda_complex_function.png 480w,
/static/45c9399b70c1d70e35e95099f1750ed7/b7c40/AWS_Lambda_complex_function.png 960w,
/static/45c9399b70c1d70e35e95099f1750ed7/1bcd6/AWS_Lambda_complex_function.png 1142w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/45c9399b70c1d70e35e95099f1750ed7/b7c40/AWS_Lambda_complex_function.png"
          alt="AWS_Lambda_complex_function"
          title="AWS_Lambda_complex_function"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<p>이 프로젝트는 이 <a href="https://github.com/udacity/cloud-developer/tree/master/course-04/exercises/c4-demos-master/04-chaos-monkey" target="_blank" rel="nofollow noopener noreferrer">레포지토리</a>에 저장되어 있다. 이 프로젝트로 AWS 람다 함수를 만들기 위해 먼저 프로젝트 루트 디렉토리에서 <code class="language-text">npm i</code>를 하여 디펜던시를 설치하고 zip으로 압축해야 한다. 여기서 제한사항은 압축된 zip 파일은 50MB를 넘으면 안되고 압축을 푼 폴더(AWS가 압축된 폴더를 unzipp 한다)는 250MB를 넘으면 안된다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">zip -r chaos-monkey.zip .</code></pre></div>
<h2 id="추가-파라미터"><a href="#%EC%B6%94%EA%B0%80-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0" aria-label="추가 파라미터 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>추가 파라미터</h2>
<p>AWS 람다 함수는 event 외에 다른 파라미터를 받을 수 있다. 이 중에 2번째 파라미터는 아래의 예시와 같이 context이다. context는 람다 함수가 실행되고 있는 환경에 대한 정보를 제공한다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> number <span class="token operator">=</span> event<span class="token punctuation">.</span>number<span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/cbe7832e697bc6e0b4e3bf64248e8832/9926b/AWS_Lambda_Context.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 48.76543209876544%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABJUlEQVQoz42S626DMAxGef/Hm6atqrapWy/c4UcJAQLxOObSVm2lRvoUMPbJZ5xgs/2S75+dvL1/6I4+N1upayss7728usgNuq4TY2o5V5VY2yioqowMw3CT+IpYweF4krZt9QXIBPISx4nsfvfytz+I65z0fS/OuTv17hJXIIUoy/IR3GkhStNMwjBSFUWhMe+HG/CSyzOdKhBQFMUSjrLWqkOSiCfJdBDwsix1N8bwD9a89YBudkiSuhyLcYPLAYfzQQCXDtiTJF310CFF6nCEnc/VmkCbxChMV2gmTdPoP0cPgbRK8mksZrrLcGhxAWb51DZ5AP1Vu3ctH8cp4xDgAqY4zwuNR/PQiOlw3AxyT4DcO4bBXazri4ghvl+/4/CZaPsfa6oE9mkTnqkAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/cbe7832e697bc6e0b4e3bf64248e8832/8ac56/AWS_Lambda_Context.webp 240w,
/static/cbe7832e697bc6e0b4e3bf64248e8832/d3be9/AWS_Lambda_Context.webp 480w,
/static/cbe7832e697bc6e0b4e3bf64248e8832/e46b2/AWS_Lambda_Context.webp 960w,
/static/cbe7832e697bc6e0b4e3bf64248e8832/0b716/AWS_Lambda_Context.webp 1296w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/cbe7832e697bc6e0b4e3bf64248e8832/e4891/AWS_Lambda_Context.png 240w,
/static/cbe7832e697bc6e0b4e3bf64248e8832/0ce91/AWS_Lambda_Context.png 480w,
/static/cbe7832e697bc6e0b4e3bf64248e8832/b7c40/AWS_Lambda_Context.png 960w,
/static/cbe7832e697bc6e0b4e3bf64248e8832/9926b/AWS_Lambda_Context.png 1296w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/cbe7832e697bc6e0b4e3bf64248e8832/b7c40/AWS_Lambda_Context.png"
          alt="AWS_Lambda_Context"
          title="AWS_Lambda_Context"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h1 id="api-게이트웨이"><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4" aria-label="api 게이트웨이 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API 게이트웨이</h1>
<h2 id="api-게이트웨이-개념"><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4-%EA%B0%9C%EB%85%90" aria-label="api 게이트웨이 개념 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API 게이트웨이 개념</h2>
<ul>
<li>API 사용자에게 진입점</li>
<li>다른 서비스에게 요청을 전달</li>
<li>요청을 처리</li>
</ul>
<p>Api 게이트웨이는 사용자가 보낸 HTTP 요청을 받아 이벤트로 변환하여 람다 함수를 호출하는 역할을 한다. 그리고 호출된 람다 함수가 비즈니스 로직을 수행한다. 뿐만 아니라 중간에서 인증, 보안, 로깅 캐싱 등의 역할을 수행 할 수도 있다.<br>
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 844px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/32000ef09b80ea613a8ba2ecd863e11d/e9777/AWS_API_GATEWAY.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 42.89099526066351%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABsElEQVQoz42Qy27TQBiF/UYseQPEkg1CYokAiQVskVgieALEK4BQEWwpUECBxEmbUrfEsZ0gxb0kju3cHDuJb/HH2A1R0w0c6Wj+/8x/OTMSK2RZtj4vMl0xxzKJ13V/kaQZnh8TzJMily4PWC9gE9HMZ6DKzPpmUZckaaFvl3rcePCdh09/shS6xGUsl2SzOVkUFembzpgX+pBkZGMrJcbtw2JYGMbF2ncfTK7f+cq9J7ukwq20WCzwPA+r22Us4vHnL3Ru3iZ99pxXhsO1HZOP3em5S39CGs43vsgdhZTqAxRtUiyQHHdAJNwE3pR8Z/f1FvUrV/Hu3ufl4RmPD/p5N/8LKY5jYTUtmLcF5jG9rfcEP8q0RgG3vnV4JJ+QBR52c5dp/5RI9OQmEtEz6dlYjTaDzpnIE+HQcchp57Rt8YQRw3CB4/v4Q5ep62BaNseGivrpLS15B8uy6IkvskT9b6WBVqrR3lNwXBdJ13UuUtM0NFVFbzZp5rGm0zYMdBH/qldpKPsYRquoNVoGqnLEQbnK0d5+oUmVSoV/sbw65WoNWa5u3ssyck3o1XP9D9COkgp0NLsaAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/32000ef09b80ea613a8ba2ecd863e11d/8ac56/AWS_API_GATEWAY.webp 240w,
/static/32000ef09b80ea613a8ba2ecd863e11d/d3be9/AWS_API_GATEWAY.webp 480w,
/static/32000ef09b80ea613a8ba2ecd863e11d/20d15/AWS_API_GATEWAY.webp 844w"
          sizes="(max-width: 844px) 100vw, 844px"
          type="image/webp"
        />
        <source
          srcset="/static/32000ef09b80ea613a8ba2ecd863e11d/e4891/AWS_API_GATEWAY.png 240w,
/static/32000ef09b80ea613a8ba2ecd863e11d/0ce91/AWS_API_GATEWAY.png 480w,
/static/32000ef09b80ea613a8ba2ecd863e11d/e9777/AWS_API_GATEWAY.png 844w"
          sizes="(max-width: 844px) 100vw, 844px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/32000ef09b80ea613a8ba2ecd863e11d/e9777/AWS_API_GATEWAY.png"
          alt="AWS_API_GATEWAY"
          title="AWS_API_GATEWAY"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h3 id="api-게이트웨이-타입"><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4-%ED%83%80%EC%9E%85" aria-label="api 게이트웨이 타입 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API 게이트웨이 타입</h3>
<p>아마존 API 게이트웨이에는 두가지 종류가 있다.</p>
<ul>
<li>REST API</li>
<li>WebSocket API</li>
</ul>
<h3 id="api-게이트웨이의-기능들"><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4%EC%9D%98-%EA%B8%B0%EB%8A%A5%EB%93%A4" aria-label="api 게이트웨이의 기능들 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API 게이트웨이의 기능들</h3>
<ul>
<li>Serverless</li>
<li>모니터링 기능을 제공</li>
<li>인증</li>
<li>쓰로틀링(throttling)</li>
<li>Web Application Firewall(WAF)와 통합</li>
<li>커스텀 도메인 네임 사용 가능</li>
</ul>
<h2 id="api-게이트웨이-환경설정"><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4-%ED%99%98%EA%B2%BD%EC%84%A4%EC%A0%95" aria-label="api 게이트웨이 환경설정 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API 게이트웨이 환경설정</h2>
<h3 id="엔드포인트-타입"><a href="#%EC%97%94%EB%93%9C%ED%8F%AC%EC%9D%B8%ED%8A%B8-%ED%83%80%EC%9E%85" aria-label="엔드포인트 타입 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>엔드포인트 타입</h3>
<p>API 게이트웨이를 사용하여 REST API를 만들 때 각 리소스가 어떤 람다 함수를 호출해야 하는지에 대한 정의뿐만 아니라 엔드포인트 타입도 같이 정의해야 한다.</p>
<ul>
<li>엔드포인트 타입은 API 당 설정을 해야 한다. (리소스나 메서드 당 설정 X)</li>
<li>API 게이트웨이에는 3가지 엔드포인트 타입이 있다.</li>
<li>이 중 2가지가 public 인데 <code class="language-text">Edge optimized</code>와 <code class="language-text">Regional</code>이 있다.</li>
<li>이 중 다른 한가지는 private VPC인데 외부에서 접근이 불가능한 타입이다.</li>
<li>만약 <code class="language-text">Edge optimized</code> 엔드포인트 타입을 선택하고 API를 특정 지역(region)에 배포하면, AWS는 자동으로 CloudFront를 생성해준다. 그럼 모든 요청은 먼저 이 CloudFront를 거쳤다가 API 게이트웨이로 간다.</li>
<li><code class="language-text">Regional</code> 엔드포인트 타입은 사용자의 요청이 CloudFront를 거치지 않고 곧바로 API 게이트웨이로 간다.</li>
</ul>
<h3 id="lambda-integration-modes람다-통합-모드"><a href="#lambda-integration-modes%EB%9E%8C%EB%8B%A4-%ED%86%B5%ED%95%A9-%EB%AA%A8%EB%93%9C" aria-label="lambda integration modes람다 통합 모드 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Lambda Integration Modes(람다 통합 모드)</h3>
<p>람다 함수를 배포하기 전에 고려해야 할 사항은 어떤 데이터 포맷이 API 게이트로부터 람다 함수에 전달되는지에 대한 것이다. 이 데이터 포맷은 어떤 통합 모드를 선택하는지에 따라 달렸다.
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 847px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/71b1df992fcdbdfaad3b4ec1230fa4ff/22cd6/Lambda_Integration_Modes.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 45.45454545454545%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAAB4ElEQVQoz22Sy08TURSH+0+6NxIx4CNqTHRjXPjAmLhxY0NQCEajiZGNcSFFUQlqYICAQsGiFS0zHTrvd6e3n/dOsWrj3dzJ75z7O+d8Z0rdbpfBs9+0WNr6xkq1jh9EfT3LMnzfx7Is0jTtifJ9W3SphQnKqfQ7Oc/zwyTB+MxrHh0Z4s7wJSrru/24bdvo+zqGbqDrOnEco1zCKGS1vosQgpISdb2J4zhFkuvYlJ9WuHv8ImPnrjOrVQtDVSxJEsymWZiqfKXlsjv76ybOyhypY1JK0wzP8/l78PvP5jhx+zHDN6d583Gjb9jpdIiSFC8IieU71XU7l1rLwP6yRhY4f0Y+xNEznHnFmRuTjF6dYGG12o/HkeQZBfIjRAQuQhYYPH1DVb0tKyook9Lw9NgUo9fu8U7bopNnWK0WLbmgqW2ThztNHuyYWH4oEcnR44i2b6MWLBkm6EZTBtyCjSvBT0iGZ29Nc0p2Ob/0SXYWYJkmP2yfkQ8NLmgNzmsGDdsj8APM2meM5Qqpe6AYSiaeV2xIiN7M5ScvGboyztHLZWYX1xB5G0928tMJOLbwnZPv64ws7hWGURjhmw3sbY3MswYZ9gw3a3s8n1/mxVsN48D5Jx7LJSS5KO7//cO/AE5ClSOBLt1nAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/71b1df992fcdbdfaad3b4ec1230fa4ff/8ac56/Lambda_Integration_Modes.webp 240w,
/static/71b1df992fcdbdfaad3b4ec1230fa4ff/d3be9/Lambda_Integration_Modes.webp 480w,
/static/71b1df992fcdbdfaad3b4ec1230fa4ff/8a8c4/Lambda_Integration_Modes.webp 847w"
          sizes="(max-width: 847px) 100vw, 847px"
          type="image/webp"
        />
        <source
          srcset="/static/71b1df992fcdbdfaad3b4ec1230fa4ff/e4891/Lambda_Integration_Modes.png 240w,
/static/71b1df992fcdbdfaad3b4ec1230fa4ff/0ce91/Lambda_Integration_Modes.png 480w,
/static/71b1df992fcdbdfaad3b4ec1230fa4ff/22cd6/Lambda_Integration_Modes.png 847w"
          sizes="(max-width: 847px) 100vw, 847px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/71b1df992fcdbdfaad3b4ec1230fa4ff/22cd6/Lambda_Integration_Modes.png"
          alt="Lambda_Integration_Modes"
          title="Lambda_Integration_Modes"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span>
두가지 통합 모드가 있다.</p>
<ul>
<li>Proxy: 모든 요청 정보를 람다 함수로 전달한다. 사용하기 쉬움</li>
<li>Non-proxy: 사용자로부터 들어오는 요청을 <code class="language-text">Velocity Template Language</code>를 사용하여 변환하여 전달한다.</li>
</ul>
<h2 id="api-게이트웨이-스테이지"><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4-%EC%8A%A4%ED%85%8C%EC%9D%B4%EC%A7%80" aria-label="api 게이트웨이 스테이지 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API 게이트웨이 스테이지</h2>
<p>API 게이트웨이 스테이지는 구현된 REST API의 라이프사이클 상태에 대한 논리적 참조이다.
(API Gateway Stage is a logical reference to a lifecycle state of the REST API implementation.)</p>
<p>예를들어, REST API에는 여러가지 스테이지가 있을 수 있는데 개발자들이 사용하는 dev 스테이지가 있을 수 있고, 배포 전에 테스트를 위한 staging 스테이지가 있을 수 있고, 실제 사용자들이 사용하는 prod 스테이지가 있을 수 있다.</p>
<p>각 스테이지들은 아래의 그림처럼 서로 다른 URL을 가진다. 중요한 점은 각 스테이지들은 서로 다른 람다 함수 버전을 사용한다는 것이다.
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 808px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/c6eaadbafaddd5c5fcd58b7228f5065f/38b39/API_GATEWAY_STAGES.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.90594059405941%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABgElEQVQoz3VSPUvDUBQNuAtOzk5uDv4SF0dnQVwER0dFFLq5dBCcFBxUFGdHESoKNba0WO1H2lhjk+arL8lLjve92jYpeuHkXm4u557DfUqSJBAhskAcx0j3NMPER7eHOqHvekjHaC5dK7L4xYRoONS0PMydqZg9L0M5ecHOo0bdCIwnsLttmLUiGAsIbEyqyIIQpzZzUsnDEDYLka9aOCIclnp4MAZymscJQuaDWQY45xIZQlfX4WqabEZRhJDIJLGoHRvMdcA9Z5h5jL9iYpnU1NY30VhZhWuaCIhMEsYcjZ6NxcsSFq4qmDl9xd4TLU1CBCPL7yrNTwRIheLTyh9DO8ghGAwQkqqRBSeIsK8a2FW/sf38hTvdG1omMaHvwjc6UrE4ZMZyOsRPsTESpAkNu30EtkXZBvc9/BeZK0tkngskWct0sHxTwdLtG+YvqsgVdeqLK8dwSJ1VL9PyacupN4ipus8ibBU62CjoWLtv47ppjy0Hng33s0lHzF75B1REqiGZkUH/AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/c6eaadbafaddd5c5fcd58b7228f5065f/8ac56/API_GATEWAY_STAGES.webp 240w,
/static/c6eaadbafaddd5c5fcd58b7228f5065f/d3be9/API_GATEWAY_STAGES.webp 480w,
/static/c6eaadbafaddd5c5fcd58b7228f5065f/2b269/API_GATEWAY_STAGES.webp 808w"
          sizes="(max-width: 808px) 100vw, 808px"
          type="image/webp"
        />
        <source
          srcset="/static/c6eaadbafaddd5c5fcd58b7228f5065f/e4891/API_GATEWAY_STAGES.png 240w,
/static/c6eaadbafaddd5c5fcd58b7228f5065f/0ce91/API_GATEWAY_STAGES.png 480w,
/static/c6eaadbafaddd5c5fcd58b7228f5065f/38b39/API_GATEWAY_STAGES.png 808w"
          sizes="(max-width: 808px) 100vw, 808px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/c6eaadbafaddd5c5fcd58b7228f5065f/38b39/API_GATEWAY_STAGES.png"
          alt="API_GATEWAY_STAGES"
          title="API_GATEWAY_STAGES"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h2 id="dynamodb-with-nodejs"><a href="#dynamodb-with-nodejs" aria-label="dynamodb with nodejs permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DynamoDB with Node.js</h2>
<ul>
<li>AWS는 두 개의 DynamoDB 클라이언트를 제공한다.</li>
<li>AWS.DynamoDB는 로우레벨 클라이언트이다.</li>
<li>AWS.DynamoDB.DocumentClient는 하이레벨 클라이언트이다.</li>
</ul>
<p>Nodejs에서 DynamoDB를 사용하기 위해서는 먼저 DynamoDB 인스턴스를 만들어야한다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> docClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AWS<span class="token punctuation">.</span>DynamoDB<span class="token punctuation">.</span>DocumentClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
<span class="token comment">// 콜백 패턴</span>
docClient<span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  TableName<span class="token punctuation">:</span> <span class="token string">"Users"</span><span class="token punctuation">,</span>
  Limit<span class="token punctuation">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">//Process data or error</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 프로미스 패턴</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> docClient<span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  TableName<span class="token punctuation">:</span> <span class="token string">"Users"</span><span class="token punctuation">,</span>
  Limit<span class="token punctuation">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h1 id="serverless-프레임워크"><a href="#serverless-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC" aria-label="serverless 프레임워크 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serverless 프레임워크</h1>
<p>서버리스 어플리케이션을 배포하기 위해 필요한 것들은 다음과 같다. </p>
<ul>
<li>람다 함수</li>
<li>API 게이트웨이 설정</li>
<li>여러가지 다른 자원들 준비(DB, S3 버켓, IAM 정책 등)</li>
<li>위의 모든 것들 연결</li>
<li>코드 패키징</li>
<li>배포</li>
</ul>
<p><code class="language-text">AWS Console</code>을 사용하여 모든것을 하나씩 일일이 하는 것은 큰 소요가 든다. 서버리스 프레임워크를 사용하면 이 모든것을 간단히 해결할 수 있다.</p>
<h2 id="serverless-프레임워크-소개"><a href="#serverless-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC-%EC%86%8C%EA%B0%9C" aria-label="serverless 프레임워크 소개 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serverless 프레임워크 소개</h2>
<ul>
<li>어플리케이션을 배포하는 표준화된 방법</li>
<li>필요한 자원들을 생성해줌</li>
<li>
<p>어플리케이션을 관리해줌</p>
<ul>
<li>어플리케이션 제거, 함수 호출, 어플리케이션 로컬에서 실행 등</li>
</ul>
</li>
</ul>
<p>서버리스 프레임워크 종류는 여러가지가 있다.</p>
<ul>
<li>서버리스 프레임워크</li>
<li>Zappa (python only)</li>
<li>Serverless Application Model(SAM)</li>
</ul>
<p>이 중 이 수업에서는 첫번째인 서버리스 프레임워크를 사용한다. 서버리스 프레임워크는 이중 가장 유명하고 여러개의 플러그인을 사용할 수 있고 큰 커뮤니티가 있다.</p>
<p>서버리스 프레임워크는 다음의 클라우드 프로바이더들과 함께 사용할 수 있다.</p>
<ul>
<li>AWS</li>
<li>Microsoft Azure</li>
<li>Google Cloud Platform</li>
<li>Kubeless</li>
<li>IBM OpenWhisk</li>
<li>ETC</li>
</ul>
<h2 id="yaml"><a href="#yaml" aria-label="yaml permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>YAML</h2>
<ul>
<li>서버리스 프레임워크의 환경설정은 YAML 포맷으로 구성된다.</li>
<li>YAML 포맷은 흔한 환경설정 파일 포맷이다.</li>
<li>
<p>JSON의 수퍼셋이다.</p>
<ul>
<li>유효한 JSON 파일은 유효한 YAML 파일이다.</li>
<li>YAML은 추가적인 기능을 제공한다.</li>
<li>YAML은 JSON보다 더 간결한 포맷이다.</li>
</ul>
</li>
<li>스페이스로 인덴테이션을 구분한다. (JSON에서는 컬리 브라켓으로 구분)</li>
</ul>
<h3 id="yaml-format-vs-json-format"><a href="#yaml-format-vs-json-format" aria-label="yaml format vs json format permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>YAML Format vs JSON Format</h3>
<p>다음에서 YAML 포맷과 JSON 포맷의 비교한 것을 확인해볼 수 있다. 두 파일은 동일한 의미를 나타낸다.</p>
<p>YAML Format</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># YAML 파일에서는 주석을 달 수 있다.</span>

<span class="token comment"># 키와 값에 string quotation 을 달지 않아도 된다.</span>
<span class="token key atrule">key</span><span class="token punctuation">:</span> value

<span class="token comment"># Yaml 에서는 배열을 다음과 같이도 표현할 수 있다.</span>
<span class="token key atrule">array</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token number">1</span>
  <span class="token punctuation">-</span> <span class="token number">2</span>

<span class="token key atrule">objects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Jack
    <span class="token key atrule">suname</span><span class="token punctuation">:</span> Brown
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Joe</code></pre></div>
<p>JSON Format</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"key"</span><span class="token operator">:</span><span class="token string">"value"</span><span class="token punctuation">,</span>

  <span class="token property">"array"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

  <span class="token property">"objects"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Jack"</span><span class="token punctuation">,</span>
      <span class="token property">"surname"</span><span class="token operator">:</span> <span class="token string">"Brown"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Joe"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p>YAML Format</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">complex</span><span class="token punctuation">:</span>
  <span class="token key atrule">nested</span><span class="token punctuation">:</span>
    <span class="token key atrule">key1</span><span class="token punctuation">:</span> value1
    <span class="token key atrule">key2</span><span class="token punctuation">:</span> value2
  <span class="token key atrule">anotherNested</span><span class="token punctuation">:</span>
    <span class="token key atrule">key</span><span class="token punctuation">:</span> value</code></pre></div>
<p>JSON Format</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"complex"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"nested"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"key1"</span><span class="token operator">:</span> <span class="token string">"value1"</span><span class="token punctuation">,</span>
      <span class="token property">"key2"</span><span class="token operator">:</span> <span class="token string">"value2"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"anotherNested"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"value"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h3 id="serverless-프레임워크-컨셉"><a href="#serverless-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC-%EC%BB%A8%EC%85%89" aria-label="serverless 프레임워크 컨셉 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serverless 프레임워크 컨셉</h3>
<p>서버리스 프레임워크를 사용하여 어플리케이션을 만들려면 다음의 컴포넌트들을 사용해야 한다. 이 모든 것들을 조합하여 하나의 서비리스 어플리케이션을 만들 수 있다.
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 853px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/05da8311cd88edb31db1cdb4550e1e46/3eaa1/serverless_framework_concept.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 45.72098475967175%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABrElEQVQoz21STW/TQBD1Ge6o0D8AvwWOqXruL+n/qMSVAxygSEGcKqRUQoBUcUFIDYpR46ydOLHjXdu73g8/ZjdxSwUrPXv3zZs341lHoKXbGoLFcNYgrL6HcT1Etka35TvOOWhtkG8adJ3X9YEWRmH87QvmcxbOkX/YpkL58ytgNPaOlGTByxpaDRyIc/j+Y4lGDoUppTc4ffUeF1fXO0MpJTabDfI8D29rbQiUZYk0W4ILsTfrwBhDmuZYLldQSgWebyvcJClWRRkqRG3bBiFjKbIsuzX05oskQVVV4ewN5jdz0qRIiPeN+FVQ4Xg2w5oa6mlUkTEGDZlKqcKMdskdOOfotB5GGvYVcb7joTtNuVXFIUSNdl8gwn+WIyHfbml+6i/SQTZNiN1xFm1NBaihgY8sCVvqbIA0FkJ2KLjAmm64oRuttQ1Q1oX4Tucg6EtK0UDRH9ES772il9MCD15PcXge4+DtDAfvPGI8Pvf4Hc7PxjGeEh75+K3mTveE9g/f/MLZdYHo44Lj+acEx5cMR5cLHE3uY0Q4+cwCRpN/4x7HlPeCPD4kHH8AOhKRYxx1wnQAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/05da8311cd88edb31db1cdb4550e1e46/8ac56/serverless_framework_concept.webp 240w,
/static/05da8311cd88edb31db1cdb4550e1e46/d3be9/serverless_framework_concept.webp 480w,
/static/05da8311cd88edb31db1cdb4550e1e46/d8b1f/serverless_framework_concept.webp 853w"
          sizes="(max-width: 853px) 100vw, 853px"
          type="image/webp"
        />
        <source
          srcset="/static/05da8311cd88edb31db1cdb4550e1e46/e4891/serverless_framework_concept.png 240w,
/static/05da8311cd88edb31db1cdb4550e1e46/0ce91/serverless_framework_concept.png 480w,
/static/05da8311cd88edb31db1cdb4550e1e46/3eaa1/serverless_framework_concept.png 853w"
          sizes="(max-width: 853px) 100vw, 853px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/05da8311cd88edb31db1cdb4550e1e46/3eaa1/serverless_framework_concept.png"
          alt="serverless_framework_concept"
          title="serverless_framework_concept"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h3 id="serverless-프로젝트-구조"><a href="#serverless-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EA%B5%AC%EC%A1%B0" aria-label="serverless 프로젝트 구조 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serverless 프로젝트 구조</h3>
<p>/node_modules</p>
<ul>
<li>plugins, prod. and dev. dependencies
/src</li>
<li>function.js
serverless.yml</li>
</ul>
<p>package.json</p>
<p>package-lock.json</p>
<h2 id="serverless-프레임워크-어플리케이션"><a href="#serverless-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC-%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98" aria-label="serverless 프레임워크 어플리케이션 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serverless 프레임워크 어플리케이션</h2>
<h3 id="serverlessyml-파일-구조"><a href="#serverlessyml-%ED%8C%8C%EC%9D%BC-%EA%B5%AC%EC%A1%B0" aria-label="serverlessyml 파일 구조 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serverless.yml 파일 구조</h3>
<ul>
<li>Provider - 프로파이더 특정 설정</li>
<li>Functions - 서비스에서 사용할 함수</li>
<li>Plugins - 서버리스 프레임워크를 확장할 플러그인</li>
<li>Resources - 추가적인 클라우드 리소스</li>
</ul>
<h3 id="serverlessyml---provider-환경설정"><a href="#serverlessyml---provider-%ED%99%98%EA%B2%BD%EC%84%A4%EC%A0%95" aria-label="serverlessyml   provider 환경설정 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serverless.yml - Provider 환경설정</h3>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">service</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> serverless<span class="token punctuation">-</span>app

<span class="token key atrule">provider</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> aws
  <span class="token key atrule">runtime</span><span class="token punctuation">:</span> nodejs8.10
  <span class="token key atrule">region</span><span class="token punctuation">:</span> <span class="token string">'us-east-1'</span>
  <span class="token comment"># 환경변수 적용, 모든 함수에서 여기에 정의하는 환경변수를 사용할 수 있음</span>
  <span class="token key atrule">environment</span><span class="token punctuation">:</span>
    <span class="token key atrule">GROUPS_TABLE</span><span class="token punctuation">:</span> Groups</code></pre></div>
<h3 id="serverlessyml---리소스와-플러그인"><a href="#serverlessyml---%EB%A6%AC%EC%86%8C%EC%8A%A4%EC%99%80-%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8" aria-label="serverlessyml   리소스와 플러그인 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serverless.yml - 리소스와 플러그인</h3>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">plugins</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> serverless<span class="token punctuation">-</span>webpack

<span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token key atrule">Resources</span><span class="token punctuation">:</span>
    <span class="token comment"># CloudFormation 정의 YAML 파일</span></code></pre></div>
<p>서버리스 프레임워크는 여러개의 플러그인을 사용하여 기능을 확장할 수 있다. 이 수업에서는 몇가지 유명한 플러그인을 사용할 예정이다.</p>
<ul>
<li>프로젝트를 위해 사용할 플러그인들은 <a href="https://www.serverless.com/plugins/" target="_blank" rel="nofollow noopener noreferrer">플러그인 카탈로그</a> 에서 확인해볼 수 있다.</li>
<li>만약 필요한 플러그인을 찾지 못했다면, 나만의 플러그인을 직접 만들 수도 있다.</li>
</ul>
<h3 id="serverlessyml---함수-환경설정"><a href="#serverlessyml---%ED%95%A8%EC%88%98-%ED%99%98%EA%B2%BD%EC%84%A4%EC%A0%95" aria-label="serverlessyml   함수 환경설정 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serverless.yml - 함수 환경설정</h3>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">functions</span><span class="token punctuation">:</span>
  <span class="token comment"># 람다 함수 이름</span>
  <span class="token key atrule">GetOrders</span><span class="token punctuation">:</span>
    <span class="token comment"># src/orders까지는 파일 경로이다. handler는 자바스크립트 함수 이름이다.</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> src/orders.handler
    <span class="token comment"># 위의 함수를 실행시키는 이벤트를 정의한다.</span>
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">method</span><span class="token punctuation">:</span> get
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /shop/orders</code></pre></div>
<h3 id="지원되는-이벤트"><a href="#%EC%A7%80%EC%9B%90%EB%90%98%EB%8A%94-%EC%9D%B4%EB%B2%A4%ED%8A%B8" aria-label="지원되는 이벤트 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>지원되는 이벤트</h3>
<p>서버리스 프레임워크에는 여러가지 이벤트가 지원된다.</p>
<ul>
<li>API 게이트웨이 - REST/WebSocket API</li>
<li>SQS - Simple Queue Service</li>
<li>Alexa</li>
<li>CloudWatch Events - 스케줄링 이벤트</li>
<li>CloudWatch Logs - 프로세스 로그 이벤트</li>
<li>SNS - Simple Notification Service</li>
<li>ETC</li>
</ul>
<p>더 많은 이벤트들에 대해 알고 싶다면 <a href="https://www.serverless.com/framework/docs/providers/aws/events/apigateway/" target="_blank" rel="nofollow noopener noreferrer">여기서</a> 서버리스 프레임워크가 지원하는 모든 이벤트의 목록을 확인해볼 수 있다.</p>
<h3 id="서버리스-프레임워크가-하는-일"><a href="#%EC%84%9C%EB%B2%84%EB%A6%AC%EC%8A%A4-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC%EA%B0%80-%ED%95%98%EB%8A%94-%EC%9D%BC" aria-label="서버리스 프레임워크가 하는 일 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>서버리스 프레임워크가 하는 일</h3>
<p>서버리스 프레임워크는 개발자가 정의한 <code class="language-text">Serverless.yml</code> 파일을 사용하여 <code class="language-text">CloudFormation 템플릿</code>을 만든다. 이 템플릿은 AWS에서 CloudFormation 서비스를 사용하기 위한 템플릿이다. 이를 사용하여 CloudFormation 서비스에 배포하면 AWS ClodFormation 은 이 어플리케이션과 어플리케이션이 구동하기 위한 인프라스트럭쳐를 만들고 업데이트 한다. 따라서 서버리스 프레임워크를 사용하는 방법을 이해하기 위해서는 먼저 CloudFormation 을 사용하는 방법과 CloudFormation 템플릿을 작성하는 방법을 알아야 한다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 926px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d4308a5b473d54410b73fd4f2abfa820/8923f/Serverless_Framwork_nutshell.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 30.6695464362851%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABZ0lEQVQY012PuUoDURSGry8g6OtYWImljTaC+ghioYWpLKzcEFzAKLhEEQWt3RKDKO4WbklciCaZZCRoZiazMSafd+KCeuDjP5zzn3PuFZrrkShY3Bds4m8WqunyHaVSmULW4TUjSTsUci5lWfuO91cNL6XipV8qWrJsRM+5igglqF1/RCzfU7f5hGXaFB2D5KVGsCXDXEeW2XaFmVaFdNxAs3R0zcDsHMVpCmC39eM2dmOHNhDzD2/Ub6do3svQEEkTuFD9t/n3cRSXSF+eg6E8+4N5ov15vBf/B560SCbXIDAFA0vQPU45fIZIFV22Mzq7WaNCNGcQyRV/2MrqbMn+psTPw7K2mzMrvbBqsiNnIorOhmLwbHmIrsMUIniFWLhBzP1i9pqqxVtqVmJUS2pWY9RKFaHP3h/vwi1i+oreY7krHEsyfBhn/DjB2D8mT+4Int4x9aU+EzL/4ztKVGZH5I5oPMkHbaCLlAKMhicAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/d4308a5b473d54410b73fd4f2abfa820/8ac56/Serverless_Framwork_nutshell.webp 240w,
/static/d4308a5b473d54410b73fd4f2abfa820/d3be9/Serverless_Framwork_nutshell.webp 480w,
/static/d4308a5b473d54410b73fd4f2abfa820/dafe9/Serverless_Framwork_nutshell.webp 926w"
          sizes="(max-width: 926px) 100vw, 926px"
          type="image/webp"
        />
        <source
          srcset="/static/d4308a5b473d54410b73fd4f2abfa820/e4891/Serverless_Framwork_nutshell.png 240w,
/static/d4308a5b473d54410b73fd4f2abfa820/0ce91/Serverless_Framwork_nutshell.png 480w,
/static/d4308a5b473d54410b73fd4f2abfa820/8923f/Serverless_Framwork_nutshell.png 926w"
          sizes="(max-width: 926px) 100vw, 926px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/d4308a5b473d54410b73fd4f2abfa820/8923f/Serverless_Framwork_nutshell.png"
          alt="Serverless_Framwork_nutshell"
          title="Serverless_Framwork_nutshell"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h2 id="cloudformation"><a href="#cloudformation" aria-label="cloudformation permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CloudFormation</h2>
<ul>
<li>AWS 리소스들을 만들고 관리할 수 있는 서비스이다.</li>
<li>
<p>선언적이다.(Declarative) (인프라스트럭쳐를 어떻게 업데이트하고 싶은지에 대한 정의를 할 필요가 없다. 만들고 싶은 최종 상태(end state)만 정의해주면 된다. ??)</p>
<ul>
<li>YAML/JSON 설정 파일을 작성한다.</li>
<li>CloudFormation 이 이 파일을 읽고 AWS 리소스들의 상태를 업데이트한다.</li>
<li>인프라스트럭쳐를 Version Control 할 수 있다.</li>
</ul>
</li>
<li>
<p>무료 서비스이다.</p>
<ul>
<li>CloudFormation을 통해 생성되는 리소스들에 대한 비용만 지불하면 된다.</li>
</ul>
</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 843px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/00603e174152ffd605bd4b7508f0312e/d619d/CloudFormation_process.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 45.90747330960854%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABh0lEQVQoz51Qy07CUBDt77hz5S/4B65c+AV8iGvjyp1xpws3JG6AICTSkjZBoaUQHi1iaeVNS9/HuaWBijtvcjKvc2bmDhfHMaIU7LE4QepHQUgIEEcRjt+em9Fyx4RD8EePKAwR0ICQ7C9uok0bhlGM7sKGttokhYDIruuC7eOOLWh3z+jfPsJWNTiBB7nZgmVZCXe79bFebRFFmQ0dmnjT6OFBGSKmZovFEtpgiLXnwigIKJ9doXhyAe0+j2XgoqOoMAwD9saB3P6C9DGiAavdD+gsnEGFXJHHtdCERw2TSem9ZnwTb+c5vJ5eYvxU2InYTanOtukPviG967Bt77DhxnFQajTBt7vwfJ9uFMAnG5LI0seQX8po5Uv4VHsIScBqfsqbz+cY6SN4rrfPc+weU3OSgPmmacIka5GdMMymmMynMFiewDjsy3JLRqVSQbVShSRK0HU9qXGqqkLtdHZgfgYdhnaKTF5RFLSooSiKEAQBsiwnYDWO53n8F6xZvV7fx7VaDT9wZ5jnYHs1nwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/00603e174152ffd605bd4b7508f0312e/8ac56/CloudFormation_process.webp 240w,
/static/00603e174152ffd605bd4b7508f0312e/d3be9/CloudFormation_process.webp 480w,
/static/00603e174152ffd605bd4b7508f0312e/e3019/CloudFormation_process.webp 843w"
          sizes="(max-width: 843px) 100vw, 843px"
          type="image/webp"
        />
        <source
          srcset="/static/00603e174152ffd605bd4b7508f0312e/e4891/CloudFormation_process.png 240w,
/static/00603e174152ffd605bd4b7508f0312e/0ce91/CloudFormation_process.png 480w,
/static/00603e174152ffd605bd4b7508f0312e/d619d/CloudFormation_process.png 843w"
          sizes="(max-width: 843px) 100vw, 843px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/00603e174152ffd605bd4b7508f0312e/d619d/CloudFormation_process.png"
          alt="CloudFormation_process"
          title="CloudFormation_process"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h3 id="cloudformation-템플릿을-사용하여-정의"><a href="#cloudformation-%ED%85%9C%ED%94%8C%EB%A6%BF%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%98%EC%97%AC-%EC%A0%95%EC%9D%98" aria-label="cloudformation 템플릿을 사용하여 정의 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CloudFormation 템플릿을 사용하여 정의</h3>
<p>CloudFormation 템플릿을 사용하여 다음이 것들을 정의할 수 있다. 이 수업에서는 이 중 <code class="language-text">Resources</code>만 사용한다.</p>
<ul>
<li>Parameters - 어플리케이션의 실행에 대한 환경설정</li>
<li>Resources - 만들고 싶은 리소스들의 목록</li>
<li>Conditions - 특정 리소스를 언제 생성할지에 대한 정의</li>
<li>Output - CloudFormation 템플릿 실행후 어떤 값들이 응답으로 반환되어야 하는지에 대한 정의</li>
</ul>
<h3 id="cloudformation-리소스-정의"><a href="#cloudformation-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%A0%95%EC%9D%98" aria-label="cloudformation 리소스 정의 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CloudFormation 리소스 정의</h3>
<p>다음은 CloudFormation을 활용하여 AWS DynamoDB 리소스를 정의하는 예시이다. 다음 그림처럼 AWS DynamoDB의 GUI를 활용하여 테이블을 정의할 수 있지만 CloudFormation 을 활용하면 다음의 Yaml 파일에서도 정의할 수 있다.
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 846px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/db5e324e783586096f431e332694df55/7a2f6/CloudFormation_resources.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.21749408983451%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABbklEQVQoz11Si1LDMAzb/38jx4BudE3TpI+kbfoSUmA9wHc+9+HIkpzLuq7Ytg3HceB36P2ZihgjvPNwjcMwDFiWBSmlnMIIQ8jfL33XsdEhhph/6qDq/+j7HtfrFUVxQ21q2LpB0zTo2i6nzs/zjIuaO4Lamk1sdNaiYUZOCyFgmqaTZZoT+q7P9diP/G/f9z+DM2AYJ7yXFW5VDR9HuDAipCVLUSpa33KozdI0aBzHzEqp54kY6s2A47qhoITrZ4W3UmnwoF+RoM8QkCTqsADl++k12e7bntlmwIUPami9z5LrqsJAG8I0Y/9ZzHMJnkxrY2GtssnVGJOHnJITwTp6I++GfsBMoHVdMC/r6ZGkaWBFn4NkcnmqA5lrYSOtOhkm0o0EKSuDmlNVWw4IiVfqZyH6/vL6jo/ijuL+wJ3WGPZpSfJXi5XKbw/JpGp73Di9oJyHa1Fah7LxMLx3YqrmxDrTV+e7zOzp4+/4AmUMuEh+DlviAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/db5e324e783586096f431e332694df55/8ac56/CloudFormation_resources.webp 240w,
/static/db5e324e783586096f431e332694df55/d3be9/CloudFormation_resources.webp 480w,
/static/db5e324e783586096f431e332694df55/47c32/CloudFormation_resources.webp 846w"
          sizes="(max-width: 846px) 100vw, 846px"
          type="image/webp"
        />
        <source
          srcset="/static/db5e324e783586096f431e332694df55/e4891/CloudFormation_resources.png 240w,
/static/db5e324e783586096f431e332694df55/0ce91/CloudFormation_resources.png 480w,
/static/db5e324e783586096f431e332694df55/7a2f6/CloudFormation_resources.png 846w"
          sizes="(max-width: 846px) 100vw, 846px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/db5e324e783586096f431e332694df55/7a2f6/CloudFormation_resources.png"
          alt="CloudFormation_resources"
          title="CloudFormation_resources"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span>
CloudFormation Template</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">Resources</span><span class="token punctuation">:</span>
  <span class="token key atrule">GroupsDynamoDBTable</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> <span class="token string">'AWS::DynamoDB::Table'</span>
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">TableName</span><span class="token punctuation">:</span> Group
      <span class="token key atrule">AttributeDefinitions</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">AttributeName</span><span class="token punctuation">:</span> id
          <span class="token key atrule">AttributeType</span><span class="token punctuation">:</span> S
      <span class="token key atrule">KeySchema</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">AttributeName</span><span class="token punctuation">:</span> id
          <span class="token key atrule">KeyType</span><span class="token punctuation">:</span> HASH
      <span class="token key atrule">BillingMode</span><span class="token punctuation">:</span> PAY_PER_REQUEST</code></pre></div>
<p>DynamoDB 용어</p>
<ul>
<li>Partition key - 과거에는 이름이 Hash Key 였음</li>
<li>Sort key - 과거에는 이름이 Range Key 였음</li>
<li>옛날 용어들이 아직 라이브러리와 CloudFormation에서 사용되고 있음</li>
</ul>
<p>대부분은 AWS 리소스는 CloudFormation을 활용하여 생성될 수 있지만 가끔 흔하지는 않은 경우이지만 CloudFormation이 지원하지 않는 AWS 리소스가 있을 수 있다. 이때는 AWS API, AWS CLI, AWS 대시보드 등을 통해 생성해야 한다.</p>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-template-resource-type-ref.html" target="_blank" rel="nofollow noopener noreferrer">CloudFormation 리소스 레퍼런스</a> 참고</p>
<h2 id="serverless-프레임워크-사용하기"><a href="#serverless-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0" aria-label="serverless 프레임워크 사용하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serverless 프레임워크 사용하기</h2>
<p>설치</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm install -g serverless</code></pre></div>
<p>프로젝트 만들기</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">serverless create --template aws-nodejs-typescript --path folder-name</code></pre></div>
<p>플러그인 설치</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm install plugin-name --save-dev</code></pre></div>
<p>프로젝트 배포</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">sls deploy -v</code></pre></div>
<h2 id="serverless-프로젝트-만들기-데모"><a href="#serverless-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0-%EB%8D%B0%EB%AA%A8" aria-label="serverless 프로젝트 만들기 데모 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serverless 프로젝트 만들기 데모</h2>
<ol>
<li>Serverless 설치</li>
</ol>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm install -g serverless</code></pre></div>
<ol start="2">
<li>IAM에 새로운 사용자 이름을 <code class="language-text">serverless</code>로 셋업 후 엑세스키와 시크릿키 저장</li>
<li>Serverless에서 2번에서 설정한 AWS 사용자를 사용할 수 있도록 환경설정하기</li>
</ol>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">sls config credentials --provider aws --key YOUR_ACCESS_KEY --secret YOUR_SECRET_KEY --profile serverless</code></pre></div>
<p>사용 가능한 serverless 템플릿 목록 확인</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">sls create --template</code></pre></div>
<p>serverless 보일러플레이트 프로젝트 만들기</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">sls create --template aws-nodejs-typescript --path project-name</code></pre></div>
<p>어플리케이션 배포하기</p>
<ol>
<li>디펜던시 설치</li>
</ol>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm install</code></pre></div>
<ol start="2">
<li>배포하기</li>
</ol>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">sls deploy -v</code></pre></div>
<p>위의 배포하기 명령어를 실행시 나오는 로그는 다음과 같다. 로그를 읽어보면 먼저 zip 파일로 프로젝트를 패키징하고 CloudFormation을 통해 <code class="language-text">serverless.yml</code> 파일에 정의한대로 AWS 리소스를 생성하는 과정들을 확인해볼 수 있다.</p>
<div class="gatsby-highlight" data-language="cli"><pre class="language-cli"><code class="language-cli">Serverless: Using configuration:
{
  &quot;webpackConfig&quot;: &quot;./webpack.config.js&quot;,
  &quot;includeModules&quot;: true,
  &quot;packager&quot;: &quot;npm&quot;,
  &quot;packagerOptions&quot;: {},
  &quot;keepOutputDirectory&quot;: false
}
Serverless: Removing /home/saegeullee/folders/udacity/serverless/10-udagram-app/.webpack
Serverless: Bundling with Webpack...
Time: 460ms
Built at: 2020-06-26 20:57:44
         Asset      Size  Chunks                   Chunk Names
    handler.js  1.28 KiB       0  [emitted]        handler
handler.js.map  5.27 KiB       0  [emitted] [dev]  handler
Entrypoint handler = handler.js handler.js.map
[0] ./handler.ts 316 bytes {0} [built]
[1] external &quot;source-map-support/register&quot; 42 bytes {0} [built]
Serverless: Fetch dependency graph from /home/saegeullee/folders/udacity/serverless/10-udagram-app/package.json
Serverless: Package lock found - Using locked versions
Serverless: Packing external modules: source-map-support@^0.5.10
Serverless: Package took [2301 ms]
Serverless: Copy modules: /home/saegeullee/folders/udacity/serverless/10-udagram-app/.webpack/service [55 ms]
Serverless: Prune: /home/saegeullee/folders/udacity/serverless/10-udagram-app/.webpack/service [645 ms]
Serverless: Run scripts: /home/saegeullee/folders/udacity/serverless/10-udagram-app/.webpack/service [0 ms]
Serverless: Zip service: /home/saegeullee/folders/udacity/serverless/10-udagram-app/.webpack/service [114 ms]
Serverless: Packaging service...
Serverless: Remove /home/saegeullee/folders/udacity/serverless/10-udagram-app/.webpack
Serverless: Creating Stack...
Serverless: Checking Stack create progress...
CloudFormation - CREATE_IN_PROGRESS - AWS::CloudFormation::Stack - serverless-udagram-app-dev
CloudFormation - CREATE_IN_PROGRESS - AWS::S3::Bucket - ServerlessDeploymentBucket
CloudFormation - CREATE_IN_PROGRESS - AWS::S3::Bucket - ServerlessDeploymentBucket
CloudFormation - CREATE_COMPLETE - AWS::S3::Bucket - ServerlessDeploymentBucket
CloudFormation - CREATE_IN_PROGRESS - AWS::S3::BucketPolicy - ServerlessDeploymentBucketPolicy
CloudFormation - CREATE_IN_PROGRESS - AWS::S3::BucketPolicy - ServerlessDeploymentBucketPolicy
CloudFormation - CREATE_COMPLETE - AWS::S3::BucketPolicy - ServerlessDeploymentBucketPolicy
CloudFormation - CREATE_COMPLETE - AWS::CloudFormation::Stack - serverless-udagram-app-dev
Serverless: Stack create finished...
Serverless: Uploading CloudFormation file to S3...
Serverless: Uploading artifacts...
Serverless: Uploading service serverless-udagram-app.zip file to S3 (289.49 KB)...
Serverless: Validating template...
Serverless: Updating Stack...
Serverless: Checking Stack update progress...
CloudFormation - UPDATE_IN_PROGRESS - AWS::CloudFormation::Stack - serverless-udagram-app-dev
CloudFormation - CREATE_IN_PROGRESS - AWS::IAM::Role - IamRoleLambdaExecution
CloudFormation - CREATE_IN_PROGRESS - AWS::ApiGateway::RestApi - ApiGatewayRestApi
CloudFormation - CREATE_IN_PROGRESS - AWS::Logs::LogGroup - HelloLogGroup
CloudFormation - CREATE_IN_PROGRESS - AWS::IAM::Role - IamRoleLambdaExecution
CloudFormation - CREATE_IN_PROGRESS - AWS::ApiGateway::RestApi - ApiGatewayRestApi
CloudFormation - CREATE_IN_PROGRESS - AWS::Logs::LogGroup - HelloLogGroup
CloudFormation - CREATE_COMPLETE - AWS::Logs::LogGroup - HelloLogGroup
CloudFormation - CREATE_COMPLETE - AWS::ApiGateway::RestApi - ApiGatewayRestApi
CloudFormation - CREATE_IN_PROGRESS - AWS::ApiGateway::Resource - ApiGatewayResourceHello
CloudFormation - CREATE_IN_PROGRESS - AWS::ApiGateway::Resource - ApiGatewayResourceHello
CloudFormation - CREATE_COMPLETE - AWS::ApiGateway::Resource - ApiGatewayResourceHello
CloudFormation - CREATE_COMPLETE - AWS::IAM::Role - IamRoleLambdaExecution
CloudFormation - CREATE_IN_PROGRESS - AWS::Lambda::Function - HelloLambdaFunction
CloudFormation - CREATE_IN_PROGRESS - AWS::Lambda::Function - HelloLambdaFunction
CloudFormation - CREATE_COMPLETE - AWS::Lambda::Function - HelloLambdaFunction
CloudFormation - CREATE_IN_PROGRESS - AWS::Lambda::Permission - HelloLambdaPermissionApiGateway
CloudFormation - CREATE_IN_PROGRESS - AWS::ApiGateway::Method - ApiGatewayMethodHelloGet
CloudFormation - CREATE_IN_PROGRESS - AWS::Lambda::Version - HelloLambdaVersionM6DbLxpdiG16YDJDg2ZSMu4TSoZ5fRB1obTCtaxOz4
CloudFormation - CREATE_IN_PROGRESS - AWS::Lambda::Permission - HelloLambdaPermissionApiGateway
CloudFormation - CREATE_IN_PROGRESS - AWS::ApiGateway::Method - ApiGatewayMethodHelloGet
CloudFormation - CREATE_COMPLETE - AWS::ApiGateway::Method - ApiGatewayMethodHelloGet
CloudFormation - CREATE_IN_PROGRESS - AWS::Lambda::Version - HelloLambdaVersionM6DbLxpdiG16YDJDg2ZSMu4TSoZ5fRB1obTCtaxOz4
CloudFormation - CREATE_COMPLETE - AWS::Lambda::Version - HelloLambdaVersionM6DbLxpdiG16YDJDg2ZSMu4TSoZ5fRB1obTCtaxOz4
CloudFormation - CREATE_IN_PROGRESS - AWS::ApiGateway::Deployment - ApiGatewayDeployment1593172663349
CloudFormation - CREATE_IN_PROGRESS - AWS::ApiGateway::Deployment - ApiGatewayDeployment1593172663349
CloudFormation - CREATE_COMPLETE - AWS::ApiGateway::Deployment - ApiGatewayDeployment1593172663349
CloudFormation - CREATE_COMPLETE - AWS::Lambda::Permission - HelloLambdaPermissionApiGateway
CloudFormation - UPDATE_COMPLETE_CLEANUP_IN_PROGRESS - AWS::CloudFormation::Stack - serverless-udagram-app-dev
CloudFormation - UPDATE_COMPLETE - AWS::CloudFormation::Stack - serverless-udagram-app-dev
Serverless: Stack update finished...
Service Information
service: serverless-udagram-app
stage: dev
region: us-east-1
stack: serverless-udagram-app-dev
resources: 11
api keys:
  None
endpoints:
  GET - https://flynaqxkge.execute-api.us-east-1.amazonaws.com/dev/hello
functions:
  hello: serverless-udagram-app-dev-hello
layers:
  None

Stack Outputs
HelloLambdaFunctionQualifiedArn: arn:aws:lambda:us-east-1:685808903701:function:serverless-udagram-app-dev-hello:1
ServiceEndpoint: https://flynaqxkge.execute-api.us-east-1.amazonaws.com/dev
ServerlessDeploymentBucketName: serverless-udagram-app-d-serverlessdeploymentbuck-tdi6ddkua4zw

Serverless: Run the &quot;serverless&quot; command to setup monitoring, troubleshooting and testing.</code></pre></div>
<p>위 로그의 끝 부분에서 생성된 엔드포인트 주소로 포스트맨을 활용하여 요청을 보내보면 다음과 같이 응답이 성공적으로 오는 것을 알 수 있다.</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"Go Serverless Webpack (Typescript) v1.0! Your function executed successfully!"</span><span class="token punctuation">,</span>
    <span class="token property">"input"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"resource"</span><span class="token operator">:</span> <span class="token string">"/hello"</span><span class="token punctuation">,</span>
        <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"/hello"</span><span class="token punctuation">,</span>
        <span class="token property">"httpMethod"</span><span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>
        <span class="token property">"headers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          ...</code></pre></div>
<p>AWS CloudFormation 대시보드에서 위의 명령어로 생성된 Stack을 확인해 볼 수 있고 CloudFormation이 이 Stack에 생성한 각 리소스를 API 게이트웨이, AWS 람다 함수 등의 대시보드에서 확인해볼 수 있다.</p>
<h2 id="groups-api-추가하기"><a href="#groups-api-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0" aria-label="groups api 추가하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Groups API 추가하기</h2>
<p>여기서 진행할 내용은 다음과 같다.</p>
<ul>
<li>GET /groups 엔드포인트에 요청을 보내기 위한 함수 추가</li>
<li>
<p>환경설정</p>
<ul>
<li>Event Handler 생성</li>
<li>IAM permission 설정</li>
<li>DynamoDB table 생성</li>
</ul>
</li>
<li>POST /groups 엔드포인트 추가</li>
</ul>
<p>위의 진행 내용은 <a href="https://github.com/saegeullee/Serverless_Framework_App" target="_blank" rel="nofollow noopener noreferrer">깃헙 레포지토리</a>에서 확인이 가능하다.</p>
<h2 id="api-게이트웨이-요청-유효성-검증"><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4-%EC%9A%94%EC%B2%AD-%EC%9C%A0%ED%9A%A8%EC%84%B1-%EA%B2%80%EC%A6%9D" aria-label="api 게이트웨이 요청 유효성 검증 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API 게이트웨이 요청 유효성 검증</h2>
<p>현재 위에서 구현한 POST <code class="language-text">/groups</code> 엔드포인트에서는 사용자의 요청을 받으면 그 데이터를 DB에 어떤 유효성 검증이 없이 저장을 하고 있다. 클라이언트의 요청으로 받은 body 객체에 유효성 검증을 람다 함수에서 진행할 수 있지만 여기서는 <code class="language-text">API 게이트웨이</code>에서 하는 방법을 알아본다. 이 방식으로 진행하면 람다 함수가 호출되기 전에 <code class="language-text">API 게이트웨이</code>에서 먼저 요청의 유효성이 검증된다. 검증되지 않은 요청은 람다 함수 호출자체를 하지 않기 때문에 비용을 절감할 수 있다.</p>
<h3 id="json-스키마"><a href="#json-%EC%8A%A4%ED%82%A4%EB%A7%88" aria-label="json 스키마 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JSON 스키마</h3>
<p>API 게이트웨이에서 들어오는 요청을 검증하기 위해 <a href="https://json-schema.org/" target="_blank" rel="nofollow noopener noreferrer">JSON 스키마</a>를 사용한다. JSON 스키마는 JSON 객체의 구조를 정의한다. 다음은 JSON 스키마 예시이다. 첫번째 프로퍼티인 <code class="language-text">$schema</code>는 JSON 객체의 유효성 검증이 이루어질때 어떤 버전의 JSON 스키마가 사용되어야 하는지를 명시한다.</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"$schema"</span><span class="token operator">:</span> <span class="token string">"http://json-schema.org/draft-04/schema#"</span><span class="token punctuation">,</span>
  <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"my-type"</span><span class="token punctuation">,</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
  <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"required"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p>API 게이트웨이에서 요청을 검증하는 방법에 대한 공식 문서는 <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-method-request-validation.html" target="_blank" rel="nofollow noopener noreferrer">여기서</a> 확인할 수 있다.</p>
<p>서버리스 프레임워크를 사용하여 요청에 대한 유효성 검증을 하려면 <code class="language-text">serverless.yml</code> 파일의 해당 핸들러에 다음과 같이 코드를 추가하면 된다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">HttpHandler</span><span class="token punctuation">:</span>
  <span class="token key atrule">handler</span><span class="token punctuation">:</span> src/lambda/http/create.handler
  <span class="token key atrule">events</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">method</span><span class="token punctuation">:</span> post
        <span class="token key atrule">path</span><span class="token punctuation">:</span> items
        <span class="token key atrule">request</span><span class="token punctuation">:</span>
          <span class="token comment"># Schema that will be used to validate incoming requests</span>
          <span class="token key atrule">schema</span><span class="token punctuation">:</span>
            <span class="token key atrule">application/json</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>file(models/create<span class="token punctuation">-</span>todo<span class="token punctuation">-</span>model.json)<span class="token punctuation">}</span></code></pre></div>
<h2 id="dynamodb-컴포짓-키"><a href="#dynamodb-%EC%BB%B4%ED%8F%AC%EC%A7%93-%ED%82%A4" aria-label="dynamodb 컴포짓 키 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DynamoDB 컴포짓 키</h2>
<h3 id="images-api-추가"><a href="#images-api-%EC%B6%94%EA%B0%80" aria-label="images api 추가 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Images API 추가</h3>
<p>여기서 구현할 내용은 다음과 같다.</p>
<ul>
<li>이미지 생성</li>
<li>해당 group의 이미지 get</li>
<li>특정 id의 이미지 get</li>
<li>이미지 업로드</li>
<li>이미지 업로드 노티피케이션</li>
</ul>
<p>여기서 사용하는 DynamoDB의 파티션 키만을 사용해서는 특정 id의 이미지를 get하는 쿼리만 구현이 가능하고 특정 group의 모든 이미지를 get하는 쿼리를 구현하기는 어렵다. 파티션 키만을 사용했을 때 DynamoDB가 지원하는 기능은 해당 이미지의 id로 이미지를 쿼리하는 것과 해당 테이블의 모든 아이템을 가져오는 <code class="language-text">Scan</code> 만 지원하기 때문이다. </p>
<p>따라서 특정 group의 모든 이미지를 쿼리하는 기능을 구현하기 위해 DynamoDB에서 제공하는 <code class="language-text">Composite Key</code>(컴포짓 키)를 사용해야 한다. 컴포짓 키는 다음 두가지 키로 구성이 된다.</p>
<ul>
<li>파티션 키 : 아이템을 어떤 파티션에 write 할지를 결정</li>
<li>sort 키 : 같은 파티션 키의 아이템들을 sorting</li>
<li>이 둘을 함께 사용하면 하나의 아이템을 유니크하게 만들 수 있다.</li>
<li>이 구조는 주로 RDBMS의 <code class="language-text">One to Many</code> 관계를 DynamoDB에서 구현하기 위해 사용한다.</li>
</ul>
<p>컴포짓 키를 사용하면 DynamoDB에 <code class="language-text">Query</code>라는 추가적인 오퍼레이션이 가능한데 이는 특정 파티션 키를 가지고 있는 모든 엘리먼트를 쿼리할 수 있다. 이는 큰 데이터베이스를 쿼리할 때 효율이 좋다. 데이터베이스의 모든 엘리먼트를 scan할 필요없이 특정 파티션 키만을 가지고 있는 아이템만 read 할 수 있기 때문이다. 또한 지정한 <code class="language-text">sort key</code> 속성 뿐만 아니라 다른 속성으로도 아이템을 필터링 할 수 있다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 835px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f8b4a5b11ea4a337cff04807ce8cd805/ebfaf/dynamodb_composite_key.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.946107784431135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABqUlEQVQoz32RW0sbQRiG5/9ar6StVQp6FzBJLwRLKYhEkzuhh+wmq5DzoVdFaE2yWWh75R5ycjcxuzub3ddvRhFU6sDDPB878843OyxJErxEFMcIeAQeRbL2fR/Hxzmk9/aQyWSQSqWQzWaxu7uDwWAAhheGCLgXxKuV1CAIcFg4RfrjEdIHh/jwKYfU/meJ8ecf2M1igdFkCpNw3Wt4noc5wTl/dkBM3S5ovbvw4fkc3jIkONybQNZ+EILl8wVsvH6Dza1tvN18h63t91h7tY5qrSZDRMB0OsV8PkcYhvKgiIdIKDyJV/fceUS/hdV//MTJFw0FIv9VQ+5UxRHRM/7Ka7quC9M0MZvNZJgIXS6XDx6G/A4uOgzALNvBlWnDcka4smzYVNvko9EYk8lEIsJEl8Jt24bjONLH4/Gj2bIsMMMYwhgKdPTplS5+X+JXrwedXNf1RwxpXb/flwh/So/2sUq9gbNqHefVGrRKFZVGA/VmC+12G91u94FOpyPnVquFZrMpvz+lQXuZopbwTVHxXVVRJD/TNGhEuVz+L4qioFgsPqNUKuEWtqx8VsAiAHUAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/f8b4a5b11ea4a337cff04807ce8cd805/8ac56/dynamodb_composite_key.webp 240w,
/static/f8b4a5b11ea4a337cff04807ce8cd805/d3be9/dynamodb_composite_key.webp 480w,
/static/f8b4a5b11ea4a337cff04807ce8cd805/2321d/dynamodb_composite_key.webp 835w"
          sizes="(max-width: 835px) 100vw, 835px"
          type="image/webp"
        />
        <source
          srcset="/static/f8b4a5b11ea4a337cff04807ce8cd805/e4891/dynamodb_composite_key.png 240w,
/static/f8b4a5b11ea4a337cff04807ce8cd805/0ce91/dynamodb_composite_key.png 480w,
/static/f8b4a5b11ea4a337cff04807ce8cd805/ebfaf/dynamodb_composite_key.png 835w"
          sizes="(max-width: 835px) 100vw, 835px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/f8b4a5b11ea4a337cff04807ce8cd805/ebfaf/dynamodb_composite_key.png"
          alt="dynamodb_composite_key"
          title="dynamodb_composite_key"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h3 id="컴포짓-키가-제공하는-오퍼레이터"><a href="#%EC%BB%B4%ED%8F%AC%EC%A7%93-%ED%82%A4%EA%B0%80-%EC%A0%9C%EA%B3%B5%ED%95%98%EB%8A%94-%EC%98%A4%ED%8D%BC%EB%A0%88%EC%9D%B4%ED%84%B0" aria-label="컴포짓 키가 제공하는 오퍼레이터 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>컴포짓 키가 제공하는 오퍼레이터</h3>
<ul>
<li>
<p>아이템을 필터링할 때 사용할 수 있는 오퍼레이터는 다음과 같다.</p>
<ul>
<li>sort key의 값으로 해당 오퍼레이터 사용가능</li>
</ul>
</li>
<li>&#x3C;, >, &#x3C;=, >=, =</li>
<li>BETWEEN</li>
<li>BEGINS_WITH</li>
</ul>
<h3 id="이미지-테이블"><a href="#%EC%9D%B4%EB%AF%B8%EC%A7%80-%ED%85%8C%EC%9D%B4%EB%B8%94" aria-label="이미지 테이블 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>이미지 테이블</h3>
<p>이 수업에서 Images API를 구현하기 위해 이미지 테이블 필드는 다음과 같이 구성한다.</p>
<ul>
<li>groupId (파티션 키)</li>
<li>timestamp (sort 키)</li>
<li>imageId</li>
<li>title</li>
<li>imageUrl</li>
</ul>
<h2 id="nodejs에서-쿼리-샘플-코드"><a href="#nodejs%EC%97%90%EC%84%9C-%EC%BF%BC%EB%A6%AC-%EC%83%98%ED%94%8C-%EC%BD%94%EB%93%9C" aria-label="nodejs에서 쿼리 샘플 코드 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Nodejs에서 쿼리 샘플 코드</h2>
<p>DynamoDB의 도큐먼트 클라이언트가 Nodejs에서 DB를 쿼리하기 위한 샘플 코드이다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> docClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AWS<span class="token punctuation">.</span>DynamoDB<span class="token punctuation">.</span>DocumentClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> docClient
  <span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    TableName<span class="token punctuation">:</span> <span class="token string">'GameScore'</span><span class="token punctuation">,</span>
    KeyConditionExpression<span class="token punctuation">:</span> <span class="token string">'GameId = :gameId'</span><span class="token punctuation">,</span>
    ExpressionAttributeValues<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">':gameId'</span><span class="token punctuation">:</span> <span class="token string">'10'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> items <span class="token operator">=</span> result<span class="token punctuation">.</span>Items<span class="token punctuation">;</span></code></pre></div>
<h3 id="serverless-프레임워크-샘플-코드"><a href="#serverless-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC-%EC%83%98%ED%94%8C-%EC%BD%94%EB%93%9C" aria-label="serverless 프레임워크 샘플 코드 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>serverless 프레임워크 샘플 코드</h3>
<p>특정 그룹의 모든 이미지를 가져오는 엔드포인트에 대한 명세를 <code class="language-text">serverless.yml</code>에 다음과 같이 정의할 수 있다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">functions</span><span class="token punctuation">:</span>
  <span class="token key atrule">GetOrders</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> src/images.handler
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
          <span class="token key atrule">method</span><span class="token punctuation">:</span> get
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /groups/<span class="token punctuation">{</span>groupId<span class="token punctuation">}</span>/images</code></pre></div>
<p>그리고 핸들러 함수는 다음과 같이 작성할 수 있다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> groupId <span class="token operator">=</span> event<span class="token punctuation">.</span>pathParameters<span class="token punctuation">.</span>groupId
  <span class="token operator">...</span>
<span class="token punctuation">}</span></code></pre></div>
<h2 id="dyanamodb-인덱싱"><a href="#dyanamodb-%EC%9D%B8%EB%8D%B1%EC%8B%B1" aria-label="dyanamodb 인덱싱 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DyanamoDB 인덱싱</h2>
<p>DynamoDB의 인덱싱 시스템은 다른 데이터베이스의 시스템과 다르다. DynamoDB는 두가지 타입의 인덱싱을 지원한다.</p>
<h3 id="local-secondary-indexlsi"><a href="#local-secondary-indexlsi" aria-label="local secondary indexlsi permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Local Secondary Index(LSI)</h3>
<ul>
<li>추가적인 sort key와 같다.</li>
<li>다른 속성으로 아이템을 정렬할 수 있도록 해준다.</li>
</ul>
<h3 id="global-secondary-indexgsi"><a href="#global-secondary-indexgsi" aria-label="global secondary indexgsi permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Global Secondary Index(GSI)</h3>
<ul>
<li>같은 데이터에 대해 새로운 파티션 키와 sort 키를 정의할 수 있다.</li>
<li>새로운 파티션 키를 새로운 키로 하여 기존 테이블의 데이터를 새로운 테이블로 비동기로 복사한다.</li>
<li>내부적으로 GSI는 마치 새로운 테이블에서 데이터를 쿼리하는 것처럼 동작한다.</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 699px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e16d388cea5636039a809f167e6dcce8/3fd4f/dynamodb_global_indexes.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 37.19599427753934%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABVUlEQVQoz4VQy07CUBDt18oOH4sSAbe4ka8RjXGhoIaFJRIiIFDbggJtbx+YPgFpj3NLJGyMk5zM3HPPTGaO0O2/oT8YQlE18NqyHfBIkgRpmu7AY//9F4TVep01J0mKzfcGf8Xv0P9CWK9WME0TlmVhohuYEhi9TcYyznGc3bCZYUKdzjLetu3sbz8vl0sIsiyjVCqiWDxFoVCguoST4yMc5vMZd16pQDcMeEGAavUCImk4f1Yuk17cZlFELncASZIgRFEMnVmYGwyyOs4wetegaB+YmxZcdwGZLdDT+SYuDGbTFSYY1erkEyNljCHpR4oGzw8gOF8e7qUuGq0erh8kXBFqDQk3Ty8Z3+wMEa/IZzq72Rmg3urj7vkVj+0Bbptt1OrUQ/pLyrrl8g0jBHROEPhg5Jttb/3g8H0fURRm3nB4ngeu5zmOYziuu+uxSB+GIX4ABWn4nJkVKfAAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/e16d388cea5636039a809f167e6dcce8/8ac56/dynamodb_global_indexes.webp 240w,
/static/e16d388cea5636039a809f167e6dcce8/d3be9/dynamodb_global_indexes.webp 480w,
/static/e16d388cea5636039a809f167e6dcce8/32d5d/dynamodb_global_indexes.webp 699w"
          sizes="(max-width: 699px) 100vw, 699px"
          type="image/webp"
        />
        <source
          srcset="/static/e16d388cea5636039a809f167e6dcce8/e4891/dynamodb_global_indexes.png 240w,
/static/e16d388cea5636039a809f167e6dcce8/0ce91/dynamodb_global_indexes.png 480w,
/static/e16d388cea5636039a809f167e6dcce8/3fd4f/dynamodb_global_indexes.png 699w"
          sizes="(max-width: 699px) 100vw, 699px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/e16d388cea5636039a809f167e6dcce8/3fd4f/dynamodb_global_indexes.png"
          alt="dynamodb_global_indexes"
          title="dynamodb_global_indexes"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<p>이 수업 예시의 경우에는 <code class="language-text">imageId</code>가 <code class="language-text">GSI</code>가 될 수 있다. 따라서 imageID로 아이템을 효율적으로 쿼리해올 수 있게 된다. <code class="language-text">GSI</code>로 설정했기 때문에 쿼리 속도가 빠르고 테이블의 모든 아이템을 lookup 할 필요가 없다.</p>
<p>다음은 위의 사항들을 적용한 DynamoDB 테이블 리소스를 <code class="language-text">serverless.yaml</code>파일에 정의한 코드이다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml">    <span class="token key atrule">ImagesDynamoDBTable</span><span class="token punctuation">:</span>
      <span class="token key atrule">Type</span><span class="token punctuation">:</span> <span class="token string">'AWS::DynamoDB::Table'</span>
      <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
        <span class="token key atrule">AttributeDefinitions</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">AttributeName</span><span class="token punctuation">:</span> groupId
            <span class="token key atrule">AttributeType</span><span class="token punctuation">:</span> S
          <span class="token punctuation">-</span> <span class="token key atrule">AttributeName</span><span class="token punctuation">:</span> timestamp
            <span class="token key atrule">AttributeType</span><span class="token punctuation">:</span> S
          <span class="token punctuation">-</span> <span class="token key atrule">AttributeName</span><span class="token punctuation">:</span> imageId
            <span class="token key atrule">AttributeType</span><span class="token punctuation">:</span> S
        <span class="token key atrule">KeySchema</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">AttributeName</span><span class="token punctuation">:</span> groupId
            <span class="token key atrule">KeyType</span><span class="token punctuation">:</span> HASH
          <span class="token punctuation">-</span> <span class="token key atrule">AttributeName</span><span class="token punctuation">:</span> timestamp
            <span class="token key atrule">KeyType</span><span class="token punctuation">:</span> RANGE
        <span class="token key atrule">GlobalSecondaryIndexes</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">IndexName</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>self<span class="token punctuation">:</span>provider.environment.IMAGE_ID_INDEX<span class="token punctuation">}</span>
            <span class="token key atrule">KeySchema</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">AttributeName</span><span class="token punctuation">:</span> imageId
                <span class="token key atrule">KeyType</span><span class="token punctuation">:</span> HASH
            <span class="token comment"># 기존 테이블 데이터의 어떤 속성들을 GSI의 결과로 생성되는 테이블에 복사할지</span>
            <span class="token comment"># 지정하는 부분. 여기서는 모든 속성들을 복사</span>
            <span class="token key atrule">Projection</span><span class="token punctuation">:</span>
              <span class="token key atrule">ProjectionType</span><span class="token punctuation">:</span> ALL
        <span class="token key atrule">BillingMode</span><span class="token punctuation">:</span> PAY_PER_REQUEST
        <span class="token key atrule">TableName</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>self<span class="token punctuation">:</span>provider.environment.IMAGES_TABLE<span class="token punctuation">}</span></code></pre></div>
<h1 id="event-processing"><a href="#event-processing" aria-label="event processing permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Event Processing</h1>
<p>지금까지의 과정까지 <code class="language-text">serverless framework</code>를 사용하여 <a href="https://github.com/saegeullee/Serverless_Framework_App" target="_blank" rel="nofollow noopener noreferrer">SNS 어플리케이션</a>을 만들었다. 이번 섹션에서는 다음의 고급 기능들을 이 어플리케이션에 추가하는 과정들을 정리한다.</p>
<ul>
<li>AWS S3에 이미지 업로드</li>
<li>
<p>이미지 파일이 업로드 될때 다른 사용자들에게 노티 보내주기</p>
<ul>
<li>WebSockets</li>
<li>S3 노티피케이션 사용</li>
</ul>
</li>
<li>텍스트 검색 (DynamoDB)</li>
<li>
<p>아마존 SNS(Simple Notification Service) 사용</p>
<ul>
<li>람다 함수와 이벤트 소스들 연결</li>
</ul>
</li>
</ul>
<h2 id="파일-업로드"><a href="#%ED%8C%8C%EC%9D%BC-%EC%97%85%EB%A1%9C%EB%93%9C" aria-label="파일 업로드 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>파일 업로드</h2>
<p>이 수업에서 이미지를 업로드 할 때 <code class="language-text">presigned url</code>이라는 방식을 사용한다.</p>
<h3 id="presigned-url"><a href="#presigned-url" aria-label="presigned url permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Presigned URL</h3>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 785px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ef88214393d4611d3f43268d1bf238de/6e706/presigned_url.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 49.80891719745223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABrklEQVQoz31RW07CUBDtevxxD67AHbgD44eJiV9uwD+jJi6AL2s0EYUAysMEDJU2jYmxIlSLIIUmbeXRF8c7F0tE0Zuc3OnMOWfmToXJZIL/ju/56HQ6sCxrYf2nXoiTURTxezwew+yaME0Tkwgwui9YP1hDIn/EBUEYcG4M0nwHN6QCGQVBAN/3MRqNMBwNucGToWF1ZwWHyd3pxKwe8zzP+zXxzJBIfx0SUhO6vbHH+bF53CDwp5PPDKmwaCf8KWGIwccHHMeF67qz5vQqx3bQar2h37e4x2yHIRPF5kRyHIfn/vtlQRjN7Z/vcDAYwLZt9hN63IRQrz+j2WjAZrHd66FflWDX63AZt8d4NmtIE1vvbTYxi1k+hmAYBhRFQaFYgqZpaDCjZlOHTnerhQeWzy0tQ93axnO7DVVW8Pio4UGVISUTeLpX8PJqQNd1DkGWZZRKN7i+zqNSqUBi0xSLRRTyBUi1GvKXKYgbm0jv7aOmqlAYnzR31SrKuRSk2zL7VlBjXIKQyWSQzWY5KCaIxyJE8YTHyYsLnKUucXp+jnQ6jcwXj2tyV3M6wieWjOTYj8nTagAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/ef88214393d4611d3f43268d1bf238de/8ac56/presigned_url.webp 240w,
/static/ef88214393d4611d3f43268d1bf238de/d3be9/presigned_url.webp 480w,
/static/ef88214393d4611d3f43268d1bf238de/f2d53/presigned_url.webp 785w"
          sizes="(max-width: 785px) 100vw, 785px"
          type="image/webp"
        />
        <source
          srcset="/static/ef88214393d4611d3f43268d1bf238de/e4891/presigned_url.png 240w,
/static/ef88214393d4611d3f43268d1bf238de/0ce91/presigned_url.png 480w,
/static/ef88214393d4611d3f43268d1bf238de/6e706/presigned_url.png 785w"
          sizes="(max-width: 785px) 100vw, 785px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/ef88214393d4611d3f43268d1bf238de/6e706/presigned_url.png"
          alt="presigned_url"
          title="presigned_url"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<ul>
<li>S3 버켓을 가리키는 특별한 URL이다</li>
<li>
<p>누구나 이를 사용하여 객체를 업로드 및 Read 할 수 있다</p>
<ul>
<li>S3 버켓이 Private 이더라도 사용가능</li>
</ul>
</li>
<li>
<p>람다 함수에 의해 <code class="language-text">Presigned url</code>이 생성된다</p>
<ul>
<li>해당 람다 함수는 S3에 쓰기 권한이 있어야 한다</li>
</ul>
</li>
<li>
<p>serverless 방식이다.</p>
<ul>
<li>파일 업로드를 위한 인프라를 관리할 필요가 없다</li>
<li>파일 업로드 프로세싱을 직접 관리할 필요가 없다</li>
</ul>
</li>
</ul>
<h3 id="presigned-url-생성하기"><a href="#presigned-url-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0" aria-label="presigned url 생성하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Presigned URL 생성하기</h3>
<p><code class="language-text">presigned url</code>을 생성하기 위해서는 다음과 같이 S3 버켓 클라이언트 인스턴스를 생성해야 한다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> s3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AWS<span class="token punctuation">.</span>S3</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  signatureVersion<span class="token punctuation">:</span> <span class="token string">'v4'</span> <span class="token comment">// Use Sigv4 algorithm</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> presignedUrl <span class="token operator">=</span> s3<span class="token punctuation">.</span><span class="token function">getSignedUrl</span><span class="token punctuation">(</span><span class="token string">'putObject'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// 이 URL은 S3 버켓에 PUT 작업을 할 수 있도록 허용한다.</span>
  Bucket<span class="token punctuation">:</span> <span class="token string">'s3-bucket-name'</span><span class="token punctuation">,</span> <span class="token comment">// S3 버켓의 이름</span>
  Key<span class="token punctuation">:</span> <span class="token string">'object-id'</span><span class="token punctuation">,</span> <span class="token comment">// 이 URL이 접근 허용하는 객체의 id</span>
  Expires<span class="token punctuation">:</span> <span class="token string">'300'</span> <span class="token comment">// 이 URL은 5분동안 유효함</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>이 url을 생성하기 위해 사용되는 Sigv4 알고리즘이 어떻게 동작하는지에 대한 것은 <a href="https://docs.aws.amazon.com/general/latest/gr/signature-version-4.html" target="_blank" rel="nofollow noopener noreferrer">여기서</a> 확인해보면 된다.</p>
<h3 id="cloudformation-레퍼런스"><a href="#cloudformation-%EB%A0%88%ED%8D%BC%EB%9F%B0%EC%8A%A4" aria-label="cloudformation 레퍼런스 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CloudFormation 레퍼런스</h3>
<p>현재 프로젝트에 어떤 사용자든지 S3 버켓에서 이미지를 읽어올 수 있도록 허용하는 것과 S3 버켓에 이미지를 업로드 할 수 있도록 허용하는 <code class="language-text">IAM 정책</code>을 추가해야 한다. 그러기 위해서는 <code class="language-text">IAM 정책</code>이 S3 버켓의 ID를 알 수 있어야 한다. 이때 <code class="language-text">CloudFormation 레퍼런스</code>를 사용하여 다음과 같이 이를 제공할 수 있다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">AttachmentBucket</span><span class="token punctuation">:</span>
  <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>S3<span class="token punctuation">:</span><span class="token punctuation">:</span>Bucket

<span class="token key atrule">BucketPolicy</span><span class="token punctuation">:</span>
  <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>S3<span class="token punctuation">:</span><span class="token punctuation">:</span>BucketPolicy
  <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
    <span class="token key atrule">PolicyDocument</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token tag">!Ref</span> AttachmentsBucket</code></pre></div>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-ref.html" target="_blank" rel="nofollow noopener noreferrer">Ref</a>를 통해 특정 리소스의 id를 가져올 수 있다.</p>
<p>YAML 파일에 다음의 두가지 포맷으로 사용할 수 있다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">Ref</span><span class="token punctuation">:</span> logicalName</code></pre></div>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token tag">!Ref</span> logicalName</code></pre></div>
<h2 id="s3-이벤트"><a href="#s3-%EC%9D%B4%EB%B2%A4%ED%8A%B8" aria-label="s3 이벤트 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>S3 이벤트</h2>
<p>이번 섹션에서는 S3 파일 업로드 이벤트(s3 노티피케이션)가 발생했을때 호출되는 람다 함수를 추가한다. 서버리스 프레임워크에는 다음과 같이 함수를 정의하여 이를 수행할 수 있다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">functions</span><span class="token punctuation">:</span>
  <span class="token key atrule">process</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> file.handler
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">s3</span><span class="token punctuation">:</span> bucket<span class="token punctuation">-</span>name
        <span class="token key atrule">events</span><span class="token punctuation">:</span> s3<span class="token punctuation">:</span>ObjectCreated<span class="token punctuation">:</span>*
        <span class="token key atrule">rules</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">prefix</span><span class="token punctuation">:</span> images/
          <span class="token punctuation">-</span> <span class="token key atrule">suffix</span><span class="token punctuation">:</span> .png</code></pre></div>
<h2 id="api-게이트웨이--웹소켓"><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4--%EC%9B%B9%EC%86%8C%EC%BC%93" aria-label="api 게이트웨이  웹소켓 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API 게이트웨이 : 웹소켓</h2>
<p>람다 함수는 특성상 휘발성이며 일정 시간 요청이 없다면 언제든지 제거될 수 있다. 그렇다면 어떻게 지속적인 연결을 유지할 수 있을까? 클라이언트는 <code class="language-text">API 게이트웨이</code>와 연결되고 <code class="language-text">API 게이트웨이</code>가 지속적인 연결을 유지한다.</p>
<p><code class="language-text">API 게이트웨이</code>는 사용자가 웹소켓을 통해 보낸 메시지를 전달받고 이 메시지를 여러개의 람다 함수에게 이를 전달할 수도 있다. 사용자가 요청 body에 보내는 특정키에 대한 값이 <code class="language-text">라우팅키</code>가 되어 어떤 람다 함수를 호출할지 결정한다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 909px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/a5efa743e400ddf2d4f0a978345ad14b/043fa/Api_gateway_websocket_api.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 49.06490649064906%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABoklEQVQoz31Q207bQBD1Z/HWr+GBD+pDf6HiCyCqlDZKGkEeKKkdkgqIE1s48Xrt9X19OZ1xcAQo7UhHuztz5syZNUDRti3684hDAs3rvWE0Dd7yT4XxVuRj1CTg2RtsP3+B9/USQobvhvMARqVLpPsNmrqC0TdzoSgKFHmBPM+hyxKacu7DCr/OPmF9fgERKdR1fRhW1R2/blqkKoR3/wM6VTB0VXUFjpJEGCzKDRXVPMfF9tsQL9MbCBEcHbIw87TWXa7KYrRkwNhsXaz+PKIsSsRxjDRJkSQJ8ixHrBQ8bweZZhAqhr/bI6M719mE7/sEASUFvLvhwaEMI/hCdhOjKIKUEgE5YXF2u3vZQZAQiwlq5u8IqYc36NdvG3Ib7tFUmlbmvyLbTOxXLl9zihzaaxsure1snQ5ZlkFTI7uUQQBFgwN/D3f+E0kkYbgukR0HfPbo37ZtY34/h2VaME0T5m/zHffIe37C8vY7Ns+PMDriP2BZFqbTKQaDAa6vrjGbzbBYLE7yrIclTDqNyWSC/2E8HmM0GnXg+0ke5bsa4S9fZepaYcx8eQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/a5efa743e400ddf2d4f0a978345ad14b/8ac56/Api_gateway_websocket_api.webp 240w,
/static/a5efa743e400ddf2d4f0a978345ad14b/d3be9/Api_gateway_websocket_api.webp 480w,
/static/a5efa743e400ddf2d4f0a978345ad14b/ed09a/Api_gateway_websocket_api.webp 909w"
          sizes="(max-width: 909px) 100vw, 909px"
          type="image/webp"
        />
        <source
          srcset="/static/a5efa743e400ddf2d4f0a978345ad14b/e4891/Api_gateway_websocket_api.png 240w,
/static/a5efa743e400ddf2d4f0a978345ad14b/0ce91/Api_gateway_websocket_api.png 480w,
/static/a5efa743e400ddf2d4f0a978345ad14b/043fa/Api_gateway_websocket_api.png 909w"
          sizes="(max-width: 909px) 100vw, 909px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/a5efa743e400ddf2d4f0a978345ad14b/043fa/Api_gateway_websocket_api.png"
          alt="Api_gateway_websocket_api"
          title="Api_gateway_websocket_api"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h3 id="특별한-라우팅"><a href="#%ED%8A%B9%EB%B3%84%ED%95%9C-%EB%9D%BC%EC%9A%B0%ED%8C%85" aria-label="특별한 라우팅 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>특별한 라우팅</h3>
<p><code class="language-text">API 게이트웨이</code>에는 몇가지 특별한 라우팅이 있어 웹소켓 이벤트를 라우팅 할 수 있다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 940px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3af77d894400abfd04a7c7a6a6a3d608/4362d/Api_gateway_special_routes.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 45.425531914893625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABaElEQVQoz4VQ2UrDUBDNZ/rkoy/+i+CT4L/0sWraVBAr2Ky4NE1ykzRt9vU4d0LBFpcLhxkmM2eJMgwDDpDvtK+qClVRoCS0bYv/nvKd8JS8pboxTNgXl/BubhFnOYauQ5EXCMMQBYn0tLp3beT++0j4l1pLy+7KwMvZOT6urpmwaxp2Wtc117brkYk1CvE5EnZ9D3fjoSPlnnoGLXHcskLgB4hECOELxFHMR+k+RRzHyLMMMksRe6gSMRLu6eMruUiSHZOxKkEK5HnOhPI4JNIoilisqRs0zYiOMu/WFtK1ORIejo8c9qNDGcsj9yIQ8D0fQgjeK8sSyTahBCVHLnYRqnRL/3OAItWl8ink3Pd96Csdju3AMi2YpokgCOC6LhzH4RqQc/vpAW/PKmISUeTSj7DGulg84v7unrFcLmHbNizLYkLuCaahw9BXPFfm8zl+g6ZpmE6nmEwmDFVVeT6bzRjH+xrXL+4uovIVpO4KAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/3af77d894400abfd04a7c7a6a6a3d608/8ac56/Api_gateway_special_routes.webp 240w,
/static/3af77d894400abfd04a7c7a6a6a3d608/d3be9/Api_gateway_special_routes.webp 480w,
/static/3af77d894400abfd04a7c7a6a6a3d608/e8e7c/Api_gateway_special_routes.webp 940w"
          sizes="(max-width: 940px) 100vw, 940px"
          type="image/webp"
        />
        <source
          srcset="/static/3af77d894400abfd04a7c7a6a6a3d608/e4891/Api_gateway_special_routes.png 240w,
/static/3af77d894400abfd04a7c7a6a6a3d608/0ce91/Api_gateway_special_routes.png 480w,
/static/3af77d894400abfd04a7c7a6a6a3d608/4362d/Api_gateway_special_routes.png 940w"
          sizes="(max-width: 940px) 100vw, 940px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/3af77d894400abfd04a7c7a6a6a3d608/4362d/Api_gateway_special_routes.png"
          alt="Api_gateway_special_routes"
          title="Api_gateway_special_routes"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<ul>
<li>$connect: 사용자가 웹소켓을 통해 연결되면 람다 함수에 전달되는 이벤트이다.</li>
<li>$disconnect: 사용자가 웹소켓 연결에서 끊어지면 람다 함수에 전달되는 이벤트이다.</li>
<li>$default: 클라이언트로부터 들어오는 메시지가 어떤 라우트 경로에도 매칭이 되지 않으면 보내지는 이벤트이다. 또는 사용자가 JSON이 아닌 데이터를 보내면 전달되는 이벤트이다.</li>
</ul>
<h3 id="api-게이트웨이-웹소켓-url"><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4-%EC%9B%B9%EC%86%8C%EC%BC%93-url" aria-label="api 게이트웨이 웹소켓 url permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API 게이트웨이 웹소켓 URL</h3>
<ul>
<li><code class="language-text">REST API</code>는 하나의 URL만 주어진다.</li>
<li>이와 달리 <code class="language-text">Websocket API</code>는 배포되면 두개의 URL이 주어진다.</li>
<li>
<p><code class="language-text">Websocket URL</code></p>
<ul>
<li>클라이언트가 API에 연결하기 위해 사용된다.</li>
<li>클라이언트가 메시지를 보내고 노티피케이션을 받을 수 있도록 해준다.</li>
</ul>
</li>
<li>
<p><code class="language-text">Connection URL</code></p>
<ul>
<li>연결된 클라이언트에게 메시지를 다시 보낼 수 있도록 해준다.</li>
<li>람다 함수가 클라이언트에게 메시지를 보낼 때 사용된다.</li>
<li>특정 클라이언트에게 메시지를 보내는데 <code class="language-text">Connection id</code>가 필요하다.</li>
</ul>
<h3 id="api-게이트웨이-커넥션-id"><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4-%EC%BB%A4%EB%84%A5%EC%85%98-id" aria-label="api 게이트웨이 커넥션 id permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API 게이트웨이 커넥션 ID</h3>
<p>사용자가 <code class="language-text">API 게이트웨이</code>에 연결되거나 연결이 끊어지면 API 게이트웨이는 람다함수에게 <code class="language-text">커넥션 ID</code>를 전달한다. 람다 함수는 전달받은 <code class="language-text">커넥션 ID</code>를 데이터베이스에 저장하고 연결이 끊어지면 이를 제거한다.</p>
<p>그리고 데이터베이스에 저장된 <code class="language-text">커넥션 ID</code>를 읽어와 특정 클라이언트에게 메시지를 보낼 수 있다.</p>
</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/be1542c96f5ea52e9fcfb869db52ad01/f24d1/Api_gateway_connection_id.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 50.34213098729228%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACGElEQVQoz4VRzW7TQBj0Y/BWCITEE/TCI/TAA8ABhJC4gBAHkDggkCKQ2sqqmtQJEJIoVdI6qZOm0Nj1/8a1vbY3zvB53UrlxCeN9m92dr5Z5WR6iokxw8nUwOzsHJbtQD+dYWrMYczP8PtiCZQlsF6jqs1mI1GVoD1eCImyrPeUPM/BswxxnCBJUhR0GCc0T1OknKOg84paXovdrpS4dpKBZTmEKKWogv9UQpfMxlfYb9+BeR7yogALQ0RXMbI4AvfMf/jKTRu+H1BXa3qllKOcCwFGAvr2Yxj3H8JfmsjyApzcc54jDhywxRh5xrGjBejraS3IqbX5fEGvXqGsxEgopxgEufODAPbiHDZlGvi+5K4Yq+PhCXhoUywcW9sDvPhg1oKVq9UqIoFC5pWKNYrrTwhDBofc+yyC65JgykkskU4TchjOj7Ch+yFLKfsCilgLKViQWOXMp2xGToAlqx8QPEVkW2DWEnm0ktwN6p+W8dBHyIhEQd0JKK7rooJlWXAcBx7NfQrfJTDfg2b8wUtthGf7fXwaGvLcNK2ab9uES3jEtaxL2LRW9ImOyWSC8XgsMRwO0e/3MRge4WKq48HHJpSnu1Ceq7jzSsXP3gC9bhe/aBz80NDd+4Lj8TFGoxF0XYfSbrdxG61WC6qq4qDZRO97B08+7+Hu6wbuvWng0ftvONQ0dDrE7XRw2DxAU92FRns39/8CXxvh4x7RjvIAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/be1542c96f5ea52e9fcfb869db52ad01/8ac56/Api_gateway_connection_id.webp 240w,
/static/be1542c96f5ea52e9fcfb869db52ad01/d3be9/Api_gateway_connection_id.webp 480w,
/static/be1542c96f5ea52e9fcfb869db52ad01/e46b2/Api_gateway_connection_id.webp 960w,
/static/be1542c96f5ea52e9fcfb869db52ad01/da35d/Api_gateway_connection_id.webp 1023w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/be1542c96f5ea52e9fcfb869db52ad01/e4891/Api_gateway_connection_id.png 240w,
/static/be1542c96f5ea52e9fcfb869db52ad01/0ce91/Api_gateway_connection_id.png 480w,
/static/be1542c96f5ea52e9fcfb869db52ad01/b7c40/Api_gateway_connection_id.png 960w,
/static/be1542c96f5ea52e9fcfb869db52ad01/f24d1/Api_gateway_connection_id.png 1023w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/be1542c96f5ea52e9fcfb869db52ad01/b7c40/Api_gateway_connection_id.png"
          alt="Api_gateway_connection_id"
          title="Api_gateway_connection_id"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h3 id="커넥션-url"><a href="#%EC%BB%A4%EB%84%A5%EC%85%98-url" aria-label="커넥션 url permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>커넥션 URL</h3>
<p>커넥션 URL은 다음의 HTTP 메서드를 제공한다.</p>
<ul>
<li>POST : 클라이언트에게 메시지를 보낸다.</li>
<li>GET : 최신의 연결 상태를 가져온다.</li>
<li>DELETE: API로부터 클라이언트 연결을 끊는다.</li>
</ul>
<h2 id="serverless-프레임워크에서-웹소켓-사용하기"><a href="#serverless-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC%EC%97%90%EC%84%9C-%EC%9B%B9%EC%86%8C%EC%BC%93-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0" aria-label="serverless 프레임워크에서 웹소켓 사용하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serverless 프레임워크에서 웹소켓 사용하기</h2>
<p>다음은 웹소켓 이벤트를 사용하기 위한 설정이다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"> <span class="token key atrule">ConnectHandler</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> src/websocket/connect.handler
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">websocket</span><span class="token punctuation">:</span>
          <span class="token key atrule">route</span><span class="token punctuation">:</span> $connect

  <span class="token key atrule">DisconnectHandler</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> src/websocket/disconnect.handler
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">websocket</span><span class="token punctuation">:</span>
          <span class="token key atrule">route</span><span class="token punctuation">:</span> $disconnect</code></pre></div>
<p>포스트맨은 웹소켓 연결을 지원하지 않기 때문에 여기서는 <code class="language-text">wscat</code>이라는 웹소켓 CLI 클라이언트를 사용한다.</p>
<p>설치</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm install wscat -g</code></pre></div>
<p>연결</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">wscat -c wss://</code></pre></div>
<h2 id="full-text-검색"><a href="#full-text-%EA%B2%80%EC%83%89" aria-label="full text 검색 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Full-text 검색</h2>
<p>이 섹션에서 구현할 내용은 다음과 같다.</p>
<ul>
<li>이름으로 이미지 찾기</li>
<li>모든 필드로 검색 가능하도록 지원</li>
<li>타이핑을 잘못쳐도 검색이 가능하게 지원</li>
<li>하이라이트 지원(검색어와 일치하는 부분은 하이라이트 처리)</li>
<li>검색 결과에 랭킹 지원(더 일치하는 결과를 상위에 보여줌)</li>
</ul>
<p>위의 기능들을 DynamoDB는 지원하지 않기때문에 다른 데이터베이스를 사용해야 한다.</p>
<h3 id="elasticsearch"><a href="#elasticsearch" aria-label="elasticsearch permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ElasticSearch</h3>
<ul>
<li>
<p>엘라스틱서치는 가장 유명한 full-text 검색 솔루션이다.</p>
<ul>
<li>오픈소스이며 <code class="language-text">Elastic</code>에 의해 개발되었다.</li>
<li>AWS를 포함한 많은 클라우드 프로바이더들이 엘라스틱서치 클러스터를 지원한다.</li>
</ul>
</li>
<li>위에서 구현할 내용들을 모두 지원한다.</li>
</ul>
<h3 id="두-개의-데이터베이스"><a href="#%EB%91%90-%EA%B0%9C%EC%9D%98-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4" aria-label="두 개의 데이터베이스 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>두 개의 데이터베이스</h3>
<ul>
<li>엘라스틱서치를 사용하면 두 개의 데이터베이스를 갖게 된다.</li>
<li>두 개의 데이터베이스가 싱크가 맞아야 한다.</li>
<li>
<p>이렇게 두 개의 데이터베이스를 사용하는 패턴을 <code class="language-text">CQRS(Command and Query Responsibility Segregation)</code> 이라고 한다.</p>
<ul>
<li>이는 서로 다른 데이터베이스들로부터 데이터를 읽고 쓰는 것을 의미한다.</li>
</ul>
</li>
<li>DynamoDB에 존재하는 데이터를 엘라스틱서치 데이터베이스에 복사해야 한다.</li>
</ul>
<h3 id="dynamodb와-엘라스틱서치-싱크맞추기"><a href="#dynamodb%EC%99%80-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98-%EC%8B%B1%ED%81%AC%EB%A7%9E%EC%B6%94%EA%B8%B0" aria-label="dynamodb와 엘라스틱서치 싱크맞추기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DynamoDB와 엘라스틱서치 싱크맞추기</h3>
<p>사용자가 이미지를 업로드하면 해당 람다 함수에서 먼저 DynamoDB에 저장하고 그 다음 엘라스틱 서치에도 저장하는 방법이 있을 수 있다.
하지만 이는 효율적인 방법이 아니다. 만약 둘 중에 하나의 데이터베이스가 고장난 상태라면 클라이언트는 계속 기다려야 할 수도 있고 두 개의 데이터베이스는 서로 다른 데이터를 갖게 될 것이다. 따라서 이와같은 방법이 아니라 더 좋은 방법이 필요하다.</p>
<h2 id="dynamodb-스트림"><a href="#dynamodb-%EC%8A%A4%ED%8A%B8%EB%A6%BC" aria-label="dynamodb 스트림 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DynamoDB 스트림</h2>
<p>각 데이터베이스 업데이트가 분리되는 것이 이상적이다. 사용자는 DB 업데이트로부터 분리되어 두 개의 데이터베이스가 모두 업데이트 될때까지 기다리거나 둘 중에 하나의 데이터베이스가 고장이 나더라도 사용자는 이에 영향을 받을 가능성이 적어진다. 엘라스틱서치 데이터베이스는 업데이트가 약간 늦어질 뿐이다.</p>
<p><code class="language-text">데이터 스트리밍</code> 서비스를 이용하여 이를 구현할 수 있다. 다음의 세가지 <code class="language-text">데이터 스트리밍</code>서비스가 있다.</p>
<ul>
<li>오픈소스인 <code class="language-text">Kafka</code></li>
<li>AWS의 <code class="language-text">Kinesis</code></li>
<li><code class="language-text">DynamoDB 업데이트 스트림</code></li>
</ul>
<h3 id="데이터-스트림"><a href="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%8A%A4%ED%8A%B8%EB%A6%BC" aria-label="데이터 스트림 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>데이터 스트림</h3>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ce37c6e809a9f5bc04dea2e4ef4a3785/67fe1/Data_stream.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 45.99375650364204%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABVUlEQVQoz4WQaW+CQBCG+f//yKtJP1SlrUdJTQGr0ZpYTo1yCMvxdmZFRGPSTR7endk5UYqigDwlcLmXZVnz32nGMkpZlDA3M2y9zcMAhhs9gt/SJMX8e4nFcgUhBBWkIbTFG9bWdzVoedOdg/I8r+FCUvOzJlRwPNGgvo6krfDncrIskwlRFOFwOCAMQ/i+jziOERyD2h9HsdTT6XT9TVWjm4IiTZGmAkdK3u12CIIQnuddbVK2g+Bsc4Nmviwoshyhs0Fy3CNrrCShdbOKy+o8bZIkchv2pSJD5FuI9y4E+RTXdbFQu/iZvVN3X67I2I6D9a+N9dYiteDSZDyVQ37btiUOYdkOlqNnrKYvFOND0XUd2mSMT+0DhmliPp/DJDUMA186UalZvd1jGCa06YQYQ6dYpd/vo9Vqo9d7wnA4hKqqtd7D/ibsGwwGaLc76HS68v4Hk2emto/ftsIAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/ce37c6e809a9f5bc04dea2e4ef4a3785/8ac56/Data_stream.webp 240w,
/static/ce37c6e809a9f5bc04dea2e4ef4a3785/d3be9/Data_stream.webp 480w,
/static/ce37c6e809a9f5bc04dea2e4ef4a3785/e46b2/Data_stream.webp 960w,
/static/ce37c6e809a9f5bc04dea2e4ef4a3785/85db8/Data_stream.webp 961w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/ce37c6e809a9f5bc04dea2e4ef4a3785/e4891/Data_stream.png 240w,
/static/ce37c6e809a9f5bc04dea2e4ef4a3785/0ce91/Data_stream.png 480w,
/static/ce37c6e809a9f5bc04dea2e4ef4a3785/b7c40/Data_stream.png 960w,
/static/ce37c6e809a9f5bc04dea2e4ef4a3785/67fe1/Data_stream.png 961w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/ce37c6e809a9f5bc04dea2e4ef4a3785/b7c40/Data_stream.png"
          alt="Data_stream"
          title="Data_stream"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<ul>
<li>데이터 스트림이란 이진 데이터들의 스트림이다.</li>
<li>
<p>Queue와 비슷하다.</p>
<ul>
<li>Queue와 다른점은 각 레코드를 여러번 읽을 수 있다. (Queue는 한번 읽으면 Queue에서 제거됨)</li>
</ul>
</li>
<li>
<p>두 가지 종류의 사용자가 있다.</p>
<ul>
<li>Consumer : 레코드를 읽음</li>
<li>Producers : 레코드를 추가함</li>
</ul>
</li>
</ul>
<p>데이터 스트림은 레코드들의 배열에 불과하다. 각 레코드에는 배열의 인덱스와 같이 순서 번호가 있다. 그리고 각 레코드는 이진 데이터이다. 하지만 DynamoDB와 같이 어떤 서비스에서 제공하는 데이터 스트림이냐에 따라 특정 포맷을 가진다. 이러한 레코드들이 모여 하나의 스트림을 형성한다.</p>
<p>데이터 스트림은 마치 Queue와 비슷하지만 두 가지 중요한 차이점이 있다. 첫번째로 데이터 스트림의 레코드는 여러번 읽어질 수 있다. 특정 컨슈머가 데이터 스트림의 처음부터 끝가지 레코드들을 읽더라도 해당 레코드들은 데이터 스트림에서 제거되지 않는다. 따라서 또 다른 컨슈머도 해당 레코드들을 다시 데이터 스트림에서 읽어올 수 있다.</p>
<p>두번째는 데이터 스트림은 각 컨슈머들의 위치를 추적하지 않는다는 점이다.(The second difference is that a stream does not keep track of a position of each consumer.???)</p>
<p>데이터 스트림의 다른 사용자에는 프로듀서가 있다. 이들은 데이터 스트림에 레코드를 추가한다. 오직 데이터 스트림의 끝에만 레코드를 추가할 수 있다. 데이터 스트림의 중간이나 처음에 레코드를 추가할 수는 없다. 그리고 레코드들은 컨슈머 또는 프로듀서에 의해 제거될 수 없다. 각 레코드들은 만료 시간이 설정되어 있고 해당 만료 시간이 지나면 레코드는 데이터 스트림에서 자동으로 제거된다.</p>
<h3 id="데이터-스트림-서비스"><a href="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%8A%A4%ED%8A%B8%EB%A6%BC-%EC%84%9C%EB%B9%84%EC%8A%A4" aria-label="데이터 스트림 서비스 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>데이터 스트림 서비스</h3>
<ul>
<li>
<p>Kinesis (AWS 서비스)</p>
<ul>
<li>어떤 종류의 데이터도 write 할 수 있다.</li>
<li>아파치 Kafka와 비슷하다. 현재 AWS는 Kinesis, Kafka 둘다 서비스를 제공한다.</li>
</ul>
</li>
<li>
<p>DynamoDB</p>
<ul>
<li>DynamoDB는 데이터베이스이다. 스트림 서비스가 아니다.</li>
<li>하지만 해당 DB 테이블의 데이터들로 데이터 스트림을 읽을 수 있도록 지원한다.</li>
</ul>
</li>
</ul>
<h3 id="kinesis로-full-text-검색-구현하기"><a href="#kinesis%EB%A1%9C-full-text-%EA%B2%80%EC%83%89-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0" aria-label="kinesis로 full text 검색 구현하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kinesis로 full-text 검색 구현하기</h3>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d098cd3016ab20368cf45fe9567766c2/b1718/Kinesis_data_stream.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 41.536863966770504%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABdElEQVQoz42QzUrDQBzEc/Gmb9gXEEG8+QCexKcQTyKC6MWKWPViWwRNY6FfNqbNNrWlH/lospttMv6TtQcriAvD/kiGYXa0NE2xOitO6F4SRkJgOpsjlgn+e7T1D3lo+h2QSKSLIMdhy4NjBhBxBM/14M5dRFGEJElgsxHYYAwppQpcOCb8fpOaZSFL1CcBLvsuiszDte3jbrLA4UUXj9XPzIBR8wVzu5vzdM6xc/CG3SMLXCQqcPJuYFQvI+SCPDG2n2xoxy1snXewSdo4bUM76+CkO6b2S4wbz3Cthmo+8lHYq6Kw36CJUmgJ1fI99QQRx7mpPQtRtF2UmIvb/gz3jo8bajwMhJplbabJlFNT9U/LdhA0fiZOHGa7CA5IMgjikDaMec5xFCIMI4zbOmbMRMR5vqMkr5SKNcYY1mWTejZDn/TR68G0rFwWcY9uo3SFRuUBA8dRflspY61Wq+EvGYbxQ/qrjvJTGdVKFbqu//J/AcCfT7GrKAX1AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/d098cd3016ab20368cf45fe9567766c2/8ac56/Kinesis_data_stream.webp 240w,
/static/d098cd3016ab20368cf45fe9567766c2/d3be9/Kinesis_data_stream.webp 480w,
/static/d098cd3016ab20368cf45fe9567766c2/e46b2/Kinesis_data_stream.webp 960w,
/static/d098cd3016ab20368cf45fe9567766c2/095e2/Kinesis_data_stream.webp 963w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/d098cd3016ab20368cf45fe9567766c2/e4891/Kinesis_data_stream.png 240w,
/static/d098cd3016ab20368cf45fe9567766c2/0ce91/Kinesis_data_stream.png 480w,
/static/d098cd3016ab20368cf45fe9567766c2/b7c40/Kinesis_data_stream.png 960w,
/static/d098cd3016ab20368cf45fe9567766c2/b1718/Kinesis_data_stream.png 963w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/d098cd3016ab20368cf45fe9567766c2/b7c40/Kinesis_data_stream.png"
          alt="Kinesis_data_stream"
          title="Kinesis_data_stream"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<p>우리가 구현할 시스템의 중간에 <code class="language-text">Kinesis 데이터 스트림</code>을 추가한다. 하나의 람다 함수는 이 데이터 스트림에 새로운 이미지를 추가한다. 그리고 다른 두개의 람다 함수를 추가한다. 이 중 하나는 이 데이터 스트림으로부터 데이터를 읽어와서 데이터 스트림에 추가된 각 아이템을 DynamoDB에 추가한다. 다른 람다 함수도 이 데이터 스트림에서 데이터를 읽어와서 <code class="language-text">엘라스틱서치</code>에 데이터를 추가한다.</p>
<h3 id="dynamodb로-full-text-검색-구현하기"><a href="#dynamodb%EB%A1%9C-full-text-%EA%B2%80%EC%83%89-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0" aria-label="dynamodb로 full text 검색 구현하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DynamoDB로 full-text 검색 구현하기</h3>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 931px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/29067ddb007ff04aa0784c05366f35eb/be19a/Dynamodb_data_stream.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.18689581095596%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABmklEQVQoz42QX2vTYBTGA34IL/dx/AR+hYETERQG3gp6sevhnXijeCsDByu5WKXrlhhba9ay1riyWeefJVnWNG2S901+vmlpFqaILxwO53nO+5xzHi3Pc6pvWUspCcc+lxc/mc2ikrvef/1py0YxDcmzbA5mKgshsA596pbPxThRPbIU+5foXDCdBJx3donOR6QiI57NGIdT7j22ubU24JOTFGOQ2X8KxtEE1+kQut8p/giREseCzRdHrG/0Of4WzwWzLC/PrkaBL7mFYJIQhhMm0bT078pUWWJ/+v2XDYvGwrOraRlpmhIlKT/U2aMgJFDbFljBSbV9ovxeDCjsEfTaAcOjSF0m0TzPoxq/XA8ZuKzqPW48N7n50mLlVYvjk1Ncz+dr32ZQf8PZyZDg0sduD7l7u8aT+x84G7lojuNQjcFnh1NnwLN6i9WtAx5sGzzcNun2eor/gt2yMPUtup02QyVq7H9k/c5rnj56S/ewj2YYBtUwTZMDlTumQdcysN8v8pJr7O2xW39Hs7m/qBsNajs1dF1XWJPfg46awHQejC8AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/29067ddb007ff04aa0784c05366f35eb/8ac56/Dynamodb_data_stream.webp 240w,
/static/29067ddb007ff04aa0784c05366f35eb/d3be9/Dynamodb_data_stream.webp 480w,
/static/29067ddb007ff04aa0784c05366f35eb/c4004/Dynamodb_data_stream.webp 931w"
          sizes="(max-width: 931px) 100vw, 931px"
          type="image/webp"
        />
        <source
          srcset="/static/29067ddb007ff04aa0784c05366f35eb/e4891/Dynamodb_data_stream.png 240w,
/static/29067ddb007ff04aa0784c05366f35eb/0ce91/Dynamodb_data_stream.png 480w,
/static/29067ddb007ff04aa0784c05366f35eb/be19a/Dynamodb_data_stream.png 931w"
          sizes="(max-width: 931px) 100vw, 931px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/29067ddb007ff04aa0784c05366f35eb/be19a/Dynamodb_data_stream.png"
          alt="Dynamodb_data_stream"
          title="Dynamodb_data_stream"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<p>이 수업에서 구현할 내용은 이 방법이다. 먼저 DynamoDB 테이블에 데이터 스트림 기능을 사용할 수 있도록 한다. 현재 구현된대로 DynamoDB 테이블에 레코드들이 추가될 것이고 또다른 람다함수를 새로 구현하여 DynamoDB 테이블에 업데이트된 스트림을 읽어와서 엘라스틱서치에 복사한다.</p>
<h2 id="데이터-스트림-스케일링"><a href="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%8A%A4%ED%8A%B8%EB%A6%BC-%EC%8A%A4%EC%BC%80%EC%9D%BC%EB%A7%81" aria-label="데이터 스트림 스케일링 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>데이터 스트림 스케일링</h2>
<ul>
<li>서비스가 확장됨에 따라 데이터 스트림도 확장해야 한다.</li>
<li>
<p>데이터 스트림 확장방법은 Nosql 데이터베이스를 스케일링 하는 방법과 비슷하다.</p>
<ul>
<li>하나의 데이터 스트림이 여러개로 분할된다.</li>
<li>분할된 각 부분은 <code class="language-text">shard</code>라고 부른다.</li>
<li>각 <code class="language-text">shard</code>는 데이터 스트림에 쓰여진 레코드들의 일부를 가지고 있다.</li>
</ul>
</li>
</ul>
<p>그렇다면 어떤 <code class="language-text">shard</code>를 선택해야 할지 어떻게 알 수 있을까?
DynamoDB의 각 레코드의 <code class="language-text">Key</code>를 사용하여 <code class="language-text">shard</code>를 선택한다. 새로운 데이터가 데이터 스트림에 쓰여지면 이는 어떤 <code class="language-text">shard</code>에도 쓰여질 수 있지만 같인 <code class="language-text">Key</code>를 가지고 있는 데이터는 항상 같은 <code class="language-text">shard</code>에 쓰여진다.</p>
<h3 id="dynamodb-데이터-스트림"><a href="#dynamodb-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%8A%A4%ED%8A%B8%EB%A6%BC" aria-label="dynamodb 데이터 스트림 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DynamoDB 데이터 스트림</h3>
<p>DynamoDB 테이블은 파티션으로 나뉘어져 있고 각 파티션은 각각 <code class="language-text">Shard</code>를 가지고 있다. 따라서 우리는 각 <code class="language-text">shard</code>의 모든 업데이트 사항을 엘라스틱서치에 복사해야 한다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 767px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/25ecce5397a7afd865f11003a34333c0/fd398/dynamoDB_data_stream.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 43.285528031290745%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAAB6ElEQVQoz1WSy27TUBCGvYMXgVcAiQ1igUCIJS/AmkdgV5VNd2xggVhQlKoSBVoJoQhFQIBFi0qaXiBp6IW22HHjJAbf7ePzMXYSlB5p5DOjmfH3zxmD8uRolTN0+pgnJpZlk2uJ5qDkosd25ohbxjRnzHj9vk91PS5zYgkEQUTqeWjfRwcBRBEqzcrkKIwwTRu72yMbx/T0D4uGC0++svywBq0tku0dSBLWu39ZaVu86dh8Ph6QJllZoLKcwe9DPOdU/CmyCbTkGPncLPrqZfxbN4ivX8NvbnDx7RHGfBuj0uH84i7HvSG5NA2FvLf9hWGnQSRKchmTyjSeq4iDMWHy/QdJrUZSr5N+qpO5Lu9Mn/k9l8q+y/LRH4IwJs+KYkXYMwmdrlArYVKsfrC4f7fB0uNuSW0oPyDrOSMbCInMZhhlmF5cWj9MyYSuoCkIUs9FxVFJVjT8WD3g3p0aT+d+So40jGZnSK9cIrx9k6SQvNnkQiH5WauUfG6xzYnjolNFJA9lb9bp7zZEYlQO8HDPorqywbfV/VKBEa+tkS5USJZekLx6SdYf8FykzjRtHmyd8qjl4EmxViPJnnWA3/0lNJNV0v/3qHwUeXzSaZMiGZCoES8bWbE2erIixXdqB4u5jZqPev8DUa6Ws9uo6mAAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/25ecce5397a7afd865f11003a34333c0/8ac56/dynamoDB_data_stream.webp 240w,
/static/25ecce5397a7afd865f11003a34333c0/d3be9/dynamoDB_data_stream.webp 480w,
/static/25ecce5397a7afd865f11003a34333c0/e0ad8/dynamoDB_data_stream.webp 767w"
          sizes="(max-width: 767px) 100vw, 767px"
          type="image/webp"
        />
        <source
          srcset="/static/25ecce5397a7afd865f11003a34333c0/e4891/dynamoDB_data_stream.png 240w,
/static/25ecce5397a7afd865f11003a34333c0/0ce91/dynamoDB_data_stream.png 480w,
/static/25ecce5397a7afd865f11003a34333c0/fd398/dynamoDB_data_stream.png 767w"
          sizes="(max-width: 767px) 100vw, 767px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/25ecce5397a7afd865f11003a34333c0/fd398/dynamoDB_data_stream.png"
          alt="dynamoDB_data_stream"
          title="dynamoDB_data_stream"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h3 id="dynamodb-테이블에-스트림-사용-설정"><a href="#dynamodb-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%97%90-%EC%8A%A4%ED%8A%B8%EB%A6%BC-%EC%82%AC%EC%9A%A9-%EC%84%A4%EC%A0%95" aria-label="dynamodb 테이블에 스트림 사용 설정 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DynamoDB 테이블에 스트림 사용 설정</h3>
<p>DynamoDB 테이블에서 스트림을 사용하기 위해서는 <code class="language-text">serverless</code> 파일 설정에서 다음 <code class="language-text">StreamSpecification</code> 항목을 추가해야 한다.
<code class="language-text">StreamViewType</code>은 스트림의 레코드에 들어갈 타입을 지정한다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">ImagesDynamoDBTable</span><span class="token punctuation">:</span>
 <span class="token key atrule">Type</span><span class="token punctuation">:</span> <span class="token string">"AWS::DynamoDB::Table"</span>
 <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
   <span class="token punctuation">...</span>
   <span class="token key atrule">StreamSpecification</span><span class="token punctuation">:</span>
     <span class="token key atrule">StreamViewType</span><span class="token punctuation">:</span> NEW_AND_OLD_IMAGES</code></pre></div>
<p><code class="language-text">StreamViewType</code> 에는 다음의 4가지 타입이 있다.</p>
<ul>
<li>NEW<em>AND</em>IMAGES : 스트림이 업데이트되기 전과 이후의 2가지 버전이 있다.</li>
<li>NEW_IMAGE : 스트림이 업데이트된 이후의 새로운 버전만 있다.</li>
<li>OLD_IMAGE: 스트림이 업데이트되기 전의 버전만 있다.</li>
<li>KEYS_ONLY: 스트림에 업데이트된 아이템들의 Key 속성만 가지고 있다.</li>
</ul>
<h3 id="스트림-업데이트-샘플-코드"><a href="#%EC%8A%A4%ED%8A%B8%EB%A6%BC-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-%EC%83%98%ED%94%8C-%EC%BD%94%EB%93%9C" aria-label="스트림 업데이트 샘플 코드 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>스트림 업데이트 샘플 코드</h3>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Process a batch of records</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> record <span class="token keyword">of</span> event<span class="token punctuation">.</span>Records<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newItem <span class="token operator">=</span> record<span class="token punctuation">.</span>dynamodb<span class="token punctuation">.</span>newImage<span class="token punctuation">;</span> <span class="token comment">//modified item</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> newItem<span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token constant">S</span><span class="token punctuation">;</span> <span class="token comment">// String attribute</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> newItem<span class="token punctuation">.</span>count<span class="token punctuation">.</span><span class="token constant">N</span><span class="token punctuation">;</span> <span class="token comment">// Number attribute</span>
    <span class="token comment">// Process a stream record</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>위와 같이 DynamoDB의 아이템 속성을 접근하는 방법을 <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Programming.LowLevelAPI.html#Programming.LowLevelAPI.ResponseFormat" target="_blank" rel="nofollow noopener noreferrer">DynamoDB JSON</a>이라고 한다.</p>
<h2 id="엘라스틱서치"><a href="#%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98" aria-label="엘라스틱서치 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>엘라스틱서치</h2>
<ul>
<li>
<p>엘라스틱서치 데이터</p>
<ul>
<li>Indexes - RDBMS 데이터베이스의 테이블과 같은것</li>
<li>Types</li>
<li>하나의 Index에는 여러개의 타입을 포함할 수 있음</li>
<li>엘라스틱서치 7.0에서는 <code class="language-text">deprecated</code>되었지만 이 수업에 사용하는 버전에는 사용할 수 있음</li>
<li>여러개의 <code class="language-text">shard</code>에 분할될 수 있음</li>
</ul>
</li>
</ul>
<h3 id="아마존-엘라스틱서치"><a href="#%EC%95%84%EB%A7%88%EC%A1%B4-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98" aria-label="아마존 엘라스틱서치 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>아마존 엘라스틱서치</h3>
<ul>
<li>아마존이 관리해주는 엘라스틱서치 서비스임</li>
<li>
<p>AWS가 배포와 설정을 해준다.</p>
<ul>
<li>CloudFormation을 통해 생성가능</li>
</ul>
</li>
<li>
<p>두가지 서비스가 생성</p>
<ul>
<li>엘라스틱서치: 데이터 업로드와 쿼리</li>
<li>키바나 : 엘라스틱서치를 위한 UI 인터페이스</li>
</ul>
</li>
<li>엘라스틱서치는 다른 Provider가 제공하는 것을 사용할 수도 있음</li>
</ul>
<h3 id="엘라스틱-서치-연결"><a href="#%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1-%EC%84%9C%EC%B9%98-%EC%97%B0%EA%B2%B0" aria-label="엘라스틱 서치 연결 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>엘라스틱 서치 연결</h3>
<p>다음은 Nodejs에서 엘라스틱서치 클라이언트를 생성하는 샘플코드이다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> elasticsearch <span class="token keyword">from</span> <span class="token string">'elasticsearch'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> httpAwsEs <span class="token keyword">from</span> <span class="token string">'http-aws-es'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> esHost <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">ES_ENDPOINT</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> es <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">elasticsearch<span class="token punctuation">.</span>Client</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  hosts<span class="token punctuation">:</span> <span class="token punctuation">[</span>esHost<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 엘라스틱서치 클라이언트가 AWS가 제공하는 엘라스틱서치와 통신하는 방법을 설정한다.</span>
  connectionClass<span class="token punctuation">:</span> httpAwsEs
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>다음은 엘라스틱서치에 도큐먼트를 저장하는 방법이다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">await</span> es<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  index<span class="token punctuation">:</span> <span class="token string">'images-index'</span><span class="token punctuation">,</span>
  type<span class="token punctuation">:</span> <span class="token string">'images'</span><span class="token punctuation">,</span>
  id<span class="token punctuation">:</span> <span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token comment">// Document ID</span>
  body<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// Document to store</span>
    title<span class="token punctuation">:</span> <span class="token string">'title'</span><span class="token punctuation">,</span>
    imageUrl<span class="token punctuation">:</span> <span class="token string">'https://example.com/image.png'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2 id="심플-노티피케이션-서비스sns"><a href="#%EC%8B%AC%ED%94%8C-%EB%85%B8%ED%8B%B0%ED%94%BC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%84%9C%EB%B9%84%EC%8A%A4sns" aria-label="심플 노티피케이션 서비스sns permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>심플 노티피케이션 서비스(SNS)</h2>
<h3 id="여러개의-s3-이벤트-핸들러-함수-구현하기"><a href="#%EC%97%AC%EB%9F%AC%EA%B0%9C%EC%9D%98-s3-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%ED%95%B8%EB%93%A4%EB%9F%AC-%ED%95%A8%EC%88%98-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0" aria-label="여러개의 s3 이벤트 핸들러 함수 구현하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>여러개의 S3 이벤트 핸들러 함수 구현하기</h3>
<p>만약 하나의 S3 버켓에 대해 두개의 이벤트 핸들러 함수를 구현하려면 어떻게 해야 할까?</p>
<ul>
<li>웹소켓 노티피케이션 핸들러</li>
<li>이미지 리사이징 핸들러</li>
</ul>
<p>즉, S3 버켓에 이미지가 업로드 되었을 때 위 2개 각각의 핸들러 함수가 작동해야 하는것이다. 하지만 S3는 오직 한개의 노티피케이션 타겟을 지원한다. 즉, S3 이벤트가 발생했을때 오직 한 개의 람다 함수만 호출할 수 있다.</p>
<p>심플 노티피케이션 서비스(SNS)라는 다른 서비스를 사용하여 이를 구현할 수 있다. S3 버켓에서 이벤트 발생시 SNS에게 이 이벤트를 보내고 SNS가 여러개의 다른 타겟 서비스에게 이벤트를 브로드 캐스팅하면 된다.</p>
<h3 id="sns"><a href="#sns" aria-label="sns permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SNS</h3>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 792px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7f4aac35b25701ee88cb534a8fc83885/44fa7/Simple_notification_service.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 44.6969696969697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABeUlEQVQoz3WSy0rDQBSG+x7iY4g+ghuXSh9AQVz6CD6EzyC4UYqLurALr1BcFVFoS28mTa9pkiaZSWbm98zEhrTiwMncv/zn/FNCoSmlTJgxhaRgnENIBbV2BvjvXim7rH4RWROSUEoaZDSf0gI3+1KqHCApopkDHrhr4NLIdXB6WcZD484s8jQhToon28NutYeDRwt7931UunOSGyNmHEmSIE0F3O4XwnEfqZDgnGcKrck3Di/2UXm9NgsxZ0DKUXc8HD3bOKsPUaa+ZnlAwmmfgxNUQ4JhB/HcMT+JwjADarK/8LEMwrx2+vvhxjh+s3H+7uCE+pdRYMqgszY1o1OLQZsUWuspbxZXqMyOmu1j66aFnWoH27dtXLUmJD9ExBilm5q0Z589LK0pQlLHYpYpXDlUdEpQOpCi4HVmUiqEAemQZFw0dsH90Bik53+AK5VFJ1ehCm9FX9ZQp9GE2xyYuut5/myKKRf7zaY2wPEiAPOWlJHIFf4AqJew5PLULYEAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/7f4aac35b25701ee88cb534a8fc83885/8ac56/Simple_notification_service.webp 240w,
/static/7f4aac35b25701ee88cb534a8fc83885/d3be9/Simple_notification_service.webp 480w,
/static/7f4aac35b25701ee88cb534a8fc83885/22975/Simple_notification_service.webp 792w"
          sizes="(max-width: 792px) 100vw, 792px"
          type="image/webp"
        />
        <source
          srcset="/static/7f4aac35b25701ee88cb534a8fc83885/e4891/Simple_notification_service.png 240w,
/static/7f4aac35b25701ee88cb534a8fc83885/0ce91/Simple_notification_service.png 480w,
/static/7f4aac35b25701ee88cb534a8fc83885/44fa7/Simple_notification_service.png 792w"
          sizes="(max-width: 792px) 100vw, 792px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/7f4aac35b25701ee88cb534a8fc83885/44fa7/Simple_notification_service.png"
          alt="Simple_notification_service"
          title="Simple_notification_service"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<ul>
<li>
<p>다른 서비스들에게 메시지를 보내주는 서비스이다.</p>
<ul>
<li>퍼블리셔: 메시지를 퍼블리싱</li>
<li>구독자: 들어오는 메시지를 소비</li>
</ul>
</li>
<li>
<p>퍼블리셔와 구독자는 토픽으로 연결됨</p>
<ul>
<li>하나의 토픽은 여러명의 구독자를 가질 수 있음</li>
<li>구독자는 여러가지의 프로토콜을 사용할 수 있음(Lambda, http, email, sms, etc..)</li>
</ul>
</li>
<li>토픽에 메시지가 보내지면 해당 토픽의 모든 구독자들에게 메시지가 전달됨</li>
<li>Retry가 구현되어 있음(메시지 전달이 실패할 경우 구독자에게 메시지를 다시 보내는 것을 여러번 시도함)</li>
</ul>
<h3 id="sns-이벤트-샘플-코드"><a href="#sns-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EC%83%98%ED%94%8C-%EC%BD%94%EB%93%9C" aria-label="sns 이벤트 샘플 코드 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SNS 이벤트 샘플 코드</h3>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">exports<span class="token punctuation">.</span><span class="token function-variable function">hander</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>

  <span class="token comment">// Get S3 event passed through SNS</span>
  <span class="token keyword">const</span> s3EventStr <span class="token operator">=</span> event<span class="token punctuation">.</span>Records<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Sns<span class="token punctuation">.</span>Message<span class="token punctuation">;</span>

  <span class="token comment">// Parse JSON string into an object</span>
  <span class="token keyword">const</span> s3Event <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>s3EventStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h3 id="sns-토픽-생성"><a href="#sns-%ED%86%A0%ED%94%BD-%EC%83%9D%EC%84%B1" aria-label="sns 토픽 생성 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SNS 토픽 생성</h3>
<p>다음의 코드는 AWS <code class="language-text">CloudFormation</code> 에서 제공하는 <code class="language-text">Join</code> 함수를 사용하여 각 string 들을 붙여서 <code class="language-text">arn</code>을 정의하고 있다. <code class="language-text">Fn::Join:</code> 는 <code class="language-text">Join</code>함수를 의미하고 첫번째 인자로 주어지는 <code class="language-text">:</code>를 사용하여 그 다음의 모든 인자들을 붙여 하나의 string으로 만든다는 의미이다. 결과적으로 이 <code class="language-text">resizeImage</code> 핸들러가 구독하는 SNS 토픽의 arn은 다음과 같이 정의된다. <code class="language-text">arn:aws:sns:us-east-1:143036976037:myTopic</code></p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">ResizeImage</span><span class="token punctuation">:</span>
  <span class="token key atrule">handler</span><span class="token punctuation">:</span> src/s3/resizeImage.hanlder
  <span class="token key atrule">events</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">sns</span><span class="token punctuation">:</span>
        <span class="token key atrule">arn</span><span class="token punctuation">:</span>
          <span class="token key atrule">Fn::Join</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">":"</span>
            <span class="token punctuation">-</span> <span class="token punctuation">-</span> <span class="token string">"arn:aws:sns"</span>
              <span class="token punctuation">-</span> <span class="token key atrule">Ref</span><span class="token punctuation">:</span> <span class="token string">"AWS::Region"</span>
              <span class="token punctuation">-</span> <span class="token key atrule">Ref</span><span class="token punctuation">:</span> <span class="token string">"AWS::AccountId"</span>
              <span class="token punctuation">-</span> myTopic
        <span class="token key atrule">topicName</span><span class="token punctuation">:</span> myTopic</code></pre></div>
<h1 id="인증"><a href="#%EC%9D%B8%EC%A6%9D" aria-label="인증 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>인증</h1>
<p>이번 인증 파트에서 공부할 내용은 다음과 같다. </p>
<ul>
<li>지금까지 구현한 API를 위한 인증 기능 구현하기</li>
<li>
<p>소셜 로그인과 연동하는 방법</p>
<ul>
<li>OAuth 2.0, OpenID 프로토콜 사용</li>
<li>Auth0 라는 인증 서비스 사용</li>
<li>JWT 적용</li>
</ul>
</li>
<li>시크릿키 안전하게 저장하기</li>
<li>
<p>람다 미들웨어 사용</p>
<ul>
<li>람다 함수의 보일러플레이트 부분 제거하고 복잡한 람다함수 단순화할 수 있음</li>
</ul>
<h2 id="api-게이트웨이로-인증-구현하기"><a href="#api-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4%EB%A1%9C-%EC%9D%B8%EC%A6%9D-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0" aria-label="api 게이트웨이로 인증 구현하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API 게이트웨이로 인증 구현하기</h2>
<ul>
<li>API 게이트웨이는 어플리케이션의 진입점이다.</li>
<li>API 게이트웨이로 인증을 구현하는 몇가지 방법이 있다.</li>
<li>IAM 인증 </li>
<li>아마존 Cognito</li>
<li>커스텀 인증</li>
</ul>
<h3 id="커스텀-인증"><a href="#%EC%BB%A4%EC%8A%A4%ED%85%80-%EC%9D%B8%EC%A6%9D" aria-label="커스텀 인증 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>커스텀 인증</h3>
<p>이 수업에서는 커스텀 인증 방법을 이용하여 API 인증 기능을 구현한다. 인증이 구현되는 과정은 아래의 이미지와 같다. 사용자가 인증 서비스를 통해 로그인을 하며 해당 서비스에서는 우리의 어플리케이션에 토큰을 보내주고 해당 토큰이 API 게이트웨이에 전달되고 이는 다시 <code class="language-text">authorizer</code>이라는 람다함수를 통해 해당 토큰의 유효성을 인증 서비스에 검증 받는 작업을 통해 사용자의 인증이 이루어진다. 인증이 정상적으로 이루어지면 <code class="language-text">authorizer</code> 람다 함수는 <code class="language-text">IAM 정책</code> 정보를 리턴하고  API 게이트웨이는 서비스를 구현한 람다 함수를 호출할 수 있게 된다. API 게이트웨이에는 캐싱 기능이 있어 인증 정보를 캐시해두어 불필요한 인증작업이 반복적으로 일어나는 것을 피할 수 있다.</p>
</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 663px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/6e52bb1c7901f9894de06bf6cb7a3a32/23bd8/custom_authorizer.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 53.09200603318251%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABoklEQVQoz3VTu07DQBDMZ1BDRUFBD3+BxD/Q8D9IFEgIiQpBQQMUgFKliFJAojxIggN52o7Pdu7ss2/YsxMnTsJKI/seO7OvK4AsimPMZJRAELZZGIaw7SkYcxHTfW1KqdxXW0Efnr52cfD4heOnDnbvm7ioDukoBicSKWWCgP5HtTLYwICak6wiI6QVTt562Hto4YgId+6auKyb5CExHE8wIXiuB0XCVr0CPuplzikZcqSFQAiYpgWPc0jas6cOHIclF3T0GmqeoiS4UQzbsuG67kZZtE+SsuAC3wMT7b6JXn+MOIoQRWktNZnWDh0H46trsOcXiCBAQEgEiUQwC5L785S1MjlXGgaKVQMtY6hZwEmEMYaZ70NTWx9VlPcP8XN2Dkn1DEOJkEg5ZTj+LMHp1lLCRe7WlKHV+SXlMAtfE+ruJpPg+ejf3MJ9L26kKmcuRegtI1zt0n9rXcWJUFTDZGNrh5Mars5SHKvcbK06+D5HqdxDrTHMmrR+N4sw3cRWxcU6CCTahonBiOUHOp/MknCb5V+Cgu95ENSEnNga4R/HUlABzbvtpgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/6e52bb1c7901f9894de06bf6cb7a3a32/8ac56/custom_authorizer.webp 240w,
/static/6e52bb1c7901f9894de06bf6cb7a3a32/d3be9/custom_authorizer.webp 480w,
/static/6e52bb1c7901f9894de06bf6cb7a3a32/c294c/custom_authorizer.webp 663w"
          sizes="(max-width: 663px) 100vw, 663px"
          type="image/webp"
        />
        <source
          srcset="/static/6e52bb1c7901f9894de06bf6cb7a3a32/e4891/custom_authorizer.png 240w,
/static/6e52bb1c7901f9894de06bf6cb7a3a32/0ce91/custom_authorizer.png 480w,
/static/6e52bb1c7901f9894de06bf6cb7a3a32/23bd8/custom_authorizer.png 663w"
          sizes="(max-width: 663px) 100vw, 663px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/6e52bb1c7901f9894de06bf6cb7a3a32/23bd8/custom_authorizer.png"
          alt="custom_authorizer"
          title="custom_authorizer"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h3 id="커스텀-인증-람다-함수-구현하기"><a href="#%EC%BB%A4%EC%8A%A4%ED%85%80-%EC%9D%B8%EC%A6%9D-%EB%9E%8C%EB%8B%A4-%ED%95%A8%EC%88%98-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0" aria-label="커스텀 인증 람다 함수 구현하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>커스텀 인증 람다 함수 구현하기</h3>
<p>커스텀 인증 람다 함수는 다음의 샘플코드처럼 이 요청이 호출할 수 있는 람다 함수를 정의하는 IAM 정책을 리턴한다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
   <span class="token comment">// Contains a token</span>
   <span class="token keyword">const</span> token <span class="token operator">=</span> event<span class="token punctuation">.</span>authorizationToken

   <span class="token comment">// Check a token here</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
     principalId<span class="token punctuation">:</span> <span class="token string">'user-id'</span><span class="token punctuation">,</span> <span class="token comment">// Unique user id</span>
     policyDocument<span class="token punctuation">:</span> <span class="token punctuation">{</span>
       Version<span class="token punctuation">:</span> <span class="token string">'2012-10-17'</span><span class="token punctuation">,</span>
       Statement<span class="token punctuation">:</span> <span class="token punctuation">[</span>
         <span class="token punctuation">{</span>
           Action<span class="token punctuation">:</span> <span class="token string">'execute-api:Invoke'</span><span class="token punctuation">,</span>
           Effect<span class="token punctuation">:</span> <span class="token string">'Allow'</span><span class="token punctuation">,</span>
           Resource<span class="token punctuation">:</span> event<span class="token punctuation">.</span>methodArn
         <span class="token punctuation">}</span>
       <span class="token punctuation">]</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

 <span class="token punctuation">}</span></code></pre></div>
<p>한편, API 게이트웨이는 인증 람다 함수가 리턴한 결과를 캐싱할 수 있다. 이는 같은 토큰에 대해 인증 람다 함수를 반복해서 호출하지 않아도 되게끔 한다. 만약 리턴하는 IAM 정책이 현재 요청이 필요로 하는 함수만을 결과에 리턴한다면 이를 캐싱을 해두더라도 만약 사용자가 다른 함수 호출 요청을 보내면 인증이 실패하게 된다. 따라서 인증 람다함수는 현재 사용자가 접근할 수 있는 모든 함수를 정의하는 IAM 정책을 리턴하는 것이 좋다. </p>
<p>리턴하는 IAM 정책을 다음과 같이 정의하면 이 사용자는 이 어플리케이션의 모든 람다 함수를 호출할 수 있다는 뜻이 된다. </p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token punctuation">{</span>
     principalId<span class="token punctuation">:</span> <span class="token string">'user-id'</span><span class="token punctuation">,</span> <span class="token comment">// Unique user id</span>
     policyDocument<span class="token punctuation">:</span> <span class="token punctuation">{</span>
       Version<span class="token punctuation">:</span> <span class="token string">'2012-10-17'</span><span class="token punctuation">,</span>
       Statement<span class="token punctuation">:</span> <span class="token punctuation">[</span>
         <span class="token punctuation">{</span>
           Action<span class="token punctuation">:</span> <span class="token string">'execute-api:Invoke'</span><span class="token punctuation">,</span>
           Effect<span class="token punctuation">:</span> <span class="token string">'Allow'</span><span class="token punctuation">,</span>
           Resource<span class="token punctuation">:</span> <span class="token string">'*'</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">]</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span></code></pre></div>
<h3 id="cors와-인증"><a href="#cors%EC%99%80-%EC%9D%B8%EC%A6%9D" aria-label="cors와 인증 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cors와 인증</h3>
<ul>
<li>
<p>응답 객체에 다음 헤더를 추가해야 한다. </p>
<ul>
<li>Access-Control-Allow-Credentials=true</li>
</ul>
</li>
<li>먼저 인증 람다 함수에서 이 헤더를 리턴해야 하고 그 다음은 API 게이트웨이에서 클라이언트에게 이를 리턴해야 한다.</li>
<li>인증 람다 함수에서 인증이 실패하더라도 이 헤더는 셋팅이 되어야 한다. </li>
<li>왜냐하면 인증 실패시 디폴트로 이 헤더 값이 셋팅되지 않기 때문에 클라언트의 웹브라우저는 인증 실패 코드가 아니라 잘못된 결과(Cors 에러)를 보여줄 것이기 때문이다.</li>
</ul>
<p>이를 위한 API 게이트웨이 응답 리소스 설정은 다음과 같다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml">//serverless.yaml

<span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token key atrule">Resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">GatewayResponseDefault4XX</span><span class="token punctuation">:</span>
      <span class="token key atrule">Type</span><span class="token punctuation">:</span> <span class="token string">'AWS::ApiGateway::GatewayResponse'</span>
      <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
        <span class="token key atrule">ResponseParameters</span><span class="token punctuation">:</span>
          <span class="token key atrule">gatewayresponse.header.Access-Control-Allow-Origin</span><span class="token punctuation">:</span> <span class="token string">"'*'"</span>
          <span class="token key atrule">gatewayresponse.header.Access-Control-Allow-Header</span><span class="token punctuation">:</span> <span class="token string">"'Content-Type, X-Amz-Date, Authorization'"</span>
          <span class="token key atrule">gatewayresponse.header.Access-Control-Allow-Methods</span><span class="token punctuation">:</span> <span class="token string">"'GET,OPTIONS,POST'"</span>
        <span class="token key atrule">ResponseType</span><span class="token punctuation">:</span> DEFAULT_4XX
        <span class="token key atrule">RestApiId</span><span class="token punctuation">:</span>
          <span class="token key atrule">Ref</span><span class="token punctuation">:</span> <span class="token string">'ApiGatewayRestApi'</span></code></pre></div>
<h3 id="auth0-서비스"><a href="#auth0-%EC%84%9C%EB%B9%84%EC%8A%A4" aria-label="auth0 서비스 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Auth0 서비스</h3>
<ul>
<li>자체적으로 인증, 인가 서비스를 구현할 수 있지만 소요가 많이든다. </li>
<li>이 수업에서는 Auth0 서비스를 사용한다. </li>
<li>이는 인증, 인가를 위한 서비스이다.</li>
<li>
<p>다음의 항목들을 지원한다.</p>
<ul>
<li>OAuth 2.0, OpenID</li>
<li>소셜 로그인</li>
<li>Multi-factor 인증</li>
</ul>
</li>
<li>무료 버전이 있다. </li>
</ul>
<h3 id="oauth-과-openid"><a href="#oauth-%EA%B3%BC-openid" aria-label="oauth 과 openid permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OAuth 과 OpenID</h3>
<p>OAuth 프로토콜 탄생 배경</p>
<p>만약 채팅 어플리케이션을 만드는데 이 어플리케이션에서 특정 사용자의 Gmail에 등록된 연락처 목록을 가져오려면 어떻게 해야할까? 가장 직관적인 솔루션은 사용자가 이 채팅 어플리케이션에 지메일 아이디 비밀번호를 제공하여 채팅 어플리케이션에서 이 사용자의 gmail에 로그인하여 연락처 목록을 가져올 수 있을 것이다. 하지만 이 방법은 당연히 보안상으로 대단히 잘못되었다.</p>
<p>따라서 이 채팅 어플리케이션에서 Gmail에 접근하여 이 사용자의 연락처를 가져오는 것만 허용하도록 하는 방법이 필요했다. 이러한 방법을 제공하는 것이 <code class="language-text">OAuth</code> 프로토콜이다. </p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 740px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3d6f607e469c15789ddcc79ddb75db68/b251b/OAuth_solution.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 45.13513513513514%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABYklEQVQoz6WST0vDMBjG61fyw3jx5Ffx4Fk8iYqoJz05BupNVPSioKibyGBO3VbrljT9s9Q2afOYpNbJdlAw8JQmffPL0+eNo5TCf8bkfsc8Yv6B7oDhjQQQQiBJEgQsgOe9I45jpGkKmWVokBFO3mKcaZ27IbjIp6AW2B/4uO14uG/3wTnXIA+u64IxphWAUB8QKWYP2nC2HjGz24Kz94LLIbeQXAMrqAVKmaPT9TCkAaR2WBSFdeprUKad5XpuRu2JYvmBYL3lY2mzhmEQlw5//L5TkfNcTmVjwEZRFIEQohezcUHjCipN7GFSyrHD6sU4Kb6cTA6zIQxD+DpDOkjBSAYaKsSjpJTO2dRMAU34IhNlY3hiZedaOgTUF3vYmOtiZ6GH7fke2ncUzc4rinzcHKfMQH0vVAeY5hig+aQKZauu9xmOVyhOVwku1iI0b55RPzzSDvkE0IDwy31Uf7uPn7vSsRFEdIJgAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/3d6f607e469c15789ddcc79ddb75db68/8ac56/OAuth_solution.webp 240w,
/static/3d6f607e469c15789ddcc79ddb75db68/d3be9/OAuth_solution.webp 480w,
/static/3d6f607e469c15789ddcc79ddb75db68/ca4a8/OAuth_solution.webp 740w"
          sizes="(max-width: 740px) 100vw, 740px"
          type="image/webp"
        />
        <source
          srcset="/static/3d6f607e469c15789ddcc79ddb75db68/e4891/OAuth_solution.png 240w,
/static/3d6f607e469c15789ddcc79ddb75db68/0ce91/OAuth_solution.png 480w,
/static/3d6f607e469c15789ddcc79ddb75db68/b251b/OAuth_solution.png 740w"
          sizes="(max-width: 740px) 100vw, 740px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/3d6f607e469c15789ddcc79ddb75db68/b251b/OAuth_solution.png"
          alt="OAuth_solution"
          title="OAuth_solution"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h3 id="oauth-flow"><a href="#oauth-flow" aria-label="oauth flow permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OAuth Flow</h3>
<ul>
<li>
<p>다음은 두 시스템간에 상호작용을 할 수 있도록 지원하는 프로토콜이다. </p>
<ul>
<li>OAuth 2.0 : 써드 파티 서비스가 다른 서비스의 리소스에 접근할 수 있도록 인가하는 프로토콜이다. </li>
<li>OpenID: OAuth 프로토콜 위에서 인증을 제공하는 프로토콜이다. </li>
</ul>
</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 751px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/43273692ace30a0200299a3b5193e1bb/21997/OAuth_flow.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 45.938748335552596%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABgUlEQVQoz3WSvW7VQBCFXfNK9HS8ByVdGl4kFRRQ0VCnoaFBIhQgJZAQXYnc6xBf/67t9f55P2ZNjKLoZqSjXY19zpwzdqYny22taNTIobJh5qzWfK8036qRanIQZ8I8E33AbXLcr2vs5W9Co8j+7Bu+XGw52+xw1uKcW2BsIgY+bWuytz948v6S7M05r05zaCu2ZUl7foV99hL7/Aj39AXu+AOZD4HrvED14jBGZpmckBykqibP64uSd5uW458lXwtFtIZea0yr8B9P/+HkM+FqS7awROhQJadjr+QW/vdM3zGMmscqW4nzHLESedITfd9T3Bbkux15foM2liAzvbxT7Ev2xZ627WjqRtLXdHJq1S/G7gS93CNmMovYMIyCYYFSiq7rlufee4wxi5N1NSviXcp7DufHY48jtbgYBr0IpjSHKq4Og3yYFDcRS4lUS4xpmoRs0bKv1K+qBie/SXK5Dk8CD5GtVtOZRG9kZ2lHQchrr2kaRllDEkoO73Me1l/6yrIYmivpawAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/43273692ace30a0200299a3b5193e1bb/8ac56/OAuth_flow.webp 240w,
/static/43273692ace30a0200299a3b5193e1bb/d3be9/OAuth_flow.webp 480w,
/static/43273692ace30a0200299a3b5193e1bb/0d6a7/OAuth_flow.webp 751w"
          sizes="(max-width: 751px) 100vw, 751px"
          type="image/webp"
        />
        <source
          srcset="/static/43273692ace30a0200299a3b5193e1bb/e4891/OAuth_flow.png 240w,
/static/43273692ace30a0200299a3b5193e1bb/0ce91/OAuth_flow.png 480w,
/static/43273692ace30a0200299a3b5193e1bb/21997/OAuth_flow.png 751w"
          sizes="(max-width: 751px) 100vw, 751px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/43273692ace30a0200299a3b5193e1bb/21997/OAuth_flow.png"
          alt="OAuth_flow"
          title="OAuth_flow"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h3 id="auth0-인증-서비스-flow"><a href="#auth0-%EC%9D%B8%EC%A6%9D-%EC%84%9C%EB%B9%84%EC%8A%A4-flow" aria-label="auth0 인증 서비스 flow permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Auth0 인증 서비스 Flow</h3>
<p>AuthO 인증 서비스를 이용하여 인증이 이루어지는 과정은 다음과 같다.</p>
<ol>
<li>Auth0 서비스로 인증하려면 웹브라우저는 먼저 Auth0 페이지로 리디렉션하고 Auth0 서비스가 나중에 토큰을 반환하고 액세스하는 데 사용할 콜백 URL을 제공해야 한다.</li>
<li>이제 Auth0와 상호 작용하는 방식에 따라 로그인 방식을 선택할 수 있다. Google, Facebook 또는 기타 서비스를 통해 로그인하면 된다.</li>
<li>로그인이 완료되면 Auth0는 초기 리디렉션 동안 제공된 콜백 URL에 인증토큰이 추가된다. </li>
<li>이는 API Gateway로 전송하는 데 사용할 수있는 토큰이다. API Gateway로 이 토큰을 보내면 이를 다시 Lambda 함수로 보낼 수 있고 람다 함수는 이 토큰이 유효한 토큰인지 확인한다.</li>
</ol>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 752px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e3fb16258145fad00da128ada168c9b8/b6dca/Auth0_flow.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 47.6063829787234%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAAB90lEQVQoz3VSy2oUQRTtr3LnP7gRRBDBuHAVkBhFRHwkuM5Co4HgMy5EM4mziIrugiRuYkAMhjGEJMw4/e6e7q5H1+NYVT0ZMwsvnC66qu655566ntYaUsoGdQ0FIN74hl+nTqNsrcKGFhJaadi7x2j2BRShBgyKcrfv2Q9jDKQiqIoS9mqx28HvK5Mo17/+IxQKlkfbiobcLsWD52Bnb4NemAG9OAPRC+FxXiNLM1Rl5YitkrEY/aoTALhSqNrrYHNvwB4ugy6sQuYFvP1ehJ9HMf5Embs4at+oErV0BD8+JXh7tY8PswGWp3zsb6VmV4O8WAO7tQB2/5nBU8g4g9f1Y2ztHiCIEsRRhMgg8AOkSYqgH2JAzPn7BK8nQrSu+Vi65KOzmRhCBTrfgpicQ33jMcT0I8gggSeMsWmaN93pceOVatpjNUVFC9SC2x6cD7bl8vMmyJMVkMU2yMs1yKKCZ5OUkmOENgaDgVMZRzH2Ons4PDiCLe6Oh49S3lsEO3MT7NwdsPN3IboBPOtXbcblf2FJhKghlQBldPgoTVFlFCnTpgqNp8Y/bcQ5hZzxYaIA53wESrhL3m4nWLrcxbupHl5NdHH4vRofgBPhuUqu7QZ5liOJEzdKeTpwaTtfcrSm+/g4G2Lluo/eDmkUSt0M/DGMH38BoILpWPlbzPEAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/e3fb16258145fad00da128ada168c9b8/8ac56/Auth0_flow.webp 240w,
/static/e3fb16258145fad00da128ada168c9b8/d3be9/Auth0_flow.webp 480w,
/static/e3fb16258145fad00da128ada168c9b8/8cb39/Auth0_flow.webp 752w"
          sizes="(max-width: 752px) 100vw, 752px"
          type="image/webp"
        />
        <source
          srcset="/static/e3fb16258145fad00da128ada168c9b8/e4891/Auth0_flow.png 240w,
/static/e3fb16258145fad00da128ada168c9b8/0ce91/Auth0_flow.png 480w,
/static/e3fb16258145fad00da128ada168c9b8/b6dca/Auth0_flow.png 752w"
          sizes="(max-width: 752px) 100vw, 752px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/e3fb16258145fad00da128ada168c9b8/b6dca/Auth0_flow.png"
          alt="Auth0_flow"
          title="Auth0_flow"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h3 id="jwt-토큰-검증"><a href="#jwt-%ED%86%A0%ED%81%B0-%EA%B2%80%EC%A6%9D" aria-label="jwt 토큰 검증 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JWT 토큰 검증</h3>
<ul>
<li>Auth0 서비스는 <code class="language-text">JWT 토큰</code>을 리턴한다. </li>
<li>JWT 토큰은 Auth0에 의해 sign이 되었다. </li>
</ul>
<p>Auth0는 다음 두가지 방법중에 한가지로 JWT 토큰을 싸인할 수 있도록 지원한다. </p>
<ul>
<li>
<p>Symemetric(HS256) : 하나의 키로 토큰을 싸인(Auth0)하고 검증(어플리케이션)한다.</p>
<ul>
<li>키를 안전하게 보관해야 한다. </li>
<li>키가 노출되면 해커가 불법적으로 JwT 토큰을 생성할 수 있다. </li>
</ul>
</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 773px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/a7f936099d899bd79cd3054b4992910e/73dad/HS256.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 47.865459249676576%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABjklEQVQoz22SS07DMBCGcyd2bIENh+AKXXIKNixYgwQ71A3iAmwQT0HTtyrUUsojJUnbJE7isf1jJ32YwiijsSP79ze/7dTcJt5GH3AbLTTbXbz0B6g323h8ctEfDLEeSqllXYztcIQQMElERUopi5rnHKQ30MgDv22AP7Sh0vyP2Lqo8/t4s6CskMWH6OAM+XYF2U4FrN4r/kH+prTTsSd2SEXgUpP330HXLuimARExcN0N1/RLwjVix57EIUcwyuANYky+0jnu3zC2GEt4ls4lV/7OBYtlqO5/4nBriKPdIU72PpAzKjZIElCazD5c5Cn8xi1if4xwMgVjzCYs4fv3CZ4vpqhdTtC9iiFI/nvLC9EkjUDaFkNs0sA6pZSyujMiYikQswy9dx9DbwIlV+1xbwz/+BS80134sGq5vF1VbJBCIY4SBN8hotkM4+8Ad+1XdF6/MNPz0PcRc4J3fYPnjU1Mz6slOZWWOP89WvMOWcKQpmnRShBO9TjTFhCSJEGW5yBdk1YHFISWFcAPvqcBpHNQmNEAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/a7f936099d899bd79cd3054b4992910e/8ac56/HS256.webp 240w,
/static/a7f936099d899bd79cd3054b4992910e/d3be9/HS256.webp 480w,
/static/a7f936099d899bd79cd3054b4992910e/c99d1/HS256.webp 773w"
          sizes="(max-width: 773px) 100vw, 773px"
          type="image/webp"
        />
        <source
          srcset="/static/a7f936099d899bd79cd3054b4992910e/e4891/HS256.png 240w,
/static/a7f936099d899bd79cd3054b4992910e/0ce91/HS256.png 480w,
/static/a7f936099d899bd79cd3054b4992910e/73dad/HS256.png 773w"
          sizes="(max-width: 773px) 100vw, 773px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/a7f936099d899bd79cd3054b4992910e/73dad/HS256.png"
          alt="HS256"
          title="HS256"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<ul>
<li>
<p>Asymmetric(RS256) : JWT 토큰을 싸인하고 검증하는데 서로 다른 키가 사용된다. </p>
<ul>
<li>하나의 키는 JWT 토큰 싸인에 필요하다 (Auth0 가 키 보관)</li>
<li>토큰 검증에 certificate를 사용
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 781px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/54b4a2eb5464cd2e93b4e2a76bb5b3ba/63cc6/RS256.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 47.631241997439176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABo0lEQVQoz2WSTWvUUBSG5ye58xe4dOlahO5dC2JR/ANSqIgfUNeCm7qQgiC46KJC69iPSUerjR1LNE0yyc3H3I/He28mNtN54XBuTs5575v3ZDDcP+TX2YSvByMOjwKC0THfv52wuzfkwD43TYODMWYh47KeR68+kFLiwg3WSpGqGVMjEXLma7o30CctMQh7rnCcl/XB/9ssmuOQZPU5yf1n1Nv7rRJtltRprUk3NskevSRbf4OW6pLQ32wbHNQwQK88Rt9+iN7axo137/oKnaJm9QXy1gOau08wS4S+z35CqojCkuhUkMdqSZnpiD2ppkgTb1eHK4Sat/fOWbsR8vRmyOs7E2aVWlDXVynrkoujHUt6QZKk1FXVLqWv8OdnwZfNjOG7lPGnAqU0V9EnFeUUpZX3tKsP5m3dXrzSNlrkomI8iQmj1A92aM5+E7/aQJ78mI/pRYXtcgxaGYpcEP9NyKdToj8xO6NTgjAiyzKSOKawvp1/+MjutesU77daSUr1FbJgvjO6LEvrS+23nKQ5tf0nfV2I9mxzGYxRed6zAv4BVDn8N02AO4MAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/54b4a2eb5464cd2e93b4e2a76bb5b3ba/8ac56/RS256.webp 240w,
/static/54b4a2eb5464cd2e93b4e2a76bb5b3ba/d3be9/RS256.webp 480w,
/static/54b4a2eb5464cd2e93b4e2a76bb5b3ba/42cfc/RS256.webp 781w"
          sizes="(max-width: 781px) 100vw, 781px"
          type="image/webp"
        />
        <source
          srcset="/static/54b4a2eb5464cd2e93b4e2a76bb5b3ba/e4891/RS256.png 240w,
/static/54b4a2eb5464cd2e93b4e2a76bb5b3ba/0ce91/RS256.png 480w,
/static/54b4a2eb5464cd2e93b4e2a76bb5b3ba/63cc6/RS256.png 781w"
          sizes="(max-width: 781px) 100vw, 781px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/54b4a2eb5464cd2e93b4e2a76bb5b3ba/63cc6/RS256.png"
          alt="RS256"
          title="RS256"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></li>
</ul>
</li>
<li>이 수업에서는 싸인 알고리즘으로 HS256을 채택한다. 시크릿키를 관리하는 방법을 적용할 수 있음.</li>
</ul>
<h3 id="nodejs에서-jwt-토큰-검증-샘플코드"><a href="#nodejs%EC%97%90%EC%84%9C-jwt-%ED%86%A0%ED%81%B0-%EA%B2%80%EC%A6%9D-%EC%83%98%ED%94%8C%EC%BD%94%EB%93%9C" aria-label="nodejs에서 jwt 토큰 검증 샘플코드 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Nodejs에서 JWT 토큰 검증 샘플코드</h3>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> verify <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'jsonwebtoken'</span>

 <span class="token keyword">const</span> jwtToken <span class="token operator">=</span> <span class="token string">'...'</span>
 <span class="token keyword">const</span> secret <span class="token operator">=</span> <span class="token string">'...'</span>

 <span class="token function">verify</span><span class="token punctuation">(</span>jwt<span class="token punctuation">,</span> secret<span class="token punctuation">)</span>
 <span class="token comment">// If an exception is not thrown a JWT is valid</span></code></pre></div>
<h3 id="서버사이드-쿠키세션"><a href="#%EC%84%9C%EB%B2%84%EC%82%AC%EC%9D%B4%EB%93%9C-%EC%BF%A0%ED%82%A4%EC%84%B8%EC%85%98" aria-label="서버사이드 쿠키세션 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>서버사이드 쿠키(세션)</h3>
<p>세션은 HTTP 서버에서 설정한 쿠키이지만 웹브라우저에서 실행되는 JavaScript 코드에서는 이 값을 사용할 수 없다. 세션의 값은 웹브라우저에서만 사용할 수 있으며 웹브라우저에서 서버에 보내는 요청과 함께 일반 쿠키로 자동으로 서버에 전송된다. 웹브라우저에서 실행되는 JavaScript 코드에는 이 쿠키 값을 사용할 수 없으므로 악성 코드가 이 쿠키에 접근할 수 없다. JWT 토큰이 세션에 저장된 경우, 보다 안전한 방식으로 이를 인증에 사용할 수 있다.</p>
<h2 id="시크릿-키-저장"><a href="#%EC%8B%9C%ED%81%AC%EB%A6%BF-%ED%82%A4-%EC%A0%80%EC%9E%A5" aria-label="시크릿 키 저장 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>시크릿 키 저장</h2>
<p>현재 JWT 토큰의 유효성 검증을 위한 시크릿 키를 환경변수에 저장하고 있지만 이는 좋은 방법이 아니다. AWS 콘솔에 접근할 수 있는 누구나 시크릿 키에 접근할 수 있기 때문이다. 시크릿 키를 저장하기 위한 몇가지 특별한 서비스가 있다. </p>
<ul>
<li>SSM 파라미터 스토어</li>
<li>AWS 시크릿 매니저</li>
<li>Non-AWS 서비스</li>
</ul>
<h3 id="ssm-파라미터-스토어"><a href="#ssm-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0-%EC%8A%A4%ED%86%A0%EC%96%B4" aria-label="ssm 파라미터 스토어 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SSM 파라미터 스토어</h3>
<p><a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html" target="_blank" rel="nofollow noopener noreferrer">공식문서</a> 참고</p>
<ul>
<li>중앙화된 환경설정 저장소이다.</li>
<li>값들은 암호화되어 보관된다</li>
<li>추가 비용이 들지 않는다.</li>
<li>암호화는 KMS에 의해 진행된다. </li>
</ul>
<h3 id="aws-시크릿-매니저"><a href="#aws-%EC%8B%9C%ED%81%AC%EB%A6%BF-%EB%A7%A4%EB%8B%88%EC%A0%80" aria-label="aws 시크릿 매니저 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AWS 시크릿 매니저</h3>
<p><a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html" target="_blank" rel="nofollow noopener noreferrer">공식문서</a> 참고</p>
<ul>
<li>시크릿을 저장하기 위한 서비스이다.</li>
<li>모든 값들은 암호화되어 보관된다</li>
<li>시크릿 로테이션을 지원한다. </li>
<li>리퀘스트당 비용이 들고, 시크릿당 비용이 청구된다.</li>
<li>암호화는 KMS에 의해 진행된다.</li>
</ul>
<h3 id="kmskey-management-service"><a href="#kmskey-management-service" aria-label="kmskey management service permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>KMS(Key Management Service)</h3>
<p>위의 시크릿 키를 저장하는 클라이언트들이 KMS에 시크릿 암호화를 진행하는 과정은 아래의 이미지와 같다. 추가적으로 KMS에는 각 키를 접근할 수 있는 권한에 대한 IAM 정책을 설정할 수 있다.
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 683px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ca798528e091be8ed6f9d47443e4af8e/2d29e/Key_management_service.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 50.95168374816984%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACIElEQVQoz3WSS08TYRSGJ/IfcOl/MC7caGxiIETQDWxc6MJEF0SDF8RFXanEEBaGsPNSUBCNGhUNRhdGjXGhG1EivUyL01JqO23p9DqdmW8ev5nWUDR+ycxk3px55j3nvAqui3eEEDi2jeM4tJR/j5C1SaNGvFBBK9WwHOHrrrv1heLdrPUcjZEbmMOTmCfGMd9+wSt1LJt6vU6jafnFr5NFuh4l6H7zC+Vhgjm16Ou2NPMH6gPNr1HEwRHouwB7T2HeWsRDNGt1opEoxZLh+eN2NM/O6XdMj15l18QS19VqC9h250FbwBUV0T8Kh8fgwGlqoReYUq8aZTaLm5TkE9tkJlll95UHJHoDBIJ3GNfkbxtlKnp+u8PmdxVnYAwxdBk3cIbm7JLvsJQvYhgGeqHo9c9jrYQys8LJu5/oDi0zGZZ6cg0jvYErZ78F/BbDPnIJ6/g1nJ5zWLOv/MXYpklmI0O5WvOLF+J5uuaj9CyuocyrTK0WQIujxxOITqApHYpDsuX+i7B/mHroJVWJzKTSaD81tGQK6lUWIlmU+zH2PEuwYy7CVFgCGxVysmXLsjqAyzFE33mQbbNvmNrN5zQ9XTrTc3rboeCempctr3L0SQQlFGbiR8GHOH8vpammsIeCiMEgTu9Z7Kfv28ETfi5Fe+DhUoNjH9cZ/JBmQF6f9dYoHOFuX4r3YmcL2KmszGQW0c5dZ2CF6/437J21vwE3tMWkl809FgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/ca798528e091be8ed6f9d47443e4af8e/8ac56/Key_management_service.webp 240w,
/static/ca798528e091be8ed6f9d47443e4af8e/d3be9/Key_management_service.webp 480w,
/static/ca798528e091be8ed6f9d47443e4af8e/e2d2f/Key_management_service.webp 683w"
          sizes="(max-width: 683px) 100vw, 683px"
          type="image/webp"
        />
        <source
          srcset="/static/ca798528e091be8ed6f9d47443e4af8e/e4891/Key_management_service.png 240w,
/static/ca798528e091be8ed6f9d47443e4af8e/0ce91/Key_management_service.png 480w,
/static/ca798528e091be8ed6f9d47443e4af8e/2d29e/Key_management_service.png 683w"
          sizes="(max-width: 683px) 100vw, 683px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/ca798528e091be8ed6f9d47443e4af8e/2d29e/Key_management_service.png"
          alt="Key_management_service"
          title="Key_management_service"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h3 id="aws-시크릿-매니저-샘플코드"><a href="#aws-%EC%8B%9C%ED%81%AC%EB%A6%BF-%EB%A7%A4%EB%8B%88%EC%A0%80-%EC%83%98%ED%94%8C%EC%BD%94%EB%93%9C" aria-label="aws 시크릿 매니저 샘플코드 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AWS 시크릿 매니저 샘플코드</h3>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AWS<span class="token punctuation">.</span>SecretManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">getSecretValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  SecretId<span class="token punctuation">:</span> <span class="token string">'secret-id'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> secret <span class="token operator">=</span> data<span class="token punctuation">.</span>SecretString</code></pre></div>
<h2 id="람다-미들웨어"><a href="#%EB%9E%8C%EB%8B%A4-%EB%AF%B8%EB%93%A4%EC%9B%A8%EC%96%B4" aria-label="람다 미들웨어 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>람다 미들웨어</h2>
<p>serverless 어플리케이션에서도 Nodejs 서버와 같이 미들웨어를 사용할 수있다. <code class="language-text">middy</code>라는 라이브러리를 사용하여 이를 구현할 수 있다. 다음은 <code class="language-text">middy</code> 미들웨어 샘플 코드이다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> middy <span class="token keyword">from</span> <span class="token string">'middy'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> cors <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'middy/middlewares'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token function">middy</span><span class="token punctuation">(</span>
  <span class="token keyword">async</span> <span class="token punctuation">(</span>event<span class="token punctuation">:</span> APIGatewayProxyEvent<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span>APIGatewayProxyResult<span class="token operator">></span> <span class="token operator">=></span> <span class="token punctuation">{</span>
     <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

handler
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<h1 id="best-practices"><a href="#best-practices" aria-label="best practices permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Best Practices</h1>
<h2 id="serverless-어플리케이션-로컬에서-실행하기"><a href="#serverless-%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EB%A1%9C%EC%BB%AC%EC%97%90%EC%84%9C-%EC%8B%A4%ED%96%89%ED%95%98%EA%B8%B0" aria-label="serverless 어플리케이션 로컬에서 실행하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>serverless 어플리케이션 로컬에서 실행하기</h2>
<p>serverless 어플리케이션을 로컬에서 실행하는 방법은 2가지 방법이 있다.</p>
<ul>
<li><code class="language-text">invoke</code> 명령어 사용</li>
<li><code class="language-text">serverless-offline</code> 플러그인 사용</li>
</ul>
<h3 id="serverless-offline-플러그인"><a href="#serverless-offline-%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8" aria-label="serverless offline 플러그인 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>serverless-offline 플러그인</h3>
<ul>
<li>Api 게이트웨이와 람다를 에뮬레이트한다.</li>
<li>람다 함수를 호출할 수 있는 로컬 웹 서버를 실행한다.</li>
<li>
<p>기능이 많다.</p>
<ul>
<li>Authorizers, 람다 integration, CORS, etc.</li>
</ul>
</li>
<li>
<p>로컬 디버깅 허용</p>
<ul>
<li>로컬 프로세스에게 디버거를 달 수 있다.</li>
</ul>
</li>
<li>
<p>다른 서비스를 에뮬레이트하는 플러그인과 호환된다.</p>
<ul>
<li>DynamoDB, Kinesis, SNS, etc</li>
</ul>
</li>
</ul>
<p>Severless 앱을 로컬에서 실행하기 위해서는 다음의 코드가 <code class="language-text">serverless.yaml</code>에 추가되어야 한다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">plugins</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> serverless<span class="token punctuation">-</span>dynamodb<span class="token punctuation">-</span>local
  <span class="token punctuation">-</span> serverless<span class="token punctuation">-</span>offline
<span class="token key atrule">custom</span><span class="token punctuation">:</span>
  <span class="token key atrule">serverless-offline</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3003</span></code></pre></div>
<p>또한 DynamoDB를 로컬에서 사용하기 위해서는 다음 명령어를 통해 dynamodb를 로컬에 설치해야 한다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">sls dynamodb install
sls dynamodb start</code></pre></div>
<p>다음 명령어는 serverless 웹서버를 로컬에서 실행한다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">sls offline</code></pre></div>
<h3 id="로컬-환경에서의-이슈"><a href="#%EB%A1%9C%EC%BB%AC-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C%EC%9D%98-%EC%9D%B4%EC%8A%88" aria-label="로컬 환경에서의 이슈 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>로컬 환경에서의 이슈</h3>
<ul>
<li>람다와/ API 게이트웨이를 완
전하게 에뮬레이트하지는 못한다.</li>
<li>로컬 Nodejs 환경에서 실행되기 때문에 serverless 실서버 환경과 다를 수 있다.</li>
<li>
<p>다른 서비스들의 로컬 에뮬레이션에 의존성이 있다.</p>
<ul>
<li>로컬 에뮬레이션을 정확하지 않을 수 있고 모든 기능을 지원하지 않을 수 있다.</li>
</ul>
</li>
<li>로컬 환경에서의 serverless 앱 실행이 유용할 수 있지만 완전한 테스트를 위해서는 AWS에 배포가 되어야 한다.</li>
</ul>
<p><a href="https://github.com/dherault/serverless-offline" target="_blank" rel="nofollow noopener noreferrer">Serverless Offline 플러그인</a>에서 추가적으로 이와 관련된 정보를 확인 할 수 있다.</p>
<h2 id="ports-and-adpaters-아키텍쳐"><a href="#ports-and-adpaters-%EC%95%84%ED%82%A4%ED%85%8D%EC%B3%90" aria-label="ports and adpaters 아키텍쳐 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ports and Adpaters 아키텍쳐</h2>
<p><code class="language-text">ports and adapters</code> 아키텍쳐는 어플리케이션을 두가지 메인 컴포넌트로 나누는 것이다.</p>
<ul>
<li><code class="language-text">비즈니스 로직</code> : 외부의 서비스와 독립적인 어플리케이션의 비즈니스 로직을 작성하는 부분이다.</li>
<li><code class="language-text">ports and adapters</code> : 외부의 서비스와 상호작용 하는 부분이다.(데이터베이스, 메시지큐 등)</li>
</ul>
<h2 id="serverless-모니터링"><a href="#serverless-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81" aria-label="serverless 모니터링 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serverless 모니터링</h2>
<p>서버리스 마이크로 서비스 어플리케이션을 모니터링하는 방법은 크게 3가지가 있다. </p>
<ul>
<li><code class="language-text">metrics</code> : 애플리케이션이 어떻게 동작하는지에 대한 집계된 값(aggregated)을 보여준다. (ex. 클라이언트 요청의 개수)</li>
<li><code class="language-text">logging</code>: 이벤트 하나하나를 기록한다.</li>
<li><code class="language-text">Distributed Tracing</code>: 엔드투엔드 요청 실행에 대한 정보를 기록 할 수 있다. <code class="language-text">Distributed Tracing</code>의 특징은 요청을 보내는 사용자의 관점에서 시스템과의 상호작용을 보여준다.</li>
</ul>
<h3 id="cloudwatch-로그와-엘라스틱서치"><a href="#cloudwatch-%EB%A1%9C%EA%B7%B8%EC%99%80-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98" aria-label="cloudwatch 로그와 엘라스틱서치 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CloudWatch 로그와 엘라스틱서치</h3>
<p>모든 Lambda 함수에서 발생하는 <code class="language-text">standard ouput</code>은 AWS의 중앙 로깅 스토리지인 CloudWatch 로그에 쌓인다.</p>
<p>이번 수업에서는 로깅을 위해 간단히 <code class="language-text">console.log()</code>를 사용했지만 프로덕션 애플리케이션에서는
적절한 로깅 라이브러리를 사용하는 것이 좋다. 또한 로그 메시지를 남길때 엄격한 형식을 사용하여 작성하는 것이 좋다. 그 이유는 로그에서 무언가를 검색하려는 경우
엄격한 형식을 사용하여 특정 클래스에서 생성 된 모든 로그 기록을 찾는 등의 검색을 할 수 있기 때문이다. Lambda 함수에서 남긴 로그를 사용하는 것 외에도 API Gateway에서 로깅을 활성화 할 수도 있다. 그러면 Api Gateway에서의 수신에 대한 정보를 기록 할 수 있다.</p>
<p>규모가 큰 어플리케이션에서는 클라우드워치만으로는 로깅 시스템을 구축하기 충분하지 않을 수 있다. 이때 우리는 Elasticsearch를 사용할 수 있다. 현재 Elasticsearch는 로깅 스토리지로 항상 선택되는 솔루션이다.</p>
<p>아래의 이미지와 같이 클라우드 워치 로그에 쌓인 로그 기록들을 엘라스틱 서치로 보내는 람다함수를 적용하여 엘라스틱 서치를 어플리케이션의 로깅 시스템으로 활용할 수 있다. </p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 658px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ea29bf8c497cbb195acff82912177dad/5e17e/cloudWatch_logs_and_elasticsearch.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 43.76899696048632%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABvklEQVQoz4WPy27TUBCG/Uos2bOEBRIPwoJ3YFEW8AKsqq64Q1NR26ESpAGHOECbKsV14ytObCdx4tqxjy8/Y7uNKkDiSN+ZOf+M/pnDZVkGVsEy5HmO6pRliUrPQLEsNvpV7c94HS5YLuFOHMxmPqI4RlEUtVkQBLC+n8Abm4jWpJNpVfu3aXU1A7nqmit9JL5VayxNmwoZSPceYLq91zxTVg+6vukVjVvRbMjyAv7MQ3gRIs3yzfcSysftHjzFQLVXWZTIacOyyIliY8wYg6ba+GW5jeFtXsEt/gw3dhU8lE0axDCP1rgrKrjTtXFTOMfjI4ccM0QJg6sMsDBPEa8TXIQhxQhb9zt4+1RvvtzVJzgkDsYOThwP0WqJ+SLAF2OKDmkfiTN3jjhcYbkKsfAcYgLP86GqKnzfw+eOitHxBEkag3NtExUe4VgmdF2vmVoGXHrb2hg/hiMMRz9hGFQzjAbq0TQNOvVokgx7dArdNMH1ZRkVXy+jfEmdDwb4dNjF9qt3eC9+gNzvQ5Ik9Aip16vzb9TzaOsJXuzuYXh8BI7nefyPVqsFfn8fgiD8RVsQsfPyOZ69eY22KOI3+GKPLgT0IJAAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/ea29bf8c497cbb195acff82912177dad/8ac56/cloudWatch_logs_and_elasticsearch.webp 240w,
/static/ea29bf8c497cbb195acff82912177dad/d3be9/cloudWatch_logs_and_elasticsearch.webp 480w,
/static/ea29bf8c497cbb195acff82912177dad/6ad61/cloudWatch_logs_and_elasticsearch.webp 658w"
          sizes="(max-width: 658px) 100vw, 658px"
          type="image/webp"
        />
        <source
          srcset="/static/ea29bf8c497cbb195acff82912177dad/e4891/cloudWatch_logs_and_elasticsearch.png 240w,
/static/ea29bf8c497cbb195acff82912177dad/0ce91/cloudWatch_logs_and_elasticsearch.png 480w,
/static/ea29bf8c497cbb195acff82912177dad/5e17e/cloudWatch_logs_and_elasticsearch.png 658w"
          sizes="(max-width: 658px) 100vw, 658px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/ea29bf8c497cbb195acff82912177dad/5e17e/cloudWatch_logs_and_elasticsearch.png"
          alt="cloudWatch_logs_and_elasticsearch"
          title="cloudWatch_logs_and_elasticsearch"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h3 id="distributed-tracing"><a href="#distributed-tracing" aria-label="distributed tracing permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Distributed Tracing</h3>
<p><code class="language-text">AWS X-RAY</code>를 통해 <code class="language-text">Distributed Tracing</code>을 구현할 수 있다.</p>
<ul>
<li>애플리케이션이 특정 요청 실행에 대한 정보를 보낼 수 있도록 한다.</li>
<li>시스템의 중앙화된 뷰로 각 데이터를 집계하고 이러한 데이터들로 시스템의 맵을 생성한다.</li>
</ul>
<p><code class="language-text">AWS X-Ray</code>가 생성 할 지도는 아래의 이미지와 같다.
예를들어 API Gateway가 호출하는 람다 함수를 보여주고 각 람다 함수가 상호작용하는 <code class="language-text">DyanmoDB</code> 등의 모든 리소스를 보여준다. 그리고 각 리소스와의 성공한 요청 수, 실패한 작업 수에 대한 정보도 표시한다.
DynamoDB의 경우 얼마나 많은 요청이 제한(throttled)되었는지도 보여준다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 754px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b54a3fa4b9832410c81359aa26c19529/dbdb8/aws_x-ray_map.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 54.774535809018566%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABjUlEQVQoz41SbUvDMBDu//8iguCPEHGCMMF1IuI3beucG3O6ZXXOvopbX9N0e7xkdnZMxIOHu0suz3O5RHM9H2bnAcx+RW/whG6vr2Jpq9UKlVWx9H9BS5IEfhBC+s/5nLBAFMfq8JIKyuUSS0KdrC5Sz6VpP+H2hrQ8S+HYIxQF31pfi2wTS1HV4W8qZVmiECXi+Qec7g3yJKJcEHGBOd3ivj+DGyzgeS4cx0UYhsjzfE1YkbDDA4TNMwiKC56vFQklzzbqnHNFOp35NJoI7+8z2LaNIAiQpukPoaCOuvt7YCfH4LRYcL5zfdm1EELFkljmv81yTUiFGXWRkpddie/r8TxD5DI1yzTNiESox7Mep/DDeOcnKMKYXlQikaDiKl9EMTznDWPjCs5sqn5CFC3U3vPIhuP6JJLQWrQ5I6FNJhNIMMYUqlzOZjgconPfUZ6NGV5GL3juD9C/NTGp1dahmaaJv2BZ1iY2CNf6JS6OTmHcGTCt3Xqt1Wrhv2i32zhvNnHaaKhc1/Wdmi+lkDe+V4kM9AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/b54a3fa4b9832410c81359aa26c19529/8ac56/aws_x-ray_map.webp 240w,
/static/b54a3fa4b9832410c81359aa26c19529/d3be9/aws_x-ray_map.webp 480w,
/static/b54a3fa4b9832410c81359aa26c19529/20eb0/aws_x-ray_map.webp 754w"
          sizes="(max-width: 754px) 100vw, 754px"
          type="image/webp"
        />
        <source
          srcset="/static/b54a3fa4b9832410c81359aa26c19529/e4891/aws_x-ray_map.png 240w,
/static/b54a3fa4b9832410c81359aa26c19529/0ce91/aws_x-ray_map.png 480w,
/static/b54a3fa4b9832410c81359aa26c19529/dbdb8/aws_x-ray_map.png 754w"
          sizes="(max-width: 754px) 100vw, 754px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/b54a3fa4b9832410c81359aa26c19529/dbdb8/aws_x-ray_map.png"
          alt="aws_x-ray_map"
          title="aws_x-ray_map"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<p>따라서 우리는 이를 통해 시스템이 전체적으로 어떻게 동작하는지 확인 할 수 있다. 시스템의 다른 구성 요소가 서로 상호 작용하는 방식을 볼 수 있고 얼마나 많은 오류가 있고 어디에서 오류가 발생하는지 확인할 수 있다. </p>
<p>또한 이것들이 서비스를 사용하는 고객에게 미치는 영향도 확인할 수 있다. 사용자가 영향을 받은 요청 수와 요청 처리 단계를 확인할 수 있다.</p>
<p><code class="language-text">Distributed Tracing</code>을 사용하면 오류가 발생한 위치를 식별 할 수 있다. X-Ray가 특정 요청이 소요되는 시간을 기록하기 때문에 어플리케이션의 성능 문제도 파악할 수 있게 된다.</p>
<h3 id="aws-x-ray-용어"><a href="#aws-x-ray-%EC%9A%A9%EC%96%B4" aria-label="aws x ray 용어 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AWS X-RAY 용어</h3>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 801px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/63f8806ddb9a6e4f6285389159067cdb/299c1/aws_x_ray_terminology.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 51.186017478152316%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABsklEQVQoz5VS2W7bMBDUr/ahX1igcYqg8NGgKZCH1LLlxE5sxwaig5Z1WtRBaTqkIQMp8hICo50drpbDwzqER9hzB+vNFs/rDTbbV6xe1nhcrvD4tETXtvjMsKSUOEQR0tMJSZ4jKyR5gTjLEcYxGjbULYuygqxrKPKm7Qw013NNd85bRqvjJ1ctCk5IiqmsiBKSmmR1XjU41Qp+FEMkmeEZtZwxPklEeWFqsrpByX8s45NNVZJqG0gPIY6uh46OWha31EAe+wJ5GJHTJfVOLyx0rW84GnXesv4Uvoe/X78gXy0vZ6Gda/RcKWXw0ehrNUzDLDpic/MDaeCbM6t5Vr1znZdc3RcHeEKgahrGFHFSXJq9uxTFAt1At6jJtYuyLFHwHMXzAwJ3h5BbTHhpGbWYF2c/7bF7C/kCzq4b06PirhWsIAhg4PvouaCTN9eF83CPl+WC3MN+vzeaoNNXPrHddgvBWtfzsV5MsbofmjlrsVjAcZx36LXZfG6gc42ZbcMmfn0b4O76J+zZzODP71vcDm8wnU5hjcdjfITJZHLB/9rg+xWurwaXfDQaYTgam/gP4truQRRZf8IAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/63f8806ddb9a6e4f6285389159067cdb/8ac56/aws_x_ray_terminology.webp 240w,
/static/63f8806ddb9a6e4f6285389159067cdb/d3be9/aws_x_ray_terminology.webp 480w,
/static/63f8806ddb9a6e4f6285389159067cdb/99a1d/aws_x_ray_terminology.webp 801w"
          sizes="(max-width: 801px) 100vw, 801px"
          type="image/webp"
        />
        <source
          srcset="/static/63f8806ddb9a6e4f6285389159067cdb/e4891/aws_x_ray_terminology.png 240w,
/static/63f8806ddb9a6e4f6285389159067cdb/0ce91/aws_x_ray_terminology.png 480w,
/static/63f8806ddb9a6e4f6285389159067cdb/299c1/aws_x_ray_terminology.png 801w"
          sizes="(max-width: 801px) 100vw, 801px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/63f8806ddb9a6e4f6285389159067cdb/299c1/aws_x_ray_terminology.png"
          alt="aws_x_ray_terminology"
          title="aws_x_ray_terminology"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<ul>
<li><code class="language-text">trace</code> : 다양한 X-Ray의 단일 요청이다.</li>
<li><code class="language-text">segment</code> : 단일 요청의 각 실행 개별단계는 세그먼트이다.</li>
<li><code class="language-text">sub-segment</code>: 세그먼트 하위에 있는 각 개별 오퍼레이션이다.</li>
</ul>
<h3 id="x-ray-추적-방법"><a href="#x-ray-%EC%B6%94%EC%A0%81-%EB%B0%A9%EB%B2%95" aria-label="x ray 추적 방법 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>X-RAY 추적 방법</h3>
<p><code class="language-text">AWS X-ray</code>가 단일 <code class="language-text">trace</code>를 구성하는 방법은 먼저 API Gateway는 HTTP 헤더에서 추적 ID <code class="language-text">X-Amzn-Trace-Id</code>를 전달한다. <code class="language-text">trace</code>를 생성하기 위해서는 이 추적 ID를 요청의 흐름대로 전달해야한다.
적절한 툴을 사용하면 이 헤더가 자동으로 전달 될 수 있다.</p>
<h3 id="x-ray-대몬"><a href="#x-ray-%EB%8C%80%EB%AA%AC" aria-label="x ray 대몬 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>X-RAY 대몬</h3>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 798px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/0f26dfaaf03268a5415f3fbf7ac49f86/fecec/aws_x_ray_daemon.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.11528822055138%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABrElEQVQoz3WRO28TURCF93dQQEtLaCnp0keCKj0FBVCBEA0SIgU9BWlpUCQeRdrwSIiIlH3YxFbiYBt7d43iXcv7fn3MXbwoMmSk0dE5d+bMnXs1d/KLdqdL5/ikxuPeKXmeo6Kqqn+y0RvMF1kszrU0TQmCgDhJiOKYWLJp+F8smy6HdnFzRZZlqIENLpvlRcHjQ5u13QEbllv3XGhYliXzIMTzfWaehz/1yMX4/Ooz4Vdef0d7rrPy7oRcejR1MN3/ytG9u8Q/h5TCsywn8M+Y9nSqsvg7JKyK+la1oTSfpQnXXxmsrH/k5tseGQtDzzToPntK4ti1ofqUaO7jDY5qw6Jvk+ldBp8OyBJZXW0gNX4Uc3Wrg/bS4sb2KaX6FPU+Rb09FDK1kEKlZYKJ3DSSt5vd2WC+ep9w7RHh2CXKUnLRvTDm8htZedPk2vsuiWia67o4joMzHteouG3bjIUrHAn+ePCC/q2H9NefMGx3sCcurtQORyNWt75xaXOX2x8OmYimWZbF+Wy1WjUahoFpmpiWib63j7HzBf3zHpZoTU1b0BB+oP+pVfw35S+VU5nxqSQAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/0f26dfaaf03268a5415f3fbf7ac49f86/8ac56/aws_x_ray_daemon.webp 240w,
/static/0f26dfaaf03268a5415f3fbf7ac49f86/d3be9/aws_x_ray_daemon.webp 480w,
/static/0f26dfaaf03268a5415f3fbf7ac49f86/ce206/aws_x_ray_daemon.webp 798w"
          sizes="(max-width: 798px) 100vw, 798px"
          type="image/webp"
        />
        <source
          srcset="/static/0f26dfaaf03268a5415f3fbf7ac49f86/e4891/aws_x_ray_daemon.png 240w,
/static/0f26dfaaf03268a5415f3fbf7ac49f86/0ce91/aws_x_ray_daemon.png 480w,
/static/0f26dfaaf03268a5415f3fbf7ac49f86/fecec/aws_x_ray_daemon.png 798w"
          sizes="(max-width: 798px) 100vw, 798px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/0f26dfaaf03268a5415f3fbf7ac49f86/fecec/aws_x_ray_daemon.png"
          alt="aws_x_ray_daemon"
          title="aws_x_ray_daemon"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<ul>
<li>X-ray 대몬은 서버에서 개별 어플리케이션으로 실행된다.</li>
<li>
<p>어플리케이션으부터 <code class="language-text">tracing</code> 정보를 전달받는다.</p>
<ul>
<li>해당 <code class="language-text">tracing</code> 정보들을 버퍼에 쌓아놓고 비동기로 데이터를 전달한다.</li>
</ul>
</li>
<li>이미 AWS 람다와 통합된 서비스이기 때문에 <code class="language-text">X-ray</code> 대몬을 사용하기 매우 쉽다.</li>
</ul>
<h3 id="x-ray-사용하기"><a href="#x-ray-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0" aria-label="x ray 사용하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>X-RAY 사용하기</h3>
<p><code class="language-text">X-Ray</code>를 사용하여 람다함수의 <code class="language-text">trace</code>를 추적하기 위해서는 <code class="language-text">serverless.yaml</code>파일에 다음 설정을 해줘야 한다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># serverless.yaml</span>

<span class="token key atrule">tracing</span><span class="token punctuation">:</span>
  <span class="token key atrule">lambda</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># apiGateway 에서도 사용 가능</span>
  <span class="token comment"># apiGateway: true</span></code></pre></div>
<p>또한 코드 상에서는 다음과 같이 사용할 수 있다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">AWS</span> <span class="token keyword">from</span> <span class="token string">'aws-sdk'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> AWSXRay <span class="token keyword">from</span> <span class="token string">'aws-xray-sdk'</span>

<span class="token keyword">const</span> <span class="token constant">XAWS</span> <span class="token operator">=</span> AWSXRay<span class="token punctuation">.</span><span class="token function">captureAWS</span><span class="token punctuation">(</span><span class="token constant">AWS</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> docClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XAWS<span class="token punctuation">.</span>DynamoDB<span class="token punctuation">.</span>DocumentClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Perform request and record a sub-segment</span>
<span class="token keyword">const</span> item <span class="token operator">=</span> docClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->16 Jun 2020</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/serverless/">serverless</a></li></ul></div><div class="Author-module--author--2Yefr"><p><a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/undefined" rel="noopener noreferrer" target="_blank"><strong>saegeullee</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"><div><div id="disqus_thread"></div></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/serverless/serverless";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-e9f2271e56397154169d.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-87ef582ba388a83f73c0.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-8bf6e18fcbffbee6eab5.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-a8a30d5821197c180923.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-324659d88459e32c19db.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-7561b72f3997c21f4dc5.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-40abd2ffdee3c9623eba.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-438077e52668404488ab.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-4a41e786118ee2b99a61.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-06c543fd0fd21a7ba643.js"]};/*]]>*/</script><script src="/component---src-templates-post-template-js-40abd2ffdee3c9623eba.js" async=""></script><script src="/commons-744e74cbf6b5408b71f7.js" async=""></script><script src="/styles-8f10df4b1baa09fb1b32.js" async=""></script><script src="/app-e9f2271e56397154169d.js" async=""></script><script src="/netlify-identity-widget-e37a35e339457e643f79.js" async=""></script><script src="/webpack-runtime-e876f3fb06ce083dc5b9.js" async=""></script></body></html>