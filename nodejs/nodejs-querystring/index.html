<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.5f9c12d5a1b22d54675d.css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:26px;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:1.125rem;font-weight:600;line-height:1.82813rem;margin:.8125rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.625rem;margin-bottom:1.625rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.625rem}.Contacts-module--contacts__list--3OgdW{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row wrap;-webkit-box-flex:0;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:-webkit-box;display:flex;align-content:center;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;height:35px;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:-webkit-box;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#5d93ff}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.875rem}.Menu-module--menu--Efbin{margin-bottom:1.625rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:1rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:-webkit-gradient(linear,left top,left bottom,from(#e6e6e6),color-stop(48%,#e6e6e6),to(#fff));background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:540px;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:52.5rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:71.5625rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:2rem;max-width:52.5rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.625rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:52.5rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:52.5rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.8125rem}.Tags-module--tags_insidebar__list--3HmL5{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags_insidebar__list-item--1mylh{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags_insidebar__list-item-link--3Xlcg{display:inline-block;height:35px;padding:0 .75rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags_insidebar__list-item-link--3Xlcg:focus,.Tags-module--tags_insidebar__list-item-link--3Xlcg:hover{color:#5d93ff}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:35px;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#5d93ff}.Feed-module--feed__item--2D5rE{margin-bottom:2.03125rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.8125rem}.Feed-module--feed__item-title--3nigr{font-size:1.6875rem;line-height:2.4375rem;margin-top:0;margin-bottom:.8125rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.875rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.875rem;color:#f7a046;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI{font-size:1rem;color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Page-module--page--2nMky{margin-bottom:3.25rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:2.5rem;font-weight:600;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.Page-module--page__body--Ic6i6{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:3.25rem;display:-webkit-box;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#5d93ff}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#5d93ff}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:52.5rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:35px;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#5d93ff}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.18.14"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script>
  window.excludeGAPaths=[/^(?:\/preview\/(?:(?!(?:\/|^)\.).)*?)$/,/^(?:\/do\-not\-track\/me\/too\/)$/];
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-151878736-1',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(!(parseInt(navigator.doNotTrack) === 1 || parseInt(window.doNotTrack) === 1 || parseInt(navigator.msDoNotTrack) === 1 || navigator.doNotTrack === "yes")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-151878736-1', 'example.com', {"sampleRate":5,"siteSpeedSampleRate":10});
      ga('set', 'anonymizeIp', true);
      ga('require', 'YOUR_GOOGLE_OPTIMIZE_TRACKING_ID');
      ga('set', 'expId', 'YOUR_GOOGLE_EXPERIMENT_ID');
      ga('set', 'expVar', 'YOUR_GOOGLE_OPTIMIZE_VARIATION_ID');
      
      }</script><link rel="alternate" type="application/rss+xml" title="Blog by saegeullee" href="/rss.xml"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-151878736-1"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-151878736-1', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/icons/icon-48x48.png?v=79359cefde70392655aaf684a9259a17"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=79359cefde70392655aaf684a9259a17"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=79359cefde70392655aaf684a9259a17"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=79359cefde70392655aaf684a9259a17"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=79359cefde70392655aaf684a9259a17"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=79359cefde70392655aaf684a9259a17"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=79359cefde70392655aaf684a9259a17"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=79359cefde70392655aaf684a9259a17"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=79359cefde70392655aaf684a9259a17"/><title data-react-helmet="true">Nodejs &amp; Mongoose 필터링, 정렬, 페이징 구현하기 - Blog by saegeullee</title><meta data-react-helmet="true" name="description" content="쿼리스트링은 클라이언트에서 엔드포인트를 호출하여 서버에 요청할 때 엔드포인트의 끝에 붙여서 부가적으로 보내는 정보이다. 다음의 예시에서 `물음표?` 뒤의 `duration=5&amp;difficulty=easy`가 쿼리스트링이다..."/><meta data-react-helmet="true" property="og:site_name" content="Nodejs &amp; Mongoose 필터링, 정렬, 페이징 구현하기 - Blog by saegeullee"/><meta data-react-helmet="true" property="og:image" content="https://saegeullee.github.io/media/image-2.jpg"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Nodejs &amp; Mongoose 필터링, 정렬, 페이징 구현하기 - Blog by saegeullee"/><meta data-react-helmet="true" name="twitter:description" content="쿼리스트링은 클라이언트에서 엔드포인트를 호출하여 서버에 요청할 때 엔드포인트의 끝에 붙여서 부가적으로 보내는 정보이다. 다음의 예시에서 `물음표?` 뒤의 `duration=5&amp;difficulty=easy`가 쿼리스트링이다..."/><meta data-react-helmet="true" name="twitter:image" content="https://saegeullee.github.io/media/image-2.jpg"/><link as="script" rel="preload" href="/webpack-runtime-e876f3fb06ce083dc5b9.js"/><link as="script" rel="preload" href="/netlify-identity-widget-e37a35e339457e643f79.js"/><link as="script" rel="preload" href="/app-e9f2271e56397154169d.js"/><link as="script" rel="preload" href="/styles-8f10df4b1baa09fb1b32.js"/><link as="script" rel="preload" href="/commons-f4ecacab342f11456ab0.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-40abd2ffdee3c9623eba.js"/><link as="fetch" rel="preload" href="/page-data/nodejs/nodejs-querystring/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">Nodejs &amp; Mongoose 필터링, 정렬, 페이징 구현하기</h1><div class="Content-module--content__body--2TrQ-"><blockquote>
<p><strong><a href="https://www.udemy.com/course/nodejs-express-mongodb-bootcamp/" target="_blank" rel="nofollow noopener noreferrer">유데미 NODE.JS</a></strong> 수업을 듣고 정리한 내용입니다.</p>
</blockquote>
<h1 id="목차"><a href="#%EB%AA%A9%EC%B0%A8" aria-label="목차 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>목차</h1>
<ul>
<li><a href="#%EC%BF%BC%EB%A6%AC%EC%8A%A4%ED%8A%B8%EB%A7%81%EC%9D%B4%EB%9E%80">쿼리스트링이란</a></li>
<li><a href="#%ED%95%84%ED%84%B0%EB%A7%81-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0">필터링 구현하기</a></li>
<li><a href="#%EA%B3%A0%EA%B8%89-%ED%95%84%ED%84%B0%EB%A7%81-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0">고급 필터링 구현하기</a></li>
<li><a href="#%EC%A0%95%EB%A0%AC-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0">정렬 구현하기</a></li>
<li><a href="#%ED%8A%B9%EC%A0%95%ED%95%84%EB%93%9C-%EC%BF%BC%EB%A6%AC-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0">특정필드 쿼리 구현하기</a></li>
<li><a href="#%ED%8E%98%EC%9D%B4%EC%A7%95-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0">페이징 구현하기</a></li>
</ul>
<h2 id="쿼리스트링이란"><a href="#%EC%BF%BC%EB%A6%AC%EC%8A%A4%ED%8A%B8%EB%A7%81%EC%9D%B4%EB%9E%80" aria-label="쿼리스트링이란 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>쿼리스트링이란</h2>
<p>쿼리스트링은 클라이언트에서 엔드포인트를 호출하여 서버에 요청할 때 엔드포인트의 끝에 붙여서 부가적으로 보내는 정보이다. 다음의 예시에서 <code class="language-text">물음표?</code> 뒤의 <code class="language-text">duration=5&amp;difficulty=easy</code>가 쿼리스트링이다. 아래의 요청을 유추해보면 모든 tours 중에 duration이 5이고 difficulty가 easy인 tours만 보내달라는 뜻임을 알 수 있다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">http://localhost:3000/api/v1/tours?duration=5&amp;difficulty=easy</code></pre></div>
<h2 id="필터링-구현하기"><a href="#%ED%95%84%ED%84%B0%EB%A7%81-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0" aria-label="필터링 구현하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>필터링 구현하기</h2>
<p>nodejs 서버에서 클라이언트의 요청을 받아 어떤 쿼리스트링을 보내왔는지를 분석해야 한다. 다음과 같이 컨트롤러 해당 메서드의 첫번째 인자로 들어오는 req 객체의 query 프로퍼티에 쿼리스트링이 담긴다. 그리고 쿼리스트링에 따라 Tour을 쿼리하여 해당 조건에 부합하는 Tour 도큐먼트만 클라이언트에게 응답으로 보내줄 수 있다. 쿼리스트링을 통해 필터링 기능을 구현한 것이다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">//controllers/tourController.js</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">getAllTours</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { duration: '5', difficulty: 'easy' }</span>
  <span class="token keyword">const</span> tours <span class="token operator">=</span> <span class="token keyword">await</span> Tour<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    status<span class="token punctuation">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      tours
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><strong><a href="https://saegeullee.github.io/nodejs/mongoose-basic" target="_blank" rel="nofollow noopener noreferrer">Tour스키마</a></strong> 참고</p>
<h2 id="고급-필터링-구현하기"><a href="#%EA%B3%A0%EA%B8%89-%ED%95%84%ED%84%B0%EB%A7%81-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0" aria-label="고급 필터링 구현하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>고급 필터링 구현하기</h2>
<p>위에서 쿼리스트링을 통해 필터링을 구현하는 방법을 알아보았다. 다음은 고급 필터링을 구현하는 방법을 알아보자. 만약 duration이 5 이상인 모든 Tour을 가져오려면 클라이언트에서 어떻게 요청을 보내야 할까? 이때도 쿼리스트링으로 해당 정보를 엔드포인트에 담아 서버에 요청을 보낼 수 있다. 다음과 같이 쿼리스트링을 구성한다. <code class="language-text">duration</code>뒤에 <code class="language-text">[gte]</code>를 붙여서 서버에 요청을 보내면 된다. gte은 greater than or equal 의 이니셜이다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">http://localhost:3000/api/v1/tours?duration[gte]=5&amp;difficulty=easy</code></pre></div>
<p>위와 같이 요청을 보내면 서버에서는 <code class="language-text">req.query</code>객체가 다음과 같이 구성된다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span> duration<span class="token punctuation">:</span> <span class="token punctuation">{</span> gte<span class="token punctuation">:</span> <span class="token string">'5'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> difficulty<span class="token punctuation">:</span> <span class="token string">'easy'</span> <span class="token punctuation">}</span></code></pre></div>
<p>몽구스에서 해당 요청대로 쿼리를 하기 위해서는 다음과 같이 현재의 <code class="language-text">req.query</code>객체의 <code class="language-text">gte</code>앞에 $가 붙어야 한다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span> duration<span class="token punctuation">:</span> <span class="token punctuation">{</span> $gte<span class="token punctuation">:</span> <span class="token string">'5'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> difficulty<span class="token punctuation">:</span> <span class="token string">'easy'</span> <span class="token punctuation">}</span></code></pre></div>
<p>이를 위해 데이터베이스에 쿼리하기 전에 해당 객체를 조작하여 원하는 형태로 만든 뒤 쿼리해야 한다. 이를 위해 다음과 같이 정규식을 사용하여 <code class="language-text">gte</code>, <code class="language-text">gt</code>, <code class="language-text">lte</code>, <code class="language-text">lt</code>가 객체에 포함된다면 그 앞에 $를 붙여주는 로직을 짜야한다. <code class="language-text">/\b(gte|gt|lte|lt)\b/g</code> 정규식의 <code class="language-text">\b</code>를 앞뒤에 붙임으로서 <code class="language-text">gte</code>, <code class="language-text">gt</code>, <code class="language-text">lte</code>, <code class="language-text">lt</code>가 반드시 정확히 일치하는 단어들만 고른다. (ltl은 lt가 아니기 때문에 일치하지 않는다) <code class="language-text">/g</code>는 이 string에서 일치하는 모든 <code class="language-text">gte</code>, <code class="language-text">gt</code>, <code class="language-text">lte</code>, <code class="language-text">lt</code> 앞에 $를 붙여서 바꿔준다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">exports<span class="token punctuation">.</span><span class="token function-variable function">getAllTours</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//객체를 string으로 바꿈</span>
  <span class="token keyword">let</span> queryStr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
  queryStr <span class="token operator">=</span> queryStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\b(gte|gt|lte|lt)\b/g</span><span class="token punctuation">,</span> <span class="token parameter">match</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>match<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//string을 다시 객체로 바꿔 쿼리한다.</span>
  <span class="token keyword">const</span> tours <span class="token operator">=</span> <span class="token keyword">await</span> Tour<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>queryStr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    status<span class="token punctuation">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      tours
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>이제 아래와 같이 쿼리를 하면 duration이 5 이상이고 price는 1500 이하이고 difficulty는 easy인 tour만 쿼리되어 응답으로 온다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">http://localhost:3000/api/v1/tours?duration[gte]=5&amp;difficulty=easy&amp;price[lte]=1500</code></pre></div>
<p>정규식을 통과되어 나온 객체를 console.log를 찍어보면 다음과 같이 구성된다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span> duration<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">'$gte'</span><span class="token punctuation">:</span> <span class="token string">'5'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  difficulty<span class="token punctuation">:</span> <span class="token string">'easy'</span><span class="token punctuation">,</span>
  price<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">'$lte'</span><span class="token punctuation">:</span> <span class="token string">'1500'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></code></pre></div>
<h2 id="정렬-구현하기"><a href="#%EC%A0%95%EB%A0%AC-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0" aria-label="정렬 구현하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>정렬 구현하기</h2>
<p>쿼리스트링을 통해 정렬 기준을 클라이언트에서 받아 해당 기준으로 정렬된 객체들을 응답으로 보내줄 수 있다. 가격이 낮은 순으로 특정 객체를 쿼리하고 싶다면 클라이언트에서는 다음과 같이 쿼리스트링으로 요청을 보내면 된다. 가격이 높은 순으로 쿼리하고 싶다면 price 앞에 -를 붙여 <code class="language-text">?sort=-price</code>로 요청을 보내면 된다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">http://localhost:3000/api/v1/tours?sort=price</code></pre></div>
<p>서버에서는 다음과 같이 처리하여 정렬 기준으로 쿼리하여 응답을 보내준다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">exports<span class="token punctuation">.</span><span class="token function-variable function">getAllTours</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Tour.find(req.query) 는 몽구스 쿼리 객체를 리턴한다.</span>
  <span class="token keyword">let</span> query <span class="token operator">=</span> Tour<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>sort<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sortBy <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>sort<span class="token punctuation">;</span>
    <span class="token comment">// 쿼리 객체에 정렬기준을 추가한다.</span>
    query <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>sortBy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 쿼리 객체를 consume하여 결과를 가져온다.</span>
  <span class="token keyword">const</span> tours <span class="token operator">=</span> <span class="token keyword">await</span> query<span class="token punctuation">;</span>

  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    status<span class="token punctuation">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      tours
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>만약 price와 함께 두번째 정렬기준도 적용하여 쿼리하고 싶으면 클라이언트에서는 다음과 같이 두번째 정렬기준을 쿼리스트링에 포함하여 요청을 보내야 한다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">http://localhost:3000/api/v1/tours?sort=price,ratingsAverage</code></pre></div>
<p>서버에서는 쿼리스트링을 파싱하여 sort() 함수에 다음과 같이 인자를 넘겨야 한다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">query <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">'price ratingsAverage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>이를 위한 서버의 쿼리스트링 파싱 로직을 다음과 같이 구성하면 된다. 그리고 만약 디폴트 정렬기준을 주고 싶다면 else문에 넣으면 된다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">  <span class="token keyword">let</span> query <span class="token operator">=</span> Tour<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>sort<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sortBy <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>sort<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    query <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>sortBy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    query <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">"-createdAt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<h2 id="특정필드-쿼리-구현하기"><a href="#%ED%8A%B9%EC%A0%95%ED%95%84%EB%93%9C-%EC%BF%BC%EB%A6%AC-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0" aria-label="특정필드 쿼리 구현하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>특정필드 쿼리 구현하기</h2>
<p>클라이언트에서 객체의 특정 필드만 쿼리를 하고 싶다면 쿼리스트링에 쿼리를 원하는 필드만 담아서 엔드포인트를 호출할 수 있다. tours 객체의 name과 duration만 응답으로 받기를 원한다면 다음과 같이 서버에 요청을 보내면 된다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">http://localhost:3000/api/v1/tours?fields=name,duration</code></pre></div>
<p>서버에서는 쿼리객체의 select 메서드에 쿼리를 원하는 필드명을 <code class="language-text">query.select(&#39;name duration&#39;)</code> 과 같이 줘야한다. 특정 필드를 쿼리하고 싶지않다면 <code class="language-text">query.select(&#39;-not_need_this_field&#39;)</code>와 같이 필드 앞에 -를 붙여서 쿼리하면 된다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">exports<span class="token punctuation">.</span><span class="token function-variable function">getAllTours</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> query <span class="token operator">=</span> Tour<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>fields<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fields <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>fields<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    query <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>fields<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    query <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'-__v'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> tours <span class="token operator">=</span> <span class="token keyword">await</span> query<span class="token punctuation">;</span>

  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    status<span class="token punctuation">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      tours
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>만약 디폴트로 무조건 항상 쿼리하고 싶지 않은 필드가 있다면 모델 스키마를 정의할 때 해당 필드에 <code class="language-text">select:false</code>를 지정해주면 된다. 아래의 예시에서는 <code class="language-text">createdAt</code>필드를 항상 쿼리에서 제외한다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">//models/tourSchema.js</span>

<span class="token keyword">const</span> tourSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
      required<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'A tour must have a name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      unique<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    duration<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      required<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'A tour must have a duration'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    createdAt<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Date<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> Date<span class="token punctuation">.</span>now<span class="token punctuation">,</span>
      select<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2 id="페이징-구현하기"><a href="#%ED%8E%98%EC%9D%B4%EC%A7%95-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0" aria-label="페이징 구현하기 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>페이징 구현하기</h2>
<p>페이징을 구현하기 위해서는 우선 몽구스 쿼리 객체에 페이징을 수행할 수 있는 메서드를 알아야 한다. 몽구스에는 <code class="language-text">skip</code>과 <code class="language-text">limit</code>이라는 메서드가 있다. <code class="language-text">skip</code>은 의미 그대로 특정 개수만큼을 건너뛰고 결과를 가져오겠다는 의미이고 <code class="language-text">limit</code>은 쿼리할 도큐먼트의 개수를 의미한다. 아래의 예시에서는 처음 10개의 도큐먼트는 건너뛰고 11번째부터 20번째 도큐먼트 10개를 쿼리하겠다는 의미가 된다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">query <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>클라이언트에서는 페이징을 위해 다음과 같이 쿼리스트링을 추가하여 서버에 요청을 보낸다. 한 페이지에 10개의 결과물을 보여주고 싶다는 의미이다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">http://localhost:3000/api/v1/tours?page=1&amp;limit=10</code></pre></div>
<p>서버에서는 다음과 같이 클라이언트에서 전달받은 page 값을 적절하게 변경하여 skip 메서드의 인자로 전달할 수 있게끔 해야 한다.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">exports<span class="token punctuation">.</span><span class="token function-variable function">getAllTours</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> query <span class="token operator">=</span> Tour<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> page <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>page <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> limit <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>limit <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">||</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> skip <span class="token operator">=</span> <span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> limit<span class="token punctuation">;</span>

  query <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span>skip<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> tours <span class="token operator">=</span> <span class="token keyword">await</span> query<span class="token punctuation">;</span>

  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    status<span class="token punctuation">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      tours
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->15 Dec 2019</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/nodejs/">nodejs</a></li></ul></div><div class="Author-module--author--2Yefr"><p><a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/undefined" rel="noopener noreferrer" target="_blank"><strong>saegeullee</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"><div><div id="disqus_thread"></div></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/nodejs/nodejs-querystring";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-e9f2271e56397154169d.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-87ef582ba388a83f73c0.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-8bf6e18fcbffbee6eab5.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-a8a30d5821197c180923.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-324659d88459e32c19db.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-7561b72f3997c21f4dc5.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-40abd2ffdee3c9623eba.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-438077e52668404488ab.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-4a41e786118ee2b99a61.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-06c543fd0fd21a7ba643.js"]};/*]]>*/</script><script src="/component---src-templates-post-template-js-40abd2ffdee3c9623eba.js" async=""></script><script src="/commons-f4ecacab342f11456ab0.js" async=""></script><script src="/styles-8f10df4b1baa09fb1b32.js" async=""></script><script src="/app-e9f2271e56397154169d.js" async=""></script><script src="/netlify-identity-widget-e37a35e339457e643f79.js" async=""></script><script src="/webpack-runtime-e876f3fb06ce083dc5b9.js" async=""></script></body></html>